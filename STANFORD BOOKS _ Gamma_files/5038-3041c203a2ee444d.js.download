"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5038],{74945:(e,t,r)=>{r.d(t,{Gx:()=>d,mL:()=>c,rB:()=>s,zm:()=>l});var n=r(55729),o=r(58809),i=r(15342),a=r(82927);let d=()=>{let e=(0,i.GV)(o.Jo),t=(0,a.Iy)("edit",e),r=(0,n.useRef)(t);return e&&(r.current=t),r.current},s=()=>{var e;let t=(0,i.GV)(o.Jo);return(null==t||null==(e=t.accessLinks)?void 0:e.length)===0},c=()=>{let e=(0,i.GV)(o.Jo),t=(0,a.Iy)("manage",e),r=(0,n.useRef)(t);return e&&(r.current=t),r.current},l=()=>{let e=d(),t=(0,i.GV)(o.Jo),r=(0,a.Iy)("edit",t);return(null==t?void 0:t.site)?e:r}},76610:(e,t,r)=>{r.d(t,{m:()=>a});var n=r(6845),o=r(72688),i=r(87930);let a=(e,t)=>{var r,a;null==(r=i.U.getState(e.state))||r.compute(e.state.doc).processChanges(t),null==(a=o.Jl.getState(e.state))||a.compute(e.state).processChanges(t),e.commands.command(()=>((0,n.jL)(e.state.doc,t),!0))}},85607:(e,t,r)=>{r.d(t,{mi:()=>w.m,VL:()=>$});var n=r(6029),o=r(46898),i=r(35605),a=r(19564),d=r(81278),s=r(55729),c=r(88586),l=r(44637),u=r(15342),v=r(82927),h=r(12562),f=r(66863);let x=e=>{let t=(0,u.jL)(),{currentWorkspace:r}=(0,v.ur)();(0,s.useEffect)(()=>{if(e)return h.of.updateWorkspaceInLdContext(e).then(()=>{t((0,f.kn)({isDocWorkspaceSet:!0}))}),()=>{h.of.updateWorkspaceInLdContext(r).then(()=>{t((0,f.kn)({isDocWorkspaceSet:!1}))})}},[r,t,e])};var m=r(58809),p=r(69768),j=r(34379),g=r(85057),k=r(6807),C=r(70006),E=r(65148),I=r(77639),b=r(55276),w=r(39162),z=r(27229),L=r(53907),R=r(67909),G=r(36071),_=r(54731),P=r(17920),y=r(3674),S=r(40691),U=r(26385),V=r(48810),D=r(16426),W=r(61204),F=r(49611),J=r(75570);let M=e=>{var t;let r=(null==(t=(0,u.GV)((0,L.A0)(e||"")))?void 0:t.status)==="running",n=(0,s.useRef)(r);n.current=r;let[o,i]=(0,s.useState)(()=>new J.c),a=(0,s.useCallback)(()=>{o.resolve()},[o]),{isOpen:d,onOpen:c,onClose:l}=(0,z.j)();return{confirmNavigationFn:(0,s.useCallback)(()=>{if(!n.current)return Promise.resolve();let e=new J.c;return i(e),c(),e.promise},[c]),confirmNavigationModalProps:{isOpen:d,onClose:l,onConfirm:a}}},N=e=>{let{isOpen:t,onClose:r,onConfirm:o}=e;return(0,n.jsxs)(R.aF,{onClose:r,isOpen:t,isCentered:!0,children:[(0,n.jsx)(G.m,{}),(0,n.jsxs)(_.$,{children:[(0,n.jsx)(P.r,{children:(0,n.jsx)(a.x6,{id:"YeK6T+"})}),(0,n.jsx)(y.s,{}),(0,n.jsx)(S.c,{children:(0,n.jsxs)(U.B,{spacing:4,children:[(0,n.jsx)(V.E,{fontWeight:"bold",children:(0,n.jsx)(a.x6,{id:"Wr6Y7m"})}),(0,n.jsx)(V.E,{children:(0,n.jsx)(a.x6,{id:"n0Fn6S"})})]})}),(0,n.jsx)(D.j,{children:(0,n.jsxs)(W.e,{children:[(0,n.jsx)(F.$,{variant:"ghost",onClick:r,children:(0,n.jsx)(a.x6,{id:"dEgA5A"})}),(0,n.jsx)(F.$,{variant:"hazardous",onClick:o,children:(0,n.jsx)(a.x6,{id:"QxM8i/"})})]})})]})]})};var q=r(17789),A=r(74945),Q=r(99552);let T=e=>{var t;let{doc:r}=e,n=null==r?void 0:r.id,o=null==r||null==(t=r.site)?void 0:t.id,i=(0,u.jL)(),a=(0,A.Gx)(),d=!!(!n||!o||!a),{data:c}=(0,q.DL0)({variables:{id:o},returnPartialData:!0,nextFetchPolicy:"cache-and-network",skip:d}),l=null==c?void 0:c.site;(0,s.useEffect)(()=>{l&&n&&a&&(0,Q.wC)(i)({site:l,docId:n})},[n,i,l,a])},Y=e=>{let{children:t}=e,r=(0,o.d)(),h=(0,v.IM)(),f=(0,u.GV)(b.RK),{user:z,userStatus:L,isGammaAdminUser:R}=(0,v.ur)(),G=(0,s.useRef)(null),_=(0,u.jL)(),{push:P,replace:y}=(0,d.useRouter)(),S=(0,u.GV)(m.Jo),[U,V,D]=(0,C.Ts)(),[W,F]=(0,k.M)(E.E.gammaDocPasswords,{}),J=V&&V.match(C.RG),q=J?J[0]:null,A=W[q],{confirmNavigationFn:Q,confirmNavigationModalProps:Y}=M(q),[$,B]=(0,s.useState)({isUnauthorized:void 0,passwordRequired:void 0,setCollaborativeEditorInstance:e=>{G.current=e,B(t=>({...t,editor:e}))},getCollaborativeEditorInstance:()=>G.current,confirmNavigation:Q,editor:void 0});(0,l.mz)(S),x(null==S?void 0:S.organization);let[K,{data:O,error:X,loading:Z,called:H,subscribeToMore:ee}]=(0,c.gto)({variables:{id:q,password:A},returnPartialData:!0,nextFetchPolicy:"cache-only"}),et=(0,v.ZX)("edit",null==O?void 0:O.doc);T({doc:null==O?void 0:O.doc}),(0,g.C)(K),(0,s.useEffect)(()=>{if(ee&&$.docId&&H)return ee({document:I.aM,variables:{id:$.docId},updateQuery:(e,t)=>{let{subscriptionData:r}=t;return r.data&&r.data.doc&&e.doc?{doc:{...e.doc,...r.data.doc,__typename:"Doc"}}:e},onError:e=>{}})},[$.docId,ee,H]);let er=(0,s.useCallback)(e=>K({variables:{id:q,docId:q,password:e}}),[K,q]),en=(0,s.useCallback)(e=>(F({...W,[q]:e}),er(e)),[er,q,W,F]);return((0,s.useEffect)(()=>{if($.docId!==q&&V){if(!q)return void r({id:"invalid_doc_id_error",title:(0,n.jsx)(a.x6,{id:"742lf1"}),description:"",status:"error",position:"top",isClosable:!1,duration:null});er(A),B(e=>({...e,onPasswordSubmitted:en,docId:q}))}},[$.docId,V,q,A,er,en,_,r]),(0,s.useEffect)(()=>{if("loading"===L||!H||Z||!V)return;if(!O||!O.doc)return(null==X?void 0:X.graphQLErrors.some(e=>{var t;return"unauthorized"===e.code||(null==(t=e.extensions)?void 0:t.code)==="unauthorized"||"Access denied"===e.message}))?void B(e=>({...e,isUnauthorized:!0,passwordRequired:!0})):("loggedOut"===L&&P("/signin?redirect_to=".concat(encodeURIComponent(window.location.href))),void B(e=>({...e,isUnauthorized:!0,passwordRequired:!1})));if(O&&et&&!R&&(O.doc.archived||null===O.doc.currentSnapshotId))return void B(e=>({...e,isUnauthorized:!0}));B(e=>!1===e.isUnauthorized?e:{...e,passwordRequired:!1,isUnauthorized:!1});let e=O.doc;_((0,m.bX)({file:null==e?void 0:e.file})),_((0,m.Tm)({currentPage:e}))},[h,et,O,X,Z,V,H,f,L,P,_,y,z,R]),(0,s.useEffect)(()=>()=>{_((0,b.cL)()),_((0,m.ju)())},[_]),(0,s.useEffect)(()=>{if(!S||!q)return;let e="".concat(S.title?"".concat((0,i.Yv)(S.title),"-"):"").concat(q);V!==e&&(0,p.g5)({pathname:"".concat(U,"/").concat(e).concat(D||""),emitChange:!1})},[S,q,V,U,D]),(0,j.k)(),$.docId)?(0,n.jsxs)(w.p.Provider,{value:$,children:[t,(0,n.jsx)(N,{...Y})]}):(0,n.jsx)(n.Fragment,{})};function $(e){return(0,s.memo)(t=>(0,n.jsx)(Y,{children:(0,n.jsx)(e,{...t})}))}}}]);
//# sourceMappingURL=5038-3041c203a2ee444d.js.map