(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4728],{10612:(e,t,n)=>{var s=n(15757),o=n(63888),i=n(98888),r=n(60567);e.exports=function(e,t,n){e=r(e);var a=(t=i(t))?o(e):0;return t&&a<t?s(t-a,n)+e:e}},11959:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"LoadableContext",{enumerable:!0,get:function(){return s}});let s=n(14761)._(n(55729)).default.createContext(null)},15757:(e,t,n)=>{var s=n(64806),o=n(16153),i=n(2603),r=n(9819),a=n(63888),c=n(18053),l=Math.ceil;e.exports=function(e,t){var n=(t=void 0===t?" ":o(t)).length;if(n<2)return n?s(t,e):t;var u=s(t,l(e/a(t)));return r(t)?i(c(u),0,e).join(""):u.slice(0,e)}},30362:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{default:function(){return a},noSSR:function(){return r}});let s=n(14761);n(6029),n(55729);let o=s._(n(82077));function i(e){return{default:(null==e?void 0:e.default)||e}}function r(e,t){return delete t.webpack,delete t.modules,e(t)}function a(e,t){let n=o.default,s={loading:e=>{let{error:t,isLoading:n,pastDelay:s}=e;return null}};e instanceof Promise?s.loader=()=>e:"function"==typeof e?s.loader=e:"object"==typeof e&&(s={...s,...e});let a=(s={...s,...t}).loader;return(s.loadableGenerated&&(s={...s,...s.loadableGenerated},delete s.loadableGenerated),"boolean"!=typeof s.ssr||s.ssr)?n({...s,loader:()=>null!=a?a().then(i):Promise.resolve(i(()=>null))}):(delete s.webpack,delete s.modules,r(n,s))}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},32267:(e,t,n)=>{"use strict";let s,o;n.d(t,{P2:()=>p});let i=(e,t)=>t.some(t=>e instanceof t),r=new WeakMap,a=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,h={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return a.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return d(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function d(e){if(e instanceof IDBRequest){let t=new Promise((t,n)=>{let s=()=>{e.removeEventListener("success",o),e.removeEventListener("error",i)},o=()=>{t(d(e.result)),s()},i=()=>{n(e.error),s()};e.addEventListener("success",o),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&r.set(t,e)}).catch(()=>{}),u.set(t,e),t}if(l.has(e))return l.get(e);let t=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(o||(o=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(f(this),t),d(r.get(this))}:function(...t){return d(e.apply(f(this),t))}:function(t,...n){let s=e.call(f(this),t,...n);return c.set(s,t.sort?t.sort():[t]),d(s)};return(e instanceof IDBTransaction&&function(e){if(a.has(e))return;let t=new Promise((t,n)=>{let s=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",i),e.removeEventListener("abort",i)},o=()=>{t(),s()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",o),e.addEventListener("error",i),e.addEventListener("abort",i)});a.set(e,t)}(e),i(e,s||(s=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(e,h):e}(e);return t!==e&&(l.set(e,t),u.set(t,e)),t}let f=e=>u.get(e);function p(e,t,{blocked:n,upgrade:s,blocking:o,terminated:i}={}){let r=indexedDB.open(e,t),a=d(r);return s&&r.addEventListener("upgradeneeded",e=>{s(d(r.result),e.oldVersion,e.newVersion,d(r.transaction))}),n&&r.addEventListener("blocked",()=>n()),a.then(e=>{i&&e.addEventListener("close",()=>i()),o&&e.addEventListener("versionchange",()=>o())}).catch(()=>{}),a}let g=["get","getKey","getAll","getAllKeys","count"],m=["put","add","delete","clear"],y=new Map;function b(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(y.get(t))return y.get(t);let n=t.replace(/FromIndex$/,""),s=t!==n,o=m.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(o||g.includes(n)))return;let i=async function(e,...t){let i=this.transaction(e,o?"readwrite":"readonly"),r=i.store;return s&&(r=r.index(t.shift())),(await Promise.all([r[n](...t),o&&i.done]))[0]};return y.set(t,i),i}h=(e=>({...e,get:(t,n,s)=>b(t,n)||e.get(t,n,s),has:(t,n)=>!!b(t,n)||e.has(t,n)}))(h)},34732:(e,t,n)=>{"use strict";n.d(t,{I:()=>r});var s=n(55729),o=n(59363),i=n(42304);function r(){i.r.current||(0,o.U)();let[e]=(0,s.useState)(i.O.current);return e}},39891:(e,t,n)=>{"use strict";n.d(t,{o5:()=>P});var s=n(37243);let o=e=>(0,s.Yp)({find:/--$/,replace:null!=e?e:"—"}),i=e=>(0,s.Yp)({find:/\.\.\.$/,replace:null!=e?e:"…"}),r=e=>(0,s.Yp)({find:/(?:^|[\s{[(<'"\u2018\u201C])(")$/,replace:null!=e?e:"“"}),a=e=>(0,s.Yp)({find:/"$/,replace:null!=e?e:"”"}),c=e=>(0,s.Yp)({find:/(?:^|[\s{[(<'"\u2018\u201C])(')$/,replace:null!=e?e:"‘"}),l=e=>(0,s.Yp)({find:/'$/,replace:null!=e?e:"’"}),u=e=>(0,s.Yp)({find:/<-$/,replace:null!=e?e:"←"}),h=e=>(0,s.Yp)({find:/->$/,replace:null!=e?e:"→"}),d=e=>(0,s.Yp)({find:/\(c\)$/,replace:null!=e?e:"\xa9"}),f=e=>(0,s.Yp)({find:/\(tm\)$/,replace:null!=e?e:"™"}),p=e=>(0,s.Yp)({find:/\(sm\)$/,replace:null!=e?e:"℠"}),g=e=>(0,s.Yp)({find:/\(r\)$/,replace:null!=e?e:"\xae"}),m=e=>(0,s.Yp)({find:/(?:^|\s)(1\/2)\s$/,replace:null!=e?e:"\xbd"}),y=e=>(0,s.Yp)({find:/\+\/-$/,replace:null!=e?e:"\xb1"}),b=e=>(0,s.Yp)({find:/!=$/,replace:null!=e?e:"≠"}),w=e=>(0,s.Yp)({find:/<<$/,replace:null!=e?e:"\xab"}),v=e=>(0,s.Yp)({find:/>>$/,replace:null!=e?e:"\xbb"}),C=e=>(0,s.Yp)({find:/\d+\s?([*x])\s?\d+$/,replace:null!=e?e:"\xd7"}),S=e=>(0,s.Yp)({find:/\^2$/,replace:null!=e?e:"\xb2"}),k=e=>(0,s.Yp)({find:/\^3$/,replace:null!=e?e:"\xb3"}),A=e=>(0,s.Yp)({find:/(?:^|\s)(1\/4)\s$/,replace:null!=e?e:"\xbc"}),D=e=>(0,s.Yp)({find:/(?:^|\s)(3\/4)\s$/,replace:null!=e?e:"\xbe"}),P=s.YY.create({name:"typography",addOptions:()=>({closeDoubleQuote:"”",closeSingleQuote:"’",copyright:"\xa9",ellipsis:"…",emDash:"—",laquo:"\xab",leftArrow:"←",multiplication:"\xd7",notEqual:"≠",oneHalf:"\xbd",oneQuarter:"\xbc",openDoubleQuote:"“",openSingleQuote:"‘",plusMinus:"\xb1",raquo:"\xbb",registeredTrademark:"\xae",rightArrow:"→",servicemark:"℠",superscriptThree:"\xb3",superscriptTwo:"\xb2",threeQuarters:"\xbe",trademark:"™"}),addInputRules(){let e=[];return!1!==this.options.emDash&&e.push(o(this.options.emDash)),!1!==this.options.ellipsis&&e.push(i(this.options.ellipsis)),!1!==this.options.openDoubleQuote&&e.push(r(this.options.openDoubleQuote)),!1!==this.options.closeDoubleQuote&&e.push(a(this.options.closeDoubleQuote)),!1!==this.options.openSingleQuote&&e.push(c(this.options.openSingleQuote)),!1!==this.options.closeSingleQuote&&e.push(l(this.options.closeSingleQuote)),!1!==this.options.leftArrow&&e.push(u(this.options.leftArrow)),!1!==this.options.rightArrow&&e.push(h(this.options.rightArrow)),!1!==this.options.copyright&&e.push(d(this.options.copyright)),!1!==this.options.trademark&&e.push(f(this.options.trademark)),!1!==this.options.servicemark&&e.push(p(this.options.servicemark)),!1!==this.options.registeredTrademark&&e.push(g(this.options.registeredTrademark)),!1!==this.options.oneHalf&&e.push(m(this.options.oneHalf)),!1!==this.options.plusMinus&&e.push(y(this.options.plusMinus)),!1!==this.options.notEqual&&e.push(b(this.options.notEqual)),!1!==this.options.laquo&&e.push(w(this.options.laquo)),!1!==this.options.raquo&&e.push(v(this.options.raquo)),!1!==this.options.multiplication&&e.push(C(this.options.multiplication)),!1!==this.options.superscriptTwo&&e.push(S(this.options.superscriptTwo)),!1!==this.options.superscriptThree&&e.push(k(this.options.superscriptThree)),!1!==this.options.oneQuarter&&e.push(A(this.options.oneQuarter)),!1!==this.options.threeQuarters&&e.push(D(this.options.threeQuarters)),e}})},40510:(e,t,n)=>{"use strict";var s,o;n.d(t,{CV:()=>_,OC:()=>O,YD:()=>o,cj:()=>T,cw:()=>U,gU:()=>E,hR:()=>M});let i=Math.floor,r=(e,t)=>e<t?e:t,a=(e,t)=>e>t?e:t,c=Number.MAX_SAFE_INTEGER,l="undefined"!=typeof TextEncoder?new TextEncoder:null,u=l?e=>l.encode(e):e=>{let t=unescape(encodeURIComponent(e)),n=t.length,s=new Uint8Array(n);for(let e=0;e<n;e++)s[e]=t.codePointAt(e);return s},h="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});h&&1===h.decode(new Uint8Array).length&&(h=null);let d=(e,t)=>{let n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(2*n),e.cpos=0),e.cbuf[e.cpos++]=t},f=(e,t)=>{for(;t>127;)d(e,128|127&t),t=i(t/128);d(e,127&t)},p=new Uint8Array(3e4),g=p.length/3,m=l&&l.encodeInto?(e,t)=>{if(t.length<g){let n=l.encodeInto(t,p).written||0;f(e,n);for(let t=0;t<n;t++)d(e,p[t])}else b(e,u(t))}:(e,t)=>{let n=unescape(encodeURIComponent(t)),s=n.length;f(e,s);for(let t=0;t<s;t++)d(e,n.codePointAt(t))},y=(e,t)=>{let n=e.cbuf.length,s=e.cpos,o=r(n-s,t.length),i=t.length-o;e.cbuf.set(t.subarray(0,o),s),e.cpos+=o,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(a(2*n,i)),e.cbuf.set(t.subarray(o)),e.cpos=i)},b=(e,t)=>{f(e,t.byteLength),y(e,t)},w=e=>Error(e),v=w("Unexpected end of array"),C=w("Integer out of Range"),S=(e,t)=>{let n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},k=e=>S(e,D(e)),A=e=>e.arr[e.pos++],D=e=>{let t=0,n=1,s=e.arr.length;for(;e.pos<s;){let s=e.arr[e.pos++];if(t+=(127&s)*n,n*=128,s<128)return t;if(t>c)throw C}throw v},P=h?e=>h.decode(k(e)):e=>{let t=D(e);if(0===t)return"";{let n=String.fromCodePoint(A(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(A(e));else for(;t>0;){let s=t<1e4?t:1e4,o=e.arr.subarray(e.pos,e.pos+s);e.pos+=s,n+=String.fromCodePoint.apply(null,o),t-=s}return decodeURIComponent(escape(n))}};!function(e){e[e.Token=0]="Token",e[e.PermissionDenied=1]="PermissionDenied",e[e.Authenticated=2]="Authenticated"}(s||(s={}));let O=(e,t)=>{f(e,s.Token),m(e,t)},E=(e,t,n)=>{switch(D(e)){case s.PermissionDenied:t(P(e));break;case s.Authenticated:n(P(e))}},T={code:1009,reason:"Message Too Big"},M={code:4401,reason:"Unauthorized"},U={code:4403,reason:"Forbidden"},_=e=>Array.from(e.entries()).map(([e,t])=>({clientId:e,...t}));!function(e){e[e.Connecting=0]="Connecting",e[e.Open=1]="Open",e[e.Closing=2]="Closing",e[e.Closed=3]="Closed"}(o||(o={}))},64806:e=>{var t=Math.floor;e.exports=function(e,n){var s="";if(!e||n<1||n>0x1fffffffffffff)return s;do n%2&&(s+=e),(n=t(n/2))&&(e+=e);while(n);return s}},71024:(e,t,n)=>{e.exports=n(30362)},81141:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var s=n(23086),o=n(62123);function i(e,t){(0,o.A)(2,arguments);var n=(0,s.A)(e,t)/36e5;return n>0?Math.floor(n):Math.ceil(n)}},82077:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return d}});let s=n(14761)._(n(55729)),o=n(11959),i=[],r=[],a=!1;function c(e){let t=e(),n={loading:!0,loaded:null,error:null};return n.promise=t.then(e=>(n.loading=!1,n.loaded=e,e)).catch(e=>{throw n.loading=!1,n.error=e,e}),n}class l{promise(){return this._res.promise}retry(){this._clearTimeouts(),this._res=this._loadFn(this._opts.loader),this._state={pastDelay:!1,timedOut:!1};let{_res:e,_opts:t}=this;e.loading&&("number"==typeof t.delay&&(0===t.delay?this._state.pastDelay=!0:this._delay=setTimeout(()=>{this._update({pastDelay:!0})},t.delay)),"number"==typeof t.timeout&&(this._timeout=setTimeout(()=>{this._update({timedOut:!0})},t.timeout))),this._res.promise.then(()=>{this._update({}),this._clearTimeouts()}).catch(e=>{this._update({}),this._clearTimeouts()}),this._update({})}_update(e){this._state={...this._state,error:this._res.error,loaded:this._res.loaded,loading:this._res.loading,...e},this._callbacks.forEach(e=>e())}_clearTimeouts(){clearTimeout(this._delay),clearTimeout(this._timeout)}getCurrentValue(){return this._state}subscribe(e){return this._callbacks.add(e),()=>{this._callbacks.delete(e)}}constructor(e,t){this._loadFn=e,this._opts=t,this._callbacks=new Set,this._delay=null,this._timeout=null,this.retry()}}function u(e){return function(e,t){let n=Object.assign({loader:null,loading:null,delay:200,timeout:null,webpack:null,modules:null},t),i=null;function c(){if(!i){let t=new l(e,n);i={getCurrentValue:t.getCurrentValue.bind(t),subscribe:t.subscribe.bind(t),retry:t.retry.bind(t),promise:t.promise.bind(t)}}return i.promise()}if(!a){let e=n.webpack&&1?n.webpack():n.modules;e&&r.push(t=>{for(let n of e)if(t.includes(n))return c()})}function u(e,t){c();let r=s.default.useContext(o.LoadableContext);r&&Array.isArray(n.modules)&&n.modules.forEach(e=>{r(e)});let a=s.default.useSyncExternalStore(i.subscribe,i.getCurrentValue,i.getCurrentValue);return s.default.useImperativeHandle(t,()=>({retry:i.retry}),[]),s.default.useMemo(()=>{var t;return a.loading||a.error?s.default.createElement(n.loading,{isLoading:a.loading,pastDelay:a.pastDelay,timedOut:a.timedOut,error:a.error,retry:i.retry}):a.loaded?s.default.createElement((t=a.loaded)&&t.default?t.default:t,e):null},[e,a])}return u.preload=()=>c(),u.displayName="LoadableComponent",s.default.forwardRef(u)}(c,e)}function h(e,t){let n=[];for(;e.length;){let s=e.pop();n.push(s(t))}return Promise.all(n).then(()=>{if(e.length)return h(e,t)})}u.preloadAll=()=>new Promise((e,t)=>{h(i).then(e,t)}),u.preloadReady=e=>(void 0===e&&(e=[]),new Promise(t=>{let n=()=>(a=!0,t());h(r,e).then(n,n)})),window.__NEXT_PRELOADREADY=u.preloadReady;let d=u},90865:(e,t,n)=>{"use strict";let s;n.d(t,{m:()=>e4,nU:()=>ej,Go:()=>o});var o,i,r=n(40510),a=n(41797);async function c(e){return new Promise((t,n)=>{setTimeout(t,e)})}function l(e,t){let n=t.delay;if(0===n)return 0;if(t.factor&&(n*=Math.pow(t.factor,e.attemptNum-1),0!==t.maxDelay&&(n=Math.min(n,t.maxDelay))),t.jitter){let e=Math.ceil(t.minDelay);n=Math.floor(Math.random()*(Math.floor(n)-e+1))+e}return Math.round(n)}async function u(e,t){var n;let s=((n=t)||(n={}),{delay:void 0===n.delay?200:n.delay,initialDelay:void 0===n.initialDelay?0:n.initialDelay,minDelay:void 0===n.minDelay?0:n.minDelay,maxDelay:void 0===n.maxDelay?0:n.maxDelay,factor:void 0===n.factor?0:n.factor,maxAttempts:void 0===n.maxAttempts?3:n.maxAttempts,timeout:void 0===n.timeout?0:n.timeout,jitter:!0===n.jitter,handleError:void 0===n.handleError?null:n.handleError,handleTimeout:void 0===n.handleTimeout?null:n.handleTimeout,beforeAttempt:void 0===n.beforeAttempt?null:n.beforeAttempt,calculateDelay:void 0===n.calculateDelay?null:n.calculateDelay});for(let e of["delay","initialDelay","minDelay","maxDelay","maxAttempts","timeout"]){let t=s[e];if(!Number.isInteger(t)||t<0)throw Error(`Value for ${e} must be an integer greater than or equal to 0`)}if(s.factor.constructor!==Number||s.factor<0)throw Error("Value for factor must be a number greater than or equal to 0");if(s.delay<s.minDelay)throw Error(`delay cannot be less than minDelay (delay: ${s.delay}, minDelay: ${s.minDelay}`);let o={attemptNum:0,attemptsRemaining:s.maxAttempts?s.maxAttempts:-1,aborted:!1,abort(){o.aborted=!0}},i=s.calculateDelay||l;async function r(){if(s.beforeAttempt&&s.beforeAttempt(o,s),o.aborted){let e=Error("Attempt aborted");throw e.code="ATTEMPT_ABORTED",e}let t=async e=>{if(s.handleError&&await s.handleError(e,o,s),o.aborted||0===o.attemptsRemaining)throw e;o.attemptNum++;let t=i(o,s);return t&&await c(t),r()};return(o.attemptsRemaining>0&&o.attemptsRemaining--,s.timeout)?new Promise((n,i)=>{let r=setTimeout(()=>{if(s.handleTimeout)try{n(s.handleTimeout(o,s))}catch(e){i(e)}else{let e=Error(`Retry timeout (attemptNum: ${o.attemptNum}, timeout: ${s.timeout})`);e.code="ATTEMPT_TIMEOUT",i(e)}},s.timeout);e(o,s).then(e=>{clearTimeout(r),n(e)}).catch(e=>{clearTimeout(r),t(e).then(n).catch(i)})}):e(o,s).catch(t)}let a=s.calculateDelay?s.calculateDelay(o,s):s.initialDelay;return a&&await c(a),r()}var h=n(29143),d=n(51642).Buffer;let f=()=>new Map,p=(e,t,n)=>{let s=e.get(t);return void 0===s&&e.set(t,s=n()),s},g=()=>new Set,m=Array.from,y=String.fromCharCode,b=e=>e.toLowerCase(),w=/^\s*/g,v=e=>e.replace(w,""),C=/([A-Z])/g,S=(e,t)=>v(e.replace(C,e=>`${t}${b(e)}`)),k="undefined"!=typeof TextEncoder?new TextEncoder:null,A=k?e=>k.encode(e):e=>{let t=unescape(encodeURIComponent(e)),n=t.length,s=new Uint8Array(n);for(let e=0;e<n;e++)s[e]=t.codePointAt(e);return s},D="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});D&&1===D.decode(new Uint8Array).length&&(D=null);let P=e=>void 0===e?null:e;class O{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}}let E=new O,T=!0;try{"undefined"!=typeof localStorage&&localStorage&&(E=localStorage,T=!1)}catch(e){}let M=E,U=e=>T||addEventListener("storage",e),_=e=>T||removeEventListener("storage",e),I=Object.keys,x=(e,t)=>{let n=[];for(let s in e)n.push(t(e[s],s));return n},L=e=>I(e).length,R=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),B=(e,t)=>e===t,N=(e,t)=>{if(null==e||null==t)return B(e,t);if(e.constructor!==t.constructor)return!1;if(e===t)return!0;switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break;case Set:if(e.size!==t.size)return!1;for(let n of e)if(!t.has(n))return!1;break;case Map:if(e.size!==t.size)return!1;for(let n of e.keys())if(!t.has(n)||!N(e.get(n),t.get(n)))return!1;break;case Object:if(L(e)!==L(t))return!1;for(let n in e)if(!R(e,n)||!N(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!N(e[n],t[n]))return!1;break;default:return!1}return!0},$=void 0!==h&&h.release&&/node|io\.js/.test(h.release.name)&&"[object process]"===Object.prototype.toString.call(void 0!==h?h:0),j="undefined"!=typeof window&&"undefined"!=typeof document&&!$;"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);let H=()=>{if(void 0===s)if($){s=f();let e=h.argv,t=null;for(let n=0;n<e.length;n++){let o=e[n];"-"===o[0]?(null!==t&&s.set(t,""),t=o):null!==t&&(s.set(t,o),t=null)}null!==t&&s.set(t,"")}else"object"==typeof location?(s=f(),(location.search||"?").slice(1).split("&").forEach(e=>{if(0!==e.length){let[t,n]=e.split("=");s.set(`--${S(t,"-")}`,n),s.set(`-${S(t,"-")}`,n)}})):s=f();return s},Q=e=>H().has(e),V=e=>$?P(h.env[e.toUpperCase()]):P(M.getItem(e));(e=>Q("--"+e)||V(e))("production");let Y=$&&["true","1","2"].includes(h.env.FORCE_COLOR);!Q("no-colors")&&(!$||h.stdout.isTTY||Y)&&(!$||Q("color")||Y||null!==V("COLORTERM")||(V("TERM")||"").includes("color"));let W=Math.floor,q=(e,t)=>e<t?e:t,F=(e,t)=>e>t?e:t,z=Number.MAX_SAFE_INTEGER;class G{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}let J=()=>new G,X=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},K=e=>{let t=new Uint8Array(X(e)),n=0;for(let s=0;s<e.bufs.length;s++){let o=e.bufs[s];t.set(o,n),n+=o.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},Z=(e,t)=>{let n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(2*n),e.cpos=0),e.cbuf[e.cpos++]=t},ee=(e,t)=>{for(;t>127;)Z(e,128|127&t),t=W(t/128);Z(e,127&t)},et=new Uint8Array(3e4),en=et.length/3,es=k&&k.encodeInto?(e,t)=>{if(t.length<en){let n=k.encodeInto(t,et).written||0;ee(e,n);for(let t=0;t<n;t++)Z(e,et[t])}else ei(e,A(t))}:(e,t)=>{let n=unescape(encodeURIComponent(t)),s=n.length;ee(e,s);for(let t=0;t<s;t++)Z(e,n.codePointAt(t))},eo=(e,t)=>{let n=e.cbuf.length,s=e.cpos,o=q(n-s,t.length),i=t.length-o;e.cbuf.set(t.subarray(0,o),s),e.cpos+=o,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(F(2*n,i)),e.cbuf.set(t.subarray(o)),e.cpos=i)},ei=(e,t)=>{ee(e,t.byteLength),eo(e,t)},er=e=>Error(e),ea=er("Unexpected end of array"),ec=er("Integer out of Range");class el{constructor(e){this.arr=e,this.pos=0}}let eu=e=>new el(e),eh=(e,t)=>{let n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},ed=e=>eh(e,ep(e)),ef=e=>e.arr[e.pos++],ep=e=>{let t=0,n=1,s=e.arr.length;for(;e.pos<s;){let s=e.arr[e.pos++];if(t+=(127&s)*n,n*=128,s<128)return t;if(t>z)throw ec}throw ea},eg=e=>{let t=e.arr[e.pos++],n=63&t,s=64,o=(64&t)>0?-1:1;if((128&t)==0)return o*n;let i=e.arr.length;for(;e.pos<i;){if(n+=(127&(t=e.arr[e.pos++]))*s,s*=128,t<128)return o*n;if(n>z)throw ec}throw ea},em=D?e=>D.decode(ed(e)):e=>{let t=ep(e);if(0===t)return"";{let n=String.fromCodePoint(ef(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(ef(e));else for(;t>0;){let s=t<1e4?t:1e4,o=e.arr.subarray(e.pos,e.pos+s);e.pos+=s,n+=String.fromCodePoint.apply(null,o),t-=s}return decodeURIComponent(escape(n))}},ey=e=>{let t=e.pos,n=em(e);return e.pos=t,n},eb=e=>new Uint8Array(e),ew=(e,t,n)=>new Uint8Array(e,t,n),ev=e=>new Uint8Array(e),eC=j?e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=y(e[n]);return btoa(t)}:e=>d.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),eS=j?e=>{let t=atob(e),n=eb(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}:e=>{let t=d.from(e,"base64");return ew(t.buffer,t.byteOffset,t.byteLength)},ek=new Map;class eA{constructor(e){this.room=e,this.onmessage=null,this._onChange=t=>t.key===e&&null!==this.onmessage&&this.onmessage({data:eS(t.newValue||"")}),U(this._onChange)}postMessage(e){M.setItem(this.room,eC(ev(e)))}close(){_(this._onChange)}}let eD="undefined"==typeof BroadcastChannel?eA:BroadcastChannel,eP=e=>p(ek,e,()=>{let t=g(),n=new eD(e);return n.onmessage=e=>t.forEach(t=>t(e.data,"broadcastchannel")),{bc:n,subs:t}}),eO=(e,t)=>(eP(e).subs.add(t),t),eE=(e,t)=>{let n=eP(e),s=n.subs.delete(t);return s&&0===n.subs.size&&(n.bc.close(),ek.delete(e)),s},eT=(e,t,n=null)=>{let s=eP(e);s.bc.postMessage(t),s.subs.forEach(e=>e(t,n))},eM=()=>{let e=!0;return(t,n)=>{if(e){e=!1;try{t()}finally{e=!0}}else void 0!==n&&n()}},eU=Date.now;class e_{constructor(){this._observers=f()}on(e,t){p(this._observers,e,g).add(t)}once(e,t){let n=(...s)=>{this.off(e,n),t(...s)};this.on(e,n)}off(e,t){let n=this._observers.get(e);void 0!==n&&(n.delete(t),0===n.size&&this._observers.delete(e))}emit(e,t){return m((this._observers.get(e)||f()).values()).forEach(e=>e(...t))}destroy(){this._observers=f()}}class eI extends e_{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let e=eU();null!==this.getLocalState()&&15e3<=e-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let t=[];this.meta.forEach((n,s)=>{s!==this.clientID&&3e4<=e-n.lastUpdated&&this.states.has(s)&&t.push(s)}),t.length>0&&ex(this,t,"timeout")},W(3e3)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,n=this.meta.get(t),s=void 0===n?0:n.clock+1,o=this.states.get(t);null===e?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:s,lastUpdated:eU()});let i=[],r=[],a=[],c=[];null===e?c.push(t):null==o?null!=e&&i.push(t):(r.push(t),N(o,e)||a.push(t)),(i.length>0||a.length>0||c.length>0)&&this.emit("change",[{added:i,updated:a,removed:c},"local"]),this.emit("update",[{added:i,updated:r,removed:c},"local"])}setLocalStateField(e,t){let n=this.getLocalState();null!==n&&this.setLocalState({...n,[e]:t})}getStates(){return this.states}}let ex=(e,t,n)=>{let s=[];for(let n=0;n<t.length;n++){let o=t[n];if(e.states.has(o)){if(e.states.delete(o),o===e.clientID){let t=e.meta.get(o);e.meta.set(o,{clock:t.clock+1,lastUpdated:eU()})}s.push(o)}}s.length>0&&(e.emit("change",[{added:[],updated:[],removed:s},n]),e.emit("update",[{added:[],updated:[],removed:s},n]))},eL=(e,t,n=e.states)=>{let s=t.length,o=J();ee(o,s);for(let i=0;i<s;i++){let s=t[i],r=n.get(s)||null,a=e.meta.get(s).clock;ee(o,s),ee(o,a),es(o,JSON.stringify(r))}return K(o)},eR=(e,t,n)=>{let s=eu(t),o=eU(),i=[],r=[],a=[],c=[],l=ep(s);for(let t=0;t<l;t++){let t=ep(s),n=ep(s),l=JSON.parse(em(s)),u=e.meta.get(t),h=e.states.get(t),d=void 0===u?0:u.clock;(d<n||d===n&&null===l&&e.states.has(t))&&(null===l?t===e.clientID&&null!=e.getLocalState()?n++:e.states.delete(t):e.states.set(t,l),e.meta.set(t,{clock:n,lastUpdated:o}),void 0===u&&null!==l?i.push(t):void 0!==u&&null===l?c.push(t):null!==l&&(N(l,h)||a.push(t),r.push(t)))}(i.length>0||a.length>0||c.length>0)&&e.emit("change",[{added:i,updated:a,removed:c},n]),(i.length>0||r.length>0||c.length>0)&&e.emit("update",[{added:i,updated:r,removed:c},n])};class eB{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){let n=this.callbacks[e];return n&&n.forEach(e=>e.apply(this,t)),this}off(e,t){let n=this.callbacks[e];return n&&(t?this.callbacks[e]=n.filter(e=>e!==t):delete this.callbacks[e]),this}removeAllListeners(){this.callbacks={}}}let eN=e=>x(e,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&");!function(e){e[e.Sync=0]="Sync",e[e.Awareness=1]="Awareness",e[e.Auth=2]="Auth",e[e.QueryAwareness=3]="QueryAwareness",e[e.Stateless=5]="Stateless",e[e.CLOSE=7]="CLOSE",e[e.SyncStatus=8]="SyncStatus"}(o||(o={})),function(e){e.Connecting="connecting",e.Connected="connected",e.Disconnected="disconnected"}(i||(i={}));class e${constructor(e){this.data=e,this.encoder=J(),this.decoder=eu(new Uint8Array(this.data))}peekVarString(){return ey(this.decoder)}readVarUint(){return ep(this.decoder)}readVarString(){return em(this.decoder)}readVarUint8Array(){return ed(this.decoder)}writeVarUint(e){return ee(this.encoder,e)}writeVarString(e){return es(this.encoder,e)}writeVarUint8Array(e){return ei(this.encoder,e)}length(){return X(this.encoder)}}class ej extends eB{constructor(e){if(super(),this.messageQueue=[],this.configuration={url:"",document:void 0,WebSocketPolyfill:void 0,parameters:{},connect:!0,broadcast:!0,forceSyncInterval:!1,messageReconnectTimeout:3e4,delay:1e3,initialDelay:0,factor:2,maxAttempts:0,minDelay:1e3,maxDelay:3e4,jitter:!0,timeout:0,onOpen:()=>null,onConnect:()=>null,onMessage:()=>null,onOutgoingMessage:()=>null,onStatus:()=>null,onDisconnect:()=>null,onClose:()=>null,onDestroy:()=>null,onAwarenessUpdate:()=>null,onAwarenessChange:()=>null,quiet:!1,providerMap:new Map},this.webSocket=null,this.webSocketHandlers={},this.shouldConnect=!0,this.status=i.Disconnected,this.lastMessageReceived=0,this.identifier=0,this.intervals={forceSync:null,connectionChecker:null},this.connectionAttempt=null,this.receivedOnOpenPayload=void 0,this.receivedOnStatusPayload=void 0,this.closeTries=0,this.setConfiguration(e),this.configuration.WebSocketPolyfill=e.WebSocketPolyfill?e.WebSocketPolyfill:WebSocket,this.on("open",this.configuration.onOpen),this.on("open",this.onOpen.bind(this)),this.on("connect",this.configuration.onConnect),this.on("message",this.configuration.onMessage),this.on("outgoingMessage",this.configuration.onOutgoingMessage),this.on("status",this.configuration.onStatus),this.on("status",this.onStatus.bind(this)),this.on("disconnect",this.configuration.onDisconnect),this.on("close",this.configuration.onClose),this.on("destroy",this.configuration.onDestroy),this.on("awarenessUpdate",this.configuration.onAwarenessUpdate),this.on("awarenessChange",this.configuration.onAwarenessChange),this.on("close",this.onClose.bind(this)),this.on("message",this.onMessage.bind(this)),this.intervals.connectionChecker=setInterval(this.checkConnection.bind(this),this.configuration.messageReconnectTimeout/10),void 0!==e.connect&&(this.shouldConnect=e.connect),!this.shouldConnect)return;this.connect()}async onOpen(e){this.receivedOnOpenPayload=e}async onStatus(e){this.receivedOnStatusPayload=e}attach(e){let t;return this.configuration.providerMap.set(e.configuration.name,e),this.status===i.Disconnected&&this.shouldConnect&&(t=this.connect()),this.receivedOnOpenPayload&&e.onOpen(this.receivedOnOpenPayload),this.receivedOnStatusPayload&&e.onStatus(this.receivedOnStatusPayload),t}detach(e){this.configuration.providerMap.delete(e.configuration.name)}setConfiguration(e={}){this.configuration={...this.configuration,...e}}async connect(){let e;if(this.status===i.Connected)return;this.cancelWebsocketRetry&&(this.cancelWebsocketRetry(),this.cancelWebsocketRetry=void 0),this.receivedOnOpenPayload=void 0,this.receivedOnStatusPayload=void 0,this.shouldConnect=!0;let{retryPromise:t,cancelFunc:n}=(e=!1,{retryPromise:u(this.createWebSocketConnection.bind(this),{delay:this.configuration.delay,initialDelay:this.configuration.initialDelay,factor:this.configuration.factor,maxAttempts:this.configuration.maxAttempts,minDelay:this.configuration.minDelay,maxDelay:this.configuration.maxDelay,jitter:this.configuration.jitter,timeout:this.configuration.timeout,beforeAttempt:t=>{(!this.shouldConnect||e)&&t.abort()}}).catch(e=>{if(e&&"ATTEMPT_ABORTED"!==e.code)throw e}),cancelFunc:()=>{e=!0}});return this.cancelWebsocketRetry=n,t}attachWebSocketListeners(e,t){let{identifier:n}=e;this.webSocketHandlers[n]={message:e=>this.emit("message",e),close:e=>this.emit("close",{event:e}),open:e=>this.emit("open",e),error:e=>{t(e)}};let s=this.webSocketHandlers[e.identifier];Object.keys(s).forEach(t=>{e.addEventListener(t,s[t])})}cleanupWebSocket(){if(!this.webSocket)return;let{identifier:e}=this.webSocket,t=this.webSocketHandlers[e];Object.keys(t).forEach(n=>{var s;null==(s=this.webSocket)||s.removeEventListener(n,t[n]),delete this.webSocketHandlers[e]}),this.webSocket.close(),this.webSocket=null}createWebSocketConnection(){return new Promise((e,t)=>{this.webSocket&&(this.messageQueue=[],this.cleanupWebSocket()),this.lastMessageReceived=0,this.identifier+=1;let n=new this.configuration.WebSocketPolyfill(this.url);n.binaryType="arraybuffer",n.identifier=this.identifier,this.attachWebSocketListeners(n,t),this.webSocket=n,this.status=i.Connecting,this.emit("status",{status:i.Connecting}),this.connectionAttempt={resolve:e,reject:t}})}onMessage(e){var t;this.resolveConnectionAttempt(),this.lastMessageReceived=eU();let n=new e$(e.data).peekVarString();null==(t=this.configuration.providerMap.get(n))||t.onMessage(e)}resolveConnectionAttempt(){this.connectionAttempt&&(this.connectionAttempt.resolve(),this.connectionAttempt=null,this.status=i.Connected,this.emit("status",{status:i.Connected}),this.emit("connect"),this.messageQueue.forEach(e=>this.send(e)),this.messageQueue=[])}stopConnectionAttempt(){this.connectionAttempt=null}rejectConnectionAttempt(){var e;null==(e=this.connectionAttempt)||e.reject(),this.connectionAttempt=null}checkConnection(){var e;this.status===i.Connected&&this.lastMessageReceived&&(this.configuration.messageReconnectTimeout>=eU()-this.lastMessageReceived||(this.closeTries+=1,this.closeTries>2?(this.onClose({event:{code:4408,reason:"forced"}}),this.closeTries=0):(null==(e=this.webSocket)||e.close(),this.messageQueue=[])))}get serverUrl(){for(;"/"===this.configuration.url[this.configuration.url.length-1];)return this.configuration.url.slice(0,this.configuration.url.length-1);return this.configuration.url}get url(){let e=eN(this.configuration.parameters);return`${this.serverUrl}${0===e.length?"":`?${e}`}`}disconnect(){if(this.shouldConnect=!1,null!==this.webSocket)try{this.webSocket.close(),this.messageQueue=[]}catch{}}send(e){var t;(null==(t=this.webSocket)?void 0:t.readyState)===r.YD.Open?this.webSocket.send(e):this.messageQueue.push(e)}onClose({event:e}){if(this.closeTries=0,this.cleanupWebSocket(),this.status===i.Connected&&(this.status=i.Disconnected,this.emit("status",{status:i.Disconnected}),this.emit("disconnect",{event:e})),e.code===r.hR.code&&(e.reason===r.hR.reason?console.warn("[HocuspocusProvider] An authentication token is required, but you didn’t send one. Try adding a `token` to your HocuspocusProvider configuration. Won’t try again."):console.warn(`[HocuspocusProvider] Connection closed with status Unauthorized: ${e.reason}`),this.shouldConnect=!1),e.code===r.cw.code&&!this.configuration.quiet)return void console.warn("[HocuspocusProvider] The provided authentication token isn’t allowed to connect to this server. Will try again.");e.code===r.cj.code&&(console.warn(`[HocuspocusProvider] Connection closed with status MessageTooBig: ${e.reason}`),this.shouldConnect=!1),this.connectionAttempt?this.rejectConnectionAttempt():this.shouldConnect&&this.connect(),this.shouldConnect||this.status!==i.Disconnected&&(this.status=i.Disconnected,this.emit("status",{status:i.Disconnected}),this.emit("disconnect",{event:e}))}destroy(){this.emit("destroy"),this.intervals.forceSync&&clearInterval(this.intervals.forceSync),clearInterval(this.intervals.connectionChecker),this.stopConnectionAttempt(),this.disconnect(),this.removeAllListeners(),this.cleanupWebSocket()}}let eH=(e,t)=>{ee(e,0),ei(e,a.FX(t))},eQ=(e,t,n)=>{ee(e,1),ei(e,a.PR(t,n))},eV=(e,t,n)=>eQ(t,n,ed(e)),eY=(e,t,n)=>{try{a.QE(t,ed(e),n)}catch(e){console.error("Caught error while handling a Yjs update",e)}},eW=(e,t)=>{ee(e,2),ei(e,t)},eq=(e,t,n,s)=>{let o=ep(e);switch(o){case 0:eV(e,t,n);break;case 1:case 2:eY(e,n,s);break;default:throw Error("Unknown message type")}return o};class eF{constructor(){this.encoder=J()}get(e){return e.encoder}toUint8Array(){return K(this.encoder)}}class ez{constructor(e){this.broadcasted=!1,this.message=e}setBroadcasted(e){return this.broadcasted=e,this}apply(e,t){let{message:n}=this,s=n.readVarUint(),i=n.length();switch(s){case o.Sync:this.applySyncMessage(e,t);break;case o.Awareness:this.applyAwarenessMessage(e);break;case o.Auth:this.applyAuthMessage(e);break;case o.QueryAwareness:this.applyQueryAwarenessMessage(e);break;case o.Stateless:e.receiveStateless(em(n.decoder));break;case o.SyncStatus:this.applySyncStatusMessage(e,1===eg(n.decoder));break;default:throw Error(`Can’t apply message of unknown type: ${s}`)}n.length()>i+1&&(this.broadcasted?e.broadcast(eF,{encoder:n.encoder}):e.send(eF,{encoder:n.encoder}))}applySyncMessage(e,t){let{message:n}=this;n.writeVarUint(o.Sync);let s=eq(n.decoder,n.encoder,e.document,e);t&&1===s&&(e.synced=!0)}applySyncStatusMessage(e,t){t&&e.decrementUnsyncedChanges()}applyAwarenessMessage(e){if(!e.awareness)return;let{message:t}=this;eR(e.awareness,t.readVarUint8Array(),e)}applyAuthMessage(e){let{message:t}=this;(0,r.gU)(t.decoder,e.permissionDeniedHandler.bind(e),e.authenticatedHandler.bind(e))}applyQueryAwarenessMessage(e){if(!e.awareness)return;let{message:t}=this;t.writeVarUint(o.Awareness),t.writeVarUint8Array(eL(e.awareness,Array.from(e.awareness.getStates().keys())))}}class eG{constructor(e,t={}){this.message=new e,this.encoder=this.message.get(t)}create(){return K(this.encoder)}send(e){null==e||e.send(this.create())}broadcast(e){eT(e,this.create())}}class eJ extends eF{constructor(){super(...arguments),this.type=o.Auth,this.description="Authentication"}get(e){if(void 0===e.token)throw Error("The authentication message requires `token` as an argument.");return es(this.encoder,e.documentName),ee(this.encoder,this.type),(0,r.OC)(this.encoder,e.token),this.encoder}}class eX extends eF{constructor(){super(...arguments),this.type=o.Awareness,this.description="Awareness states update"}get(e){let t;if(void 0===e.awareness)throw Error("The awareness message requires awareness as an argument");if(void 0===e.clients)throw Error("The awareness message requires clients as an argument");return es(this.encoder,e.documentName),ee(this.encoder,this.type),t=void 0===e.states?eL(e.awareness,e.clients):eL(e.awareness,e.clients,e.states),ei(this.encoder,t),this.encoder}}class eK extends eF{constructor(){super(...arguments),this.type=o.CLOSE,this.description="Ask the server to close the connection"}get(e){return es(this.encoder,e.documentName),ee(this.encoder,this.type),this.encoder}}class eZ extends eF{constructor(){super(...arguments),this.type=o.QueryAwareness,this.description="Queries awareness states"}get(e){return es(this.encoder,e.documentName),ee(this.encoder,this.type),this.encoder}}class e0 extends eF{constructor(){super(...arguments),this.type=o.Stateless,this.description="A stateless message"}get(e){var t;return es(this.encoder,e.documentName),ee(this.encoder,this.type),es(this.encoder,null!=(t=e.payload)?t:""),this.encoder}}class e1 extends eF{constructor(){super(...arguments),this.type=o.Sync,this.description="First sync step"}get(e){if(void 0===e.document)throw Error("The sync step one message requires document as an argument");return es(this.encoder,e.documentName),ee(this.encoder,this.type),eH(this.encoder,e.document),this.encoder}}class e2 extends eF{constructor(){super(...arguments),this.type=o.Sync,this.description="Second sync step"}get(e){if(void 0===e.document)throw Error("The sync step two message requires document as an argument");return es(this.encoder,e.documentName),ee(this.encoder,this.type),eQ(this.encoder,e.document),this.encoder}}class e8 extends eF{constructor(){super(...arguments),this.type=o.Sync,this.description="A document update"}get(e){return es(this.encoder,e.documentName),ee(this.encoder,this.type),eW(this.encoder,e.update),this.encoder}}class e3 extends Error{constructor(){super(...arguments),this.code=1001}}class e4 extends eB{constructor(e){var t,n,s;super(),this.configuration={name:"",document:void 0,awareness:void 0,token:null,parameters:{},broadcast:!0,forceSyncInterval:!1,onAuthenticated:()=>null,onAuthenticationFailed:()=>null,onOpen:()=>null,onConnect:()=>null,onMessage:()=>null,onOutgoingMessage:()=>null,onStatus:()=>null,onSynced:()=>null,onDisconnect:()=>null,onClose:()=>null,onDestroy:()=>null,onAwarenessUpdate:()=>null,onAwarenessChange:()=>null,onStateless:()=>null,quiet:!1,connect:!0,preserveConnection:!0},this.subscribedToBroadcastChannel=!1,this.isSynced=!1,this.unsyncedChanges=0,this.status=i.Disconnected,this.isAuthenticated=!1,this.authorizedScope=void 0,this.mux=eM(),this.intervals={forceSync:null},this.isConnected=!0,this.boundDocumentUpdateHandler=this.documentUpdateHandler.bind(this),this.boundAwarenessUpdateHandler=this.awarenessUpdateHandler.bind(this),this.boundBroadcastChannelSubscriber=this.broadcastChannelSubscriber.bind(this),this.boundPageHide=this.pageHide.bind(this),this.boundOnOpen=this.onOpen.bind(this),this.boundOnClose=this.onClose.bind(this),this.boundOnStatus=this.onStatus.bind(this),this.forwardConnect=e=>this.emit("connect",e),this.forwardOpen=e=>this.emit("open",e),this.forwardClose=e=>this.emit("close",e),this.forwardDisconnect=e=>this.emit("disconnect",e),this.forwardDestroy=e=>this.emit("destroy",e),this.setConfiguration(e),this.configuration.document=e.document?e.document:new a.JA,this.configuration.awareness=void 0!==e.awareness?e.awareness:new eI(this.document),this.on("open",this.configuration.onOpen),this.on("message",this.configuration.onMessage),this.on("outgoingMessage",this.configuration.onOutgoingMessage),this.on("synced",this.configuration.onSynced),this.on("destroy",this.configuration.onDestroy),this.on("awarenessUpdate",this.configuration.onAwarenessUpdate),this.on("awarenessChange",this.configuration.onAwarenessChange),this.on("stateless",this.configuration.onStateless),this.on("authenticated",this.configuration.onAuthenticated),this.on("authenticationFailed",this.configuration.onAuthenticationFailed),this.configuration.websocketProvider.on("connect",this.configuration.onConnect),this.configuration.websocketProvider.on("connect",this.forwardConnect),this.configuration.websocketProvider.on("open",this.boundOnOpen),this.configuration.websocketProvider.on("open",this.forwardOpen),this.configuration.websocketProvider.on("close",this.boundOnClose),this.configuration.websocketProvider.on("close",this.configuration.onClose),this.configuration.websocketProvider.on("close",this.forwardClose),this.configuration.websocketProvider.on("status",this.boundOnStatus),this.configuration.websocketProvider.on("disconnect",this.configuration.onDisconnect),this.configuration.websocketProvider.on("disconnect",this.forwardDisconnect),this.configuration.websocketProvider.on("destroy",this.configuration.onDestroy),this.configuration.websocketProvider.on("destroy",this.forwardDestroy),null==(t=this.awareness)||t.on("update",()=>{this.emit("awarenessUpdate",{states:(0,r.CV)(this.awareness.getStates())})}),null==(n=this.awareness)||n.on("change",()=>{this.emit("awarenessChange",{states:(0,r.CV)(this.awareness.getStates())})}),this.document.on("update",this.boundDocumentUpdateHandler),null==(s=this.awareness)||s.on("update",this.boundAwarenessUpdateHandler),this.registerEventListeners(),this.configuration.forceSyncInterval&&"number"==typeof this.configuration.forceSyncInterval&&(this.intervals.forceSync=setInterval(this.forceSync.bind(this),this.configuration.forceSyncInterval)),this.configuration.websocketProvider.attach(this)}onStatus({status:e}){this.status=e,this.configuration.onStatus({status:e}),this.emit("status",{status:e})}setConfiguration(e={}){!e.websocketProvider&&e.url&&(this.configuration.websocketProvider=new ej({url:e.url,connect:e.connect,parameters:e.parameters})),this.configuration={...this.configuration,...e}}get document(){return this.configuration.document}get awareness(){return this.configuration.awareness}get hasUnsyncedChanges(){return this.unsyncedChanges>0}resetUnsyncedChanges(){this.unsyncedChanges=1,this.emit("unsyncedChanges",this.unsyncedChanges)}incrementUnsyncedChanges(){this.unsyncedChanges+=1,this.emit("unsyncedChanges",this.unsyncedChanges)}decrementUnsyncedChanges(){this.unsyncedChanges-=1,0===this.unsyncedChanges&&(this.synced=!0),this.emit("unsyncedChanges",this.unsyncedChanges)}forceSync(){this.resetUnsyncedChanges(),this.send(e1,{document:this.document,documentName:this.configuration.name})}pageHide(){this.awareness&&ex(this.awareness,[this.document.clientID],"page hide")}registerEventListeners(){"undefined"!=typeof window&&"addEventListener"in window&&window.addEventListener("pagehide",this.boundPageHide)}sendStateless(e){this.send(e0,{documentName:this.configuration.name,payload:e})}documentUpdateHandler(e,t){t!==this&&(this.incrementUnsyncedChanges(),this.send(e8,{update:e,documentName:this.configuration.name},!0))}awarenessUpdateHandler({added:e,updated:t,removed:n},s){let o=e.concat(t).concat(n);this.send(eX,{awareness:this.awareness,clients:o,documentName:this.configuration.name},!0)}get synced(){return this.isSynced}set synced(e){this.isSynced!==e&&(this.isSynced=e,this.emit("synced",{state:e}),this.emit("sync",{state:e}))}receiveStateless(e){this.emit("stateless",{payload:e})}get isAuthenticationRequired(){return!!this.configuration.token&&!this.isAuthenticated}async connect(){return this.configuration.broadcast&&this.subscribeToBroadcastChannel(),this.configuration.websocketProvider.shouldConnect=!0,this.configuration.websocketProvider.attach(this)}disconnect(){this.disconnectBroadcastChannel(),this.configuration.websocketProvider.detach(this),this.isConnected=!1,this.configuration.preserveConnection||this.configuration.websocketProvider.disconnect()}async onOpen(e){let t;this.isAuthenticated=!1,this.isConnected=!0,this.emit("open",{event:e});try{t=await this.getToken()}catch(e){this.permissionDeniedHandler(`Failed to get token: ${e}`);return}this.isAuthenticationRequired&&this.send(eJ,{token:t,documentName:this.configuration.name}),this.startSync()}async getToken(){return"function"==typeof this.configuration.token?await this.configuration.token():this.configuration.token}startSync(){this.resetUnsyncedChanges(),this.send(e1,{document:this.document,documentName:this.configuration.name}),this.awareness&&null!==this.awareness.getLocalState()&&this.send(eX,{awareness:this.awareness,clients:[this.document.clientID],documentName:this.configuration.name})}send(e,t,n=!1){if(!this.isConnected)return;n&&this.mux(()=>{this.broadcast(e,t)});let s=new eG(e,t);this.emit("outgoingMessage",{message:s.message}),s.send(this.configuration.websocketProvider)}onMessage(e){let t=new e$(e.data),n=t.readVarString();t.writeVarString(n),this.emit("message",{event:e,message:new e$(e.data)}),new ez(t).apply(this,!0)}onClose(e){this.isAuthenticated=!1,this.synced=!1,this.awareness&&ex(this.awareness,Array.from(this.awareness.getStates().keys()).filter(e=>e!==this.document.clientID),this)}destroy(){this.emit("destroy"),this.intervals.forceSync&&clearInterval(this.intervals.forceSync),this.awareness&&(ex(this.awareness,[this.document.clientID],"provider destroy"),this.awareness.off("update",this.boundAwarenessUpdateHandler),this.awareness.destroy()),this.document.off("update",this.boundDocumentUpdateHandler),this.removeAllListeners(),this.configuration.websocketProvider.off("connect",this.configuration.onConnect),this.configuration.websocketProvider.off("connect",this.forwardConnect),this.configuration.websocketProvider.off("open",this.boundOnOpen),this.configuration.websocketProvider.off("open",this.forwardOpen),this.configuration.websocketProvider.off("close",this.boundOnClose),this.configuration.websocketProvider.off("close",this.configuration.onClose),this.configuration.websocketProvider.off("close",this.forwardClose),this.configuration.websocketProvider.off("status",this.boundOnStatus),this.configuration.websocketProvider.off("disconnect",this.configuration.onDisconnect),this.configuration.websocketProvider.off("disconnect",this.forwardDisconnect),this.configuration.websocketProvider.off("destroy",this.configuration.onDestroy),this.configuration.websocketProvider.off("destroy",this.forwardDestroy),this.send(eK,{documentName:this.configuration.name}),this.disconnect(),"undefined"!=typeof window&&"removeEventListener"in window&&window.removeEventListener("pagehide",this.boundPageHide)}permissionDeniedHandler(e){this.emit("authenticationFailed",{reason:e}),this.isAuthenticated=!1,this.disconnect(),this.status=i.Disconnected}authenticatedHandler(e){this.isAuthenticated=!0,this.authorizedScope=e,this.emit("authenticated")}get broadcastChannel(){return`${this.configuration.name}`}broadcastChannelSubscriber(e){this.mux(()=>{let t=new e$(e),n=t.readVarString();t.writeVarString(n),new ez(t).setBroadcasted(!0).apply(this,!1)})}subscribeToBroadcastChannel(){this.subscribedToBroadcastChannel||(eO(this.broadcastChannel,this.boundBroadcastChannelSubscriber),this.subscribedToBroadcastChannel=!0),this.mux(()=>{this.broadcast(e1,{document:this.document,documentName:this.configuration.name}),this.broadcast(e2,{document:this.document,documentName:this.configuration.name}),this.broadcast(eZ,{document:this.document,documentName:this.configuration.name}),this.awareness&&this.broadcast(eX,{awareness:this.awareness,clients:[this.document.clientID],document:this.document,documentName:this.configuration.name})})}disconnectBroadcastChannel(){this.awareness&&this.send(eX,{awareness:this.awareness,clients:[this.document.clientID],states:new Map,documentName:this.configuration.name},!0),this.subscribedToBroadcastChannel&&(eE(this.broadcastChannel,this.boundBroadcastChannelSubscriber),this.subscribedToBroadcastChannel=!1)}broadcast(e,t){this.configuration.broadcast&&this.subscribedToBroadcastChannel&&new eG(e,t).broadcast(this.broadcastChannel)}setAwarenessField(e,t){if(!this.awareness)throw new e3(`Cannot set awareness field "${e}" to ${JSON.stringify(t)}. You have disabled Awareness for this provider by explicitly passing awareness: null in the provider configuration.`);this.awareness.setLocalStateField(e,t)}}crypto.getRandomValues.bind(crypto)}}]);
//# sourceMappingURL=4728-a0acc685543f72b3.js.map