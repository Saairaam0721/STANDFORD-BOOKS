"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[925],{5291:(e,t,n)=>{n.d(t,{b9:()=>h,go:()=>u,iJ:()=>c,iO:()=>p});var a=n(55729),o=n(22275),r=n(15342),i=n(86497),l=n(45400),s=n(34647),d=n(25991);let c=()=>{let e=(0,a.useRef)("unsynced"),t=(0,r.CU)(),n=(0,i.O)(),s=(0,a.useCallback)(async(a,o,r)=>{if((0,d.yy)(t.getState())||n){if("unsynced"!==e.current)return void console.warn("Cannot load doc from cache when it is already ".concat(e.current));await (0,l.f)().loadYDoc(a,o)&&(e.current="loaded",r())}},[n,t]),c=(0,a.useCallback)((a,r)=>{if(!((0,d.yy)(t.getState())||n))return;let i=(0,o.S)();if("unsynced"!==e.current)return void console.warn("Cannot sync doc to cache when it is already ".concat(e.current));i&&(0,l.f)().syncYDoc(a,r)},[n,t]);return(0,a.useMemo)(()=>({loadYDoc:s,syncYDoc:c}),[s,c])},u=()=>{let e=(0,r.jL)(),t=(0,r.CU)();return(0,a.useCallback)(function(n){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date().toISOString();(0,d.yy)(t.getState())&&e((0,d.KT)({docIds:n,lastSynced:a}))},[e,t])},p=()=>{let e=(0,r.jL)(),t=(0,r.CU)();return(0,a.useCallback)(function(n){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date().toISOString();if((0,d.yy)(t.getState()))return e((0,d.yK)({docId:n,lastSynced:a}))},[e,t])},h=()=>(0,a.useMemo)(()=>(0,s.S)(),[])},12733:(e,t,n)=>{let a,o;n.d(t,{W:()=>d});var r=n(55729),i=n(91938),l=n(68301),s=n(15342);Promise.all([n.e(6935),n.e(9978)]).then(n.bind(n,12504)).then(e=>{a=e.applyDevTools,o=e.removeDevTools});let d=e=>{let t=(0,s.GV)(l.Ew);(0,r.useEffect)(()=>{if(e){if(t){console.debug("[Prosemirror DevTools] Activating prosemirror-dev-tools");try{a(e.view)}catch(e){}}else try{o()}catch(e){}return i.$.DEBUG_ENABLED&&(window.openPMDT=()=>a(e.view)),()=>{o(),delete window.openPMDT}}},[e,t])}},20925:(e,t,n)=>{n.d(t,{H2:()=>r$,bw:()=>nQ.b,u5:()=>r3.u,k5:()=>r1,HC:()=>r0,f$:()=>r2});var a=n(97255);a.Lz.prototype.updateState=function(e){this.docView&&this.updateStateInner(e,this.state.plugins!=e.plugins)};var o=n(6029),r=n(26420),i=n(53996),l=n(26385),s=n(3276),d=n(48810),c=n(40510),u=n(90865),p=n(39891),h=n(55729),g=n(57067),m=n(41797),f=n(91938),y=n(35292),v=n(82328),b=n(40452),w=n(58959),x=n(57405),I=n(74676),C=n(77364),S=n(47412),k=n(19564),A=n(37243),T=n(35946),z=n(46898),P=n(49611),E=n(99492),j=n(48621),M=n(77650),R=n(58495),D=n(33787),B=n(23293),L=n(99038),_=n(12258);let N=(0,h.memo)(()=>(0,o.jsx)(b.s,{direction:"column",height:"100%",justifyContent:"flex-end",children:(0,o.jsxs)(l.B,{spacing:6,alignItems:"center",p:4,borderRadius:"lg",textAlign:"center",children:[(0,o.jsx)(D._,{src:_.A.src,alt:"Empty state",maxW:"200px"}),(0,o.jsxs)(l.B,{spacing:1,children:[(0,o.jsx)(B.D,{size:"sm",fontWeight:"semibold",children:(0,o.jsx)(k.x6,{id:"EVnzPs"})}),(0,o.jsx)(d.E,{color:"gray.600",fontSize:"sm",children:(0,o.jsx)(k.x6,{id:"iaCYkN",values:{GAMMA_ARTIFACT_PROPER_NOUN:L.TP}})})]})]})}));N.displayName="BuddyChatEmptyState";var O=n(70965),F=n(85942),U=n(66380),H=n(15342),q=n(87291),V=n(7554),W=n(43634),G=n(47956);let J=()=>{let e=(0,H.CU)(),t=(0,H.GV)(G.eb),n=(0,H.GV)(W.SJ),a=(0,U.V)(),o=(0,q.d)(),r=(0,h.useCallback)(t=>{let n=(0,V.ST)(e.getState()).find(e=>e.id===t);n&&o(n)},[o,e]);return{editor:t,store:e,theme:n,imageOptions:{imageProvider:a.imageProvider,imageModel:a.imageModel,imageStyle:a.imageStyle,visualsMenuEnabled:a.imageOptions.visualsMenuEnabled,artStylePreset:a.imageOptions.artStylePreset,artStylePrompt:a.imageOptions.artStylePrompt},applyTheme:r}};var K=n(49023),Y=n(42721),Q=n(87386),Z=n(81807),$=n(68469),X=n(80116),ee=n(83605),et=n(82592),en=n(47867),ea=n(92397),eo=n(61385),er=n(33201),ei=n(56603),el=n(63867),es=n(15607);let ed=(e,t)=>{let n=e.state.doc.content.content[0].content.content[0].attrs.id,a=e.state.doc.resolve(t),o=e.state.doc.nodeAt(t);if((null==o?void 0:o.type.name)==="card"&&1===a.depth)return o.attrs.id;let r=(0,es.Ft)(a,(e,t)=>"card"===e.type.name&&t<=eo.$x);return r?r.node.attrs.id:n},ec=(e,t)=>{let{top:n,bottom:a}=t.getBoundingClientRect(),{from:o,to:r}=e.state.selection,i=e.view.coordsAtPos(o),l=e.view.coordsAtPos(r),s=Math.min(i.top,l.top),d=Math.max(i.bottom,l.bottom),c=d-s;return d<n?{position:"above",overlap:0}:s>a?{position:"below",overlap:0}:s<n&&d<=a?{position:"startsAbove",overlap:(d-n)/c}:s>=n&&d>a?{position:"endsBelow",overlap:(a-s)/c}:s<n&&d>a?{position:"spansContainer",overlap:1}:{position:"within",overlap:1}},eu=(e,t)=>{let{selection:n}=e.state,{from:a,to:o}=n,{overlap:r}=ec(e,t);if(0===r)return;let i=n instanceof el.nh,l=!i,s=ed(e,a),d=e.state.doc.nodeAt(a);if((!i||!(r<.5))&&(!l||!(r<.33)))return i&&(null==d?void 0:d.type.name)==="card"?{type:"card",selectedCardId:s}:l&&o-a>5?{type:"text",selectionStartCardId:s,textSelection:e.state.doc.textBetween(a,o)}:{type:"none",cursorInCardId:s}},ep=e=>new Promise(t=>setTimeout(t,e));class eh{static applyResultVariation(e,t){let{editor:n,store:a}=e;eh.loadCheckpoint(e,t.toApplyCheckpointId,t.messageId),a.dispatch((0,G.rD)({messageId:t.messageId,variationId:t.id}))}static loadCheckpoint(e,t){var n;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,$.$)(),{editor:o,store:r}=e,i=(0,G.BV)(t)(r.getState());if(!i)throw Error("Cannot find checkpoint with id ".concat(t));o.commands.setContent(i.jsonContent,!0),null==(n=e.applyTheme)||n.call(e,i.themeId);let l=(0,W.SJ)(r.getState());(0,et.CP)({editor:o,rootNode:o.state.doc,theme:l,interactionId:a})}static async ensureCardInView(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=(0,en.H1)("editor"),o=document.querySelector((0,eo.OB)(t)),r=(0,en.cH)(o,500);(null==r||!r.yAxisInView)&&(a.scrollElementIntoView({element:o}),n>0&&await ep(n))}static focusResultVariation(e,t){let{editor:n}=e,a=t.scrollToCardId;if(!a)return;let o=eh.findCardById(n,a);setTimeout(()=>{eh.ensureCardInView(e,a),n.chain().selectInsideCardBody(o.pos).focus().run()},0)}static findCardById(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.findTopLevelCards(e).find(e=>e.cardId===t);if(!a)throw Error("Cannot find card with id ".concat(t));return n&&this.focusCard(e,a.pos),a}static checkCardById(e,t){let n=this.findTopLevelCards(e).find(e=>e.cardId===t);return n||null}static async removeCardById(e,t){let{cardId:n}=e,{editor:a}=t,o=eh.findCardById(a,n),r=null==o?void 0:o.pos,i=o?a.state.doc.nodeAt(o.pos):null;return!!r&&!!i&&(a.chain().deleteCard(r).run(),!0)}static async replaceCardHTMLById(e,t){let{cardId:n,cardHtml:a,messageId:o}=e,{editor:r,theme:i}=t,l=(0,Z.DB)(a),s=(0,ee.dE)(l),d=eh.findCardById(r,n),c=null==d?void 0:d.pos,u=d?r.state.doc.nodeAt(d.pos):null;if(!c||!u)return null;let p={from:c,to:c+u.nodeSize};return s.attrs.id=n,r.chain().setMeta("cardNotesHandled",!0).insertContentAt(p,s).selectInsideCardBody(c).run(),(0,et.Sg)({editor:r,content:s,theme:i,interactionId:o}),{oldHtml:a,newHtml:l,replaceRange:p}}static async replaceCardJSONById(e,t){let{cardId:n,cardJson:a,messageId:o}=e,{editor:r}=t,i=eh.findCardById(r,n),l=null==i?void 0:i.pos,s=i?r.state.doc.nodeAt(i.pos):null;if(!l||!s)return null;let d={from:l,to:l+s.nodeSize};return r.chain().setMeta("cardNotesHandled",!0).insertContentAt(d,a).selectInsideCardBody(l).run(),(0,et.Sg)({editor:r,content:a,theme:t.theme,interactionId:o}),{replaceRange:d}}static getCurrentFocusedCard(e,t){let n=e.state.selection,a=(0,ea.hT)(e.state.doc,n.from);if(!a)throw Error("Cannot find currently focused card");let o=a.node.attrs.id,r=this.findCardNum(e,o);return{cardId:o,cardNum:r,html:(0,X.KC)(e,a.node)}}static focusCard(e,t){e.chain().selectInsideCardBody(t).focus().scrollIntoView().run()}static getDeckInfo(e,t){let{editor:n,store:a}=e,o=(0,G.y3)(a.getState()),r=(0,en.H1)("editor"),i=document.querySelector(r.scrollSelector);if(!i)throw Error("Cannot find container element");let l=null==t?void 0:t.initiatingCardId,s=eu(n,i);return{docHtml:this.getDocHtml(n,{cardsInView:o,initiatingCardId:l,selection:s},16e4),cardsInView:o,initiatingCardId:l,selection:s}}static getDocHtml(e,t,n){let a=this.findTopLevelCards(e),o=a.map(e=>e.cardHtml).join("\n"),r=em(o='<div class="gamma-doc">'.concat(o,"</div>"));if(console.debug("[buddy] allHtml estTokens: ".concat(r)),r<n)return{type:"full",content:o};console.debug("[buddy] getting partial docHtml");let i=new eg(a,n);if(t.cardsInView.length>0)for(let{cardId:n}of t.cardsInView){let t=this.findCardById(e,n);i.add(n,t.cardHtml)}if(t.selection){let n;if(n="card"===t.selection.type?t.selection.selectedCardId:"text"===t.selection.type?t.selection.selectionStartCardId:t.selection.cursorInCardId){let t=this.findCardById(e,n);i.add(n,t.cardHtml)}}return i.docHtml()}static findTopLevelCards(e){return(0,A.xe)(e.state.doc,e=>(0,er.jg)(e)).filter(t=>1===e.state.doc.resolve(t.pos).depth).map((t,n)=>({pos:t.pos,node:t.node,cardNum:n+1,cardId:t.node.attrs.id,cardJson:t.node.toJSON(),cardHtml:(0,X.KC)(e,t.node)}))}static findCardNum(e,t){let n=this.findTopLevelCards(e).find(e=>e.cardId===t);if(!n)throw Error("Cannot find card with id ".concat(t));return n.cardNum}static findCreateCardInsertRange(e,t){let n=this.findTopLevelCards(e),a=t-1,o=n[a];if(a>=n.length){let t=n.length-1,a=e.state.doc.nodeAt(n[t].pos),o=n[t].pos+a.nodeSize;return{from:o,to:o,relativeRange:{from:(0,ei.JO)(e.state,o),to:(0,ei.JO)(e.state,o)}}}if(!o)throw Error("Cannot find card with index ".concat(a));return{from:o.pos,to:o.pos,relativeRange:{from:(0,ei.JO)(e.state,o.pos),to:(0,ei.JO)(e.state,o.pos)}}}static findCardInsertRange(e,t,n){let a=this.findCardById(e,t);if(!a)throw Error("Cannot find card with id ".concat(t));if("before"===n)return{from:a.pos,to:a.pos,relativeRange:{from:(0,ei.JO)(e.state,a.pos),to:(0,ei.JO)(e.state,a.pos)}};{let t=a.pos+a.node.nodeSize;return{from:t,to:t,relativeRange:{from:(0,ei.JO)(e.state,t),to:(0,ei.JO)(e.state,t)}}}}}eh.DEFAULT_APPLIED_FIRST_POS=2;class eg{add(e,t){let n=em(t);return!this.cardsToPopulate.has(e)&&!(this.curLen+n>this.maxTokens)&&(this.cardsToPopulate.set(e,t),this.curLen+=n,!0)}docHtml(){return{type:"partial",content:this.outline.map(e=>({cardId:e.cardId,title:e.title,cardHtml:this.cardsToPopulate.get(e.cardId)}))}}constructor(e,t){this.maxTokens=t,this.curLen=0,this.outline=[],this.cardsToPopulate=new Map,this.outline=e.map(e=>{var t;return{cardId:e.cardId,title:null!=(t=(0,Q.getCardTitle)(e.cardJson))?t:"none",cardHtml:e.cardHtml}})}}function em(e){return e.length/3.5}var ef=n(34832),ey=n(13559),ev=n(47665);class eb{current(){return this._cardIds[this.index]}take(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;return this._cardIds.slice(this.index,this.index+e)}goto(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this._cardIds.findIndex(t=>t===e);return -1===n&&(this.index=0),n+t<0?this.index=0:n+t>this._cardIds.length-1?this.index=this._cardIds.length-1:this.index=n+t,this}scrollAndSelect(e){let t=this.current();eh.ensureCardInView({editor:e},t);let n=(0,ev.W0)(e,t);n&&e.chain().selectInsideCardBody(n.pos).focus().run()}constructor(e){this._cardIds=e,this.index=0}}let ew=e=>new eb((0,A.xe)(e.state.doc,e=>(0,ev.jg)(e)).filter(t=>1===e.state.doc.resolve(t.pos).depth).map(e=>{var t;return null==(t=e.node.attrs)?void 0:t.id}));class ex{get id(){return this.input.toolCallId}getOriginalPreviewCardIds(e){return ew(e.editor).goto(this.input.cardId,-1).take(3)}getModifiedPreviewCardIds(e){return ew(e.editor).goto(this.input.cardId,-1).take(3)}originalCardToSelect(){return this.input.cardId}modifiedCardToSelect(){return this.input.cardId}async apply(e){let{editor:t}=e,n=(0,ev.W0)(t,this.cardId);if(!n)throw Error("Cannot find card with id ".concat(this.cardId));let a=(0,ev.W0)(t,this.input.movePositionCardId);if(!a)throw Error("Cannot find target position card with id ".concat(this.input.movePositionCardId));t.chain().rearrangeCards({from:n.pos,to:a.pos,position:"after"===this.input.movePosition?"below":"above"}).selectInsideCardBody(n.pos).scrollIntoView().run(),setTimeout(()=>{eh.ensureCardInView(e,this.cardId)},200)}async rollback(e){throw Error("Rollback not implemented")}getAppliedFirstPos(e){var t,n;return null!=(n=null==(t=eh.findTopLevelCards(e.editor).find(e=>e.cardId===this.cardId))?void 0:t.pos)?n:eh.DEFAULT_APPLIED_FIRST_POS}serialize(){return{type:this.type,input:this.input}}constructor(e){this.input=e,this.type="moveCard",this.previewType="doc",this.messageId=e.messageId,this.cardId=e.cardId}}var eI=n(68301),eC=n(43182),eS=n(3383);async function ek(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"full",n=await fetch("".concat(f.$.API_HOST,"/ai/tools/read-url"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e,mode:t,workspaceId:(0,Y.gx)()}),credentials:"include"});if(!n.ok)throw Error((await n.json().catch(()=>({}))).message||"HTTP ".concat(n.status));let a=await n.json();return"summary"===t?{url:e,title:a.title||"Unknown",content:a.summary||"",mode:"summary",publishedDate:a.publishedDate,author:a.author}:{url:e,title:a.title||"Unknown",content:a.content||"",mode:"full",metadata:a.metadata||{}}}async function eA(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=await fetch("".concat(f.$.API_HOST,"/ai/tools/search-web"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e,numResults:t,type:"keyword",text:{maxCharacters:2e3}}),credentials:"include"});if(!n.ok)throw Error((await n.json().catch(()=>({}))).message||"HTTP ".concat(n.status));let a=await n.json();return{query:e,numResults:a.length,results:a.map(e=>({id:e.id,title:e.title,url:e.url,text:e.text||"",publishedDate:e.publishedDate,author:e.author}))}}class eT{get id(){return this.input.toolCallId}async apply(e){let{editor:t}=e,n=eh.findCardInsertRange(t,this.input.createPositionCardId,this.input.createPosition);eh.checkCardById(t,this.cardId)||(t.chain().insertContentAt(n,this.cardJson).selectInsideCardBody(n.from).scrollIntoView().run(),(0,et.Sg)({editor:t,content:this.cardJson,theme:e.theme,interactionId:this.messageId}),setTimeout(()=>{eh.ensureCardInView(e,this.cardId)},200))}async rollback(e){eh.removeCardById({cardId:this.cardId},e)}getAppliedFirstPos(e){var t,n;return null!=(n=null==(t=eh.findTopLevelCards(e.editor).find(e=>e.cardId===this.cardId))?void 0:t.pos)?n:eh.DEFAULT_APPLIED_FIRST_POS}getOriginalPreviewCardIds(e){let{createPositionCardId:t,createPosition:n}=this.input;return ew(e.editor).goto(t,"before"===n?-1:0).take(3)}getModifiedPreviewCardIds(e){return ew(e.editor).goto(this.cardId,-1).take(3)}originalCardToSelect(e){let{createPositionCardId:t,createPosition:n}=this.input;return ew(e.editor).goto(t,"before"===n?-1:0).current()}modifiedCardToSelect(){return this.cardId}serialize(){return{type:this.type,input:this.input}}constructor(e){var t;this.input=e,this.type="createCard",this.previewType="doc",this.messageId=e.messageId,this.cardJson=this.input.cardJson,this.cardId=null==(t=this.cardJson.attrs)?void 0:t.id}}var ez=n(9922),eP=n.n(ez);class eE{get id(){return this.input.toolCallId}async apply(e){let{editor:t}=e,n=eh.findCardById(t,this.cardId);if(!n)throw Error("Cannot find card to duplicate with id ".concat(this.cardId));let a=eP()(n.cardJson);a.attrs.id=this.duplicatedCardId;let o=eh.findCardInsertRange(t,this.insertPositionCardId,this.insertPosition);t.chain().insertContentAt(o.from,a,{updateSelection:!1}).run(),setTimeout(()=>{eh.ensureCardInView(e,this.duplicatedCardId)},200)}async rollback(e){let{editor:t}=e;try{let e=eh.findCardById(t,this.duplicatedCardId);e&&t.commands.deleteCard(e.pos)}catch(e){console.warn("Could not find duplicated card by ID for rollback",e)}}getAppliedFirstPos(e){try{return eh.findCardById(e.editor,this.duplicatedCardId).pos}catch(e){return eh.DEFAULT_APPLIED_FIRST_POS}}getOriginalFirstPos(e){return eh.findCardById(e.editor,this.cardId).pos}getOriginalPreviewCardIds(e){return ew(e.editor).goto(this.cardId,-1).take(3)}getModifiedPreviewCardIds(e){return ew(e.editor).goto(this.duplicatedCardId,-1).take(3)}originalCardToSelect(){return this.cardId}modifiedCardToSelect(){return this.duplicatedCardId}serialize(){return{type:this.type,input:this.input}}constructor(e){this.input=e,this.type="duplicateCard",this.previewType="doc",this.messageId=e.messageId,this.cardId=e.cardId,this.duplicatedCardId=e.duplicatedCardId,this.insertPositionCardId=e.insertPositionCardId,this.insertPosition=e.insertPosition}}class ej{async apply(e){for(let t of this.input.editedCardJsons){let n=t.attrs.id;if(!n){console.error("[EditAllCardsSuggestion] Card has no id");continue}eh.replaceCardJSONById({cardId:n,cardJson:t,messageId:this.messageId},e)}}async rollback(e){for(let t of this.input.originalCardJsons){let n=t.attrs.id;if(!n){console.error("[EditAllCardsSuggestion] Card has no id");continue}eh.replaceCardJSONById({cardId:n,cardJson:t,messageId:this.messageId},e)}}getAppliedFirstPos(){return 0}getOriginalPreviewCardIds(e){return ew(e.editor).take(3)}getModifiedPreviewCardIds(e){return ew(e.editor).take(3)}originalCardToSelect(e){return ew(e.editor).current()}modifiedCardToSelect(e){return ew(e.editor).current()}serialize(){return{type:this.type,input:this.input}}constructor(e){this.input=e,this.type="editAllCards",this.previewType="doc",this.messageId=e.messageId,this.id=this.input.toolCallId}}class eM{async apply(e){await eh.ensureCardInView(e,this.cardId,1e3),eh.replaceCardJSONById({cardId:this.cardId,cardJson:this.input.editedCardJson,messageId:this.messageId},e)}async rollback(e){eh.replaceCardJSONById({cardId:this.cardId,cardJson:this.input.originalCardJson,messageId:this.messageId},e)}getAppliedFirstPos(e){let t=(0,ev.W0)(e.editor,this.cardId);return t?t.pos:(console.error("[EditCardSuggestion] Cannot find card with id",this.cardId),eh.DEFAULT_APPLIED_FIRST_POS)}getOriginalPreviewCardIds(e){return ew(e.editor).goto(this.cardId).take(3)}getModifiedPreviewCardIds(e){return ew(e.editor).goto(this.cardId).take(3)}originalCardToSelect(){return this.cardId}modifiedCardToSelect(){return this.cardId}serialize(){return{type:this.type,input:this.input}}constructor(e){this.input=e,this.type="editCardById",this.previewType="card",this.messageId=e.messageId,this.id=this.input.toolCallId,this.cardId=this.input.cardId}}let eR=(e,t)=>{let n=t.findIndex(t=>e.includes(t));return t[n]};class eD{async apply(e){let{editor:t}=e,{cardIds:n}=this.input;await eh.ensureCardInView(e,n[0],1e3),t.chain().command(e=>{let{tr:a}=e;return n.forEach(e=>{let n=eh.findCardById(t,e);if(!n)throw Error("Cannot find card with id ".concat(e));let{pos:o}=n,r=t.state.doc.nodeAt(o),i=o+r.nodeSize;a.deleteRange(a.mapping.map(o),a.mapping.map(i))}),!0}).run()}async rollback(e){let{editor:t,store:n}=e,a=this.input.originalAllCardIds.map(e=>{let t=this.input.removedCardJson[e];return t?{id:e,removed:!0,content:t}:{id:e,removed:!1,content:null}});for(let[e,n]of Object.entries(a)){if(!n.removed)continue;if("0"===e){t.chain().insertContentAt({from:1,to:1},n.content).run();continue}let o=a[Number(e)-1].id,r=eh.findCardInsertRange(t,o,"after");t.chain().insertContentAt(r,n.content).run()}}getAppliedFirstPos(e){let t=eh.findCardById(e.editor,this.cardBeforeFirstRemovedCard);return t?t.pos+t.node.nodeSize:this.firstPos}getOriginalPreviewCardIds(e){return ew(e.editor).goto(this.firstRemovedCardId,-1).take(3)}getModifiedPreviewCardIds(e){return ew(e.editor).goto(this.cardBeforeFirstRemovedCard).take(3)}originalCardToSelect(){return this.firstRemovedCardId}modifiedCardToSelect(){return this.cardBeforeFirstRemovedCard}get id(){return this.input.toolCallId}serialize(){return{type:"removeCards",input:this.input}}constructor(e){this.input=e,this.type="removeCards",this.previewType="doc",this.firstPos=1,this.messageId=e.messageId,this.firstRemovedCardId=eR(e.cardIds,e.originalAllCardIds);let t=this.input.originalAllCardIds,n=t.findIndex(e=>e===this.firstRemovedCardId);if(this.cardBeforeFirstRemovedCard=t[n-1],!this.cardBeforeFirstRemovedCard){var a;let n=t.findIndex(t=>!e.cardIds.includes(t));this.cardBeforeFirstRemovedCard=null!=(a=t[n])?a:t[0]}}}let eB=e=>{var t,n,a,o,r,i,l,s,d,c,u,p,h;let g=(null==(n=e.config)||null==(t=n.keywords)?void 0:t.color.slice(0,4))||[],m=(null==(o=e.config)||null==(a=o.keywords)?void 0:a.tone.slice(0,5))||[],f=[e.bodyFont,e.headingFont].filter(Boolean);return{id:e.id,name:e.name?e.name:null,accent:e.accentColor?e.accentColor:null,background:(null==(i=e.config)||null==(r=i.background)?void 0:r.type)==="color"?null==(s=e.config)||null==(l=s.background.color)?void 0:l.hex:null,bodyColor:(null==(d=e.config)?void 0:d.bodyColor)?e.config.bodyColor:null,headingColor:(null==(c=e.config)?void 0:c.headingColor)?e.config.headingColor:null,cardColor:(null==(h=e.config)||null==(p=h.cardBackground)||null==(u=p.color)?void 0:u.hex)?e.config.cardBackground.color.hex:null,fonts:f.length>0?f.join(", "):null,keywords:[...g,...m].join(" ")}},eL={focusCardById:{execute:async function(e,t){let{cardId:n}=e,{editor:a}=t,o=eh.findCardById(a,n);eh.focusCard(a,o.pos);let{cardNum:r}=o;return{status:"success",cardNum:r,cardId:n}}},removeCards:{execute:async function(e,t,n,a){let{cardIds:o}=e,{editor:r,store:i}=t,l=eh.findTopLevelCards(r),s=l.map(e=>e.cardId),d=l.reduce((e,t)=>(o.includes(t.cardId)&&(e[t.cardId]=t.cardJson),e),{}),c=new eD({toolCallId:n.toolCallId,messageId:a,cardIds:o,originalAllCardIds:s,removedCardJson:d});return await c.apply(t),i.dispatch((0,G.Ed)(c)),{status:"success",removedCardIds:o,suggestionId:c.id}}},editCardById:{execute:async function(e,t,n,a){let{editor:o,store:r,imageOptions:i}=t,{instructions:l,cardId:s}=e,d=eh.findTopLevelCards(o),c=d.findIndex(e=>e.cardId===s),u=d[c];if(!u)throw Error("Cannot find card with id ".concat(s));let p=c>0?d[c-1].cardHtml:void 0,h=(0,ey.h)(o,r),g=await (0,ef.K8)({promptKey:"EditCardWithLayout",variables:{previousHtml:p,request:l,inputHtml:u.cardHtml,imageProvider:i.imageProvider,imageOptions:{model:i.imageModel,stylePrompt:i.imageStyle,visualsMenuEnabled:i.visualsMenuEnabled,artStylePreset:i.artStylePreset,artStylePrompt:i.artStylePrompt},...h,outline:"",basePromptKey:eI.of.get("editCardPrompt"),model:eI.of.get("editCardModel")},workspaceId:(0,Y.gx)(),opts:{abortController:t.abortController}}),m=(0,Z.DB)(g),f=(0,ee.dE)(m),y=new eM({messageId:a,toolCallId:n.toolCallId,originalCardJson:u.cardJson,editedCardJson:f,cardId:s});return await y.apply(t),r.dispatch((0,G.Ed)(y)),{status:"success",cardId:s,beforeHtml:u.cardHtml,afterHtml:m,suggestionId:y.id}}},editAllCards:{execute:async function(e,t,n,a){let{instructions:o}=e,{editor:r,store:i,imageOptions:l}=t,s=eh.findTopLevelCards(r);if(0===s.length)return{status:"success",editedCards:[]};let d=(0,ey.h)(r,i),c=[];s.forEach(e=>{c.push(e.cardHtml)});let u=c.join(),p=await (0,ef.K8)({promptKey:"EditCardParallel",variables:{inputHtml:u,request:o,imageOptions:{model:l.imageModel,stylePrompt:l.imageStyle},imageProvider:l.imageProvider,...d,outline:"",model:eI.of.get("editCardModel"),reasoningEffort:eI.of.get("editCardReasoningEffort"),basePromptKey:eI.of.get("editCardParallelPrompt")},workspaceId:(0,Y.gx)(),opts:{abortController:t.abortController}}),h=(0,Z.dg)(p);if(h.length!==s.length)throw Error("Mismatch in number of cards returned from AI");let g=s.map(e=>e.cardJson),m=h.map(e=>(0,ee.dE)(e)),f=new ej({toolCallId:n.toolCallId,messageId:a,originalCardJsons:g,editedCardJsons:m});return await f.apply(t),i.dispatch((0,G.Ed)(f)),{status:"success",suggestionId:f.id}}},createCard:{execute:async function(e,t,n,a){let o,{editor:r,store:i,imageOptions:l}=t,{createPosition:s,createPositionCardId:d,...c}=e,u=eh.findCardInsertRange(r,d,s),p=(0,ey.h)(r,i),h=(0,eS.ze)(r,u.from),{templateCardId:g,...m}=e;if(g){let e=eh.findCardById(r,g);e&&(o=e.cardHtml)}let f=await (0,ef.K8)({promptKey:"GenerateCardWithLayout",variables:{...m,templateText:o,imageProvider:l.imageProvider,imageOptions:{model:l.imageModel,stylePrompt:l.imageStyle,visualsMenuEnabled:l.visualsMenuEnabled,artStylePreset:l.artStylePreset,artStylePrompt:l.artStylePrompt},...p,outline:"",previous:h},workspaceId:(0,Y.gx)(),opts:{abortController:t.abortController}}),y=(0,ee.dE)(f),v=y.attrs.id,b=new eT({messageId:a,toolCallId:n.toolCallId,cardId:v,cardJson:y,createPositionCardId:d,createPosition:s});return await b.apply(t),i.dispatch((0,G.Ed)(b)),{status:"success",newCardId:v,newCardHtml:f,createPositionCardId:d,createPosition:s,suggestionId:b.id}}},setCardHtml:{execute:async function(e,t,n,a){let{cardId:o,cardHtml:r}=e,{editor:i,store:l}=t;if(!eh.findCardById(i,o))throw Error("Cannot find card with id ".concat(o));return eh.replaceCardHTMLById({cardId:o,cardHtml:r,messageId:a},t),{status:"success",cardId:o,cardHtml:r}}},moveCard:{execute:async function(e,t,n,a){let{cardId:o,movePositionCardId:r,movePosition:i}=e,{store:l}=t,s=new ex({toolCallId:n.toolCallId,messageId:a,cardId:o,movePositionCardId:r,movePosition:i});return await s.apply(t),l.dispatch((0,G.Ed)(s)),{status:"success",suggestionId:s.id}}},duplicateCard:{execute:async function(e,t,n,a){let{store:o}=t,{cardId:r,insertPositionCardId:i,insertPosition:l}=e,s=eC.Yv.generate(),d=new eE({toolCallId:n.toolCallId,messageId:a,cardId:r,duplicatedCardId:s,insertPositionCardId:i,insertPosition:l});return d.apply(t),o.dispatch((0,G.Ed)(d)),{status:"success",originalCardId:r,duplicatedCardId:s,insertPositionCardId:i,insertPosition:l,suggestionId:d.id}}},revertToCheckpoint:{execute:async function(e,t,n,a){let{store:o}=t,{beforeCheckpointId:r}=e;return eh.loadCheckpoint(t,r),{status:"success",revertedToCheckpointId:r}}},suggestThemes:{execute:async function(e,t,n,a){let{store:o}=t,r=(0,W.SJ)(o.getState()),i=(0,V.ST)(o.getState()).map(eB).filter(e=>e.id!==r.id),l=eh.getDeckInfo(t),s=await (0,ef.K8)({promptKey:"SuggestThemes",variables:{docHtml:JSON.stringify(l.docHtml.content),allThemes:i,userRequest:e.userRequest},workspaceId:(0,Y.gx)(),opts:{abortController:t.abortController}}),d=JSON.parse((0,Z.DB)(s)).themes.map((e,t)=>{let{id:n,name:a}=e;return{themeId:n,themeName:a}}).filter(e=>!!i.find(t=>t.id===e.themeId)),c={themeId:r.id,themeName:r.name,wasOriginal:!0};if(d[0]){var u;null==(u=t.applyTheme)||u.call(t,d[0].themeId)}return{status:"success",suggestedThemes:[c,...d],beforeThemeId:c.themeId}}},readUrl:{execute:async function(e){let{url:t,mode:n="full"}=e;return{status:"success",...await ek(t,n)}}},webSearch:{execute:async function(e){let{query:t,numResults:n=5}=e;return{status:"success",...await eA(t,n)}}}},e_=(0,R.d_)("1234567890abcdefghijklmnopqrstuvwxyz",8),eN=(e,t)=>({id:e_(),jsonContent:e.state.doc.toJSON(),themeId:t,timestamp:new Date().toISOString()}),eO=()=>{let e=(0,H.jL)(),t=(0,H.CU)(),n=J();return(0,h.useCallback)(()=>{let{editor:a}=n,o=(0,G.KF)(t.getState());if(!o)throw Error("No rolling back state");let r=(0,G.BV)(o.currentCheckpointId)(t.getState());if(!r)throw Error("No checkpoint exists with id ".concat(o.currentCheckpointId));e((0,G.rY)()),eh.loadCheckpoint(n,r.id)},[n,e,t])},eF=e=>{let t=(0,H.jL)(),n=(0,H.CU)(),a=J();return(0,h.useCallback)(o=>{let{editor:r}=a;if(!r)return;let i=e.findIndex((e,t)=>e.id===o.id);if(-1===i)throw Error("Cannot find message with id ".concat(o.id));let l=eN(r,(0,W.SJ)(n.getState()).id);t((0,G.AY)(l));let s=(0,G.fN)(o.id)(n.getState());if(!s)throw Error("Cannot find message result");if("applied-changes"!==s.type)throw Error("Cannot rollback non-applied-changes result");let d=(0,G.GL)(s.messageId)(n.getState());if(!d)throw Error("Cannot find applied variation");let c=s.variations.find(e=>e.id===d);if(!c)throw Error("Cannot find applied variation");eh.applyResultVariation(a,c),t((0,G.LU)({messageIndex:i,resultId:s.messageId,currentCheckpointId:l.id,chosenVariationId:c.id}))},[a,t,e,n])};var eU=n(12364),eH=n.n(eU),eq=n(85011);let eV=function(){let{onStart:e,onEnd:t,onUpdate:n,element:a=null,endDelay:o=250,updateThrottle:r=100}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,h.useRef)(!1),l=(0,h.useRef)(null),s=(0,h.useRef)(null),d=(0,h.useRef)(0),c=(0,h.useRef)(!1);(0,h.useEffect)(()=>{c.current="onscrollend"in window},[]);let u=(0,h.useCallback)(()=>{let e=Date.now(),t=e-d.current;t>=r?(d.current=e,null==n||n()):(s.current&&clearTimeout(s.current),s.current=setTimeout(()=>{d.current=Date.now(),null==n||n()},r-t))},[n,r]),p=(0,h.useCallback)(()=>{i.current||(i.current=!0,null==e||e())},[e]),g=(0,h.useCallback)(()=>{l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{i.current&&(i.current=!1,null==t||t())},o)},[t,o]),m=(0,h.useCallback)(()=>{p(),n&&u(),c.current||g()},[p,g,u,n]),f=(0,h.useCallback)(()=>{i.current&&(i.current=!1,null==t||t())},[t]);return(0,h.useEffect)(()=>{if(a)return a.addEventListener("scroll",m,{passive:!0}),c.current&&a.addEventListener("scrollend",f,{passive:!0}),()=>{a.removeEventListener("scroll",m),c.current&&a.removeEventListener("scrollend",f),l.current&&clearTimeout(l.current),s.current&&clearTimeout(s.current)}},[a,m,f]),{isScrolling:i.current,supportsScrollEnd:c.current}};var eW=n(85235),eG=n(23460);let eJ=(e,t)=>e.length===t.length&&e.every((e,n)=>e.cardId===t[n].cardId&&e.pos===t[n].pos&&e.inView===t[n].inView),eK=e=>{let t=e.filter(e=>e.overlap>=.6);if(0===t.length)return[];if(0===t.filter(e=>e.overlap>.6).length){let e=t.reduce((e,t)=>e.overlap>t.overlap?e:t,t[0]);return[{cardId:e.id,pos:e.pos,inView:"partial"}]}return t.map(e=>({cardId:e.id,pos:e.pos,inView:e.overlap>=.9?"full":"partial"}))},eY=(e,t,n,a)=>{let o=a-n;return Math.max(o-Math.max(e-n,0)-Math.max(a-t,0),0)/o},eQ=e=>{let t=(0,eI.u)("buddyEdit"),n=(0,H.GV)(W.wC),a=(0,eq.O2)("editor"),[o,r]=(0,h.useState)(null),i=(0,H.jL)(),l=(0,h.useRef)([]),s=(0,h.useRef)(n);s.current=n;let d=(0,h.useRef)({scrollTop:0,containerHeight:0}),c=(0,h.useCallback)(e=>{eJ(l.current,e)||(l.current=e,i((0,G.vz)(e)))},[i]),u=(0,h.useCallback)(function(){let n=s.current===eW.w.SLIDE_VIEW;if(document.hidden||!e||!t||n)return;let{scrollTop:o,containerHeight:r}=d.current,i=o+r,l=(0,A.xe)(e.state.doc,ev.jg).filter(t=>1===e.state.doc.resolve(t.pos).depth),u=document.querySelector(a.scrollSelector);if(!u)return;let p=(0,eG.sR)(u,a.scrollSelector),h=[];for(let t of l){let n,r=t.node.attrs.id;try{n=e.view.nodeDOM(t.pos)}catch(e){console.error("computeOverlap error",e);continue}if(n instanceof HTMLElement){n=n.querySelector("[data-card-body]");let e=(0,eG.sR)(n,a.scrollSelector)-p;if(e>i)break;let{offsetHeight:l}=n,s=l+e;h.push({id:r,pos:t.pos,overlap:eY(o,i,e,s)})}}c(eK(h.sort((e,t)=>e.pos-t.pos)))},[t,c,e,a.scrollSelector]);eV({element:o,onUpdate:()=>{o&&(d.current.scrollTop=o.scrollTop,u())},onEnd:()=>{o&&(d.current.scrollTop=o.scrollTop,u())},endDelay:250,updateThrottle:100}),(0,h.useEffect)(()=>{if(!t)return;let e=eH()(()=>{o&&(d.current.containerHeight=o.getBoundingClientRect().height,u())},250,{trailing:!0,maxWait:500});return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[t,u,o]),(0,h.useEffect)(()=>{if(!t)return;let e=document.querySelector(a.scrollSelector);e&&(r(e),d.current.scrollTop=e.scrollTop,d.current.containerHeight=e.getBoundingClientRect().height,u())},[a.scrollSelector,d,t,u]),(0,h.useEffect)(()=>{let e=setInterval(()=>{u()},1e3);return()=>clearInterval(e)},[u])};var eZ=n(32267);class e${async getDb(){return this.db?this.db:this.initPromise?this.initPromise:"indexedDB"in window?(this.initPromise=this.initDB(),this.initPromise):(console.warn("[IndexedDBStore] IndexedDB not available"),null)}async initDB(){try{let e=new Promise((e,t)=>{setTimeout(()=>t(Error("Database initialization timeout")),2e3)}),t=(0,eZ.P2)(this.config.dbName,this.config.version,{upgrade:this.config.upgrade});return this.db=await Promise.race([t,e]),this.db}catch(e){return console.error("[IndexedDBStore] Failed to initialize database:",e),this.db=null,this.initPromise=null,null}}async save(e,t){let n=await this.getDb();if(!n)return void console.warn("[IndexedDBStore] Database not available, skipping save");try{await n.put(this.config.storeName,t,e)}catch(e){console.error("[IndexedDBStore] Failed to save data:",e)}}async load(e){let t=await this.getDb();if(!t)return console.error("[IndexedDBStore] Database not available"),null;try{return await t.get(this.config.storeName,e)||null}catch(e){return console.error("[IndexedDBStore] Failed to load data:",e),null}}async delete(e){let t=await this.getDb();if(t)try{await t.delete(this.config.storeName,e)}catch(e){console.error("[IndexedDBStore] Failed to delete data:",e)}}async getAll(){let e=await this.getDb();if(!e)return[];try{return await e.getAll(this.config.storeName)}catch(e){return console.error("[IndexedDBStore] Failed to get all data:",e),[]}}getConfig(){return this.config}async getDatabase(){return this.getDb()}async deleteWhere(e){let t=await this.getDb();if(!t)return 0;try{let n=t.transaction(this.config.storeName,"readwrite"),a=n.objectStore(this.config.storeName),o=await a.openCursor(),r=0;for(;o;){let t=o.value;e(t)&&(await o.delete(),r++),o=await o.continue()}return await n.done,r}catch(e){return console.error("[IndexedDBStore] Failed to delete with predicate:",e),0}}async deleteByIndex(e,t){let n=await this.getDb();if(!n)return 0;try{let a=n.transaction(this.config.storeName,"readwrite"),o=a.objectStore(this.config.storeName).index(e),r=await o.openCursor(IDBKeyRange.only(t)),i=0;for(;r;)await r.delete(),i++,r=await r.continue();return await a.done,i}catch(e){return console.error("[IndexedDBStore] Failed to delete by index:",e),0}}async getUniqueIndexValues(e){let t=await this.getDb();if(!t)return new Set;try{let n=t.transaction(this.config.storeName,"readonly"),a=n.objectStore(this.config.storeName).index(e),o=new Set,r=await a.openKeyCursor();for(;r;)r.key&&o.add(r.key),r=await r.continue();return await n.done,o}catch(e){return console.error("[IndexedDBStore] Failed to get unique index values:",e),new Set}}constructor(e){this.config=e,this.db=null,this.initPromise=null}}let eX={dbName:"buddy-chats",version:1,storeName:"chats",upgrade:(e,t)=>{t<1&&!e.objectStoreNames.contains("chats")&&e.createObjectStore("chats").createIndex("userId","userId",{unique:!1})}},e0=e=>({...e,version:1,timestamp:Date.now()});class e1{async ensureCleanupRun(e){this.hasInitializedCleanup||(await this.cleanupStaleChats(),await this.cleanupOtherUserChats(e),this.hasInitializedCleanup=!0)}generateKey(e){let{docId:t,workspaceId:n,userId:a}=e;return"".concat(a,":").concat(n,":").concat(t)}async saveChat(e){try{await this.ensureCleanupRun(e.userId);let t=this.generateKey(e);await this.store.save(t,e)}catch(e){console.error("[BuddyChatDB] Failed to save chat:",e)}}async loadChat(e){try{let t=this.generateKey(e);return await this.store.load(t)}catch(e){return console.error("[BuddyChatDB] Failed to load chat:",e),null}}async deleteChat(e){try{let t=this.generateKey(e);await this.store.delete(t)}catch(e){console.error("[BuddyChatDB] Failed to delete chat:",e)}}async cleanupOtherUserChats(e){try{for(let t of(await this.store.getUniqueIndexValues("userId")))t!==e&&await this.store.deleteByIndex("userId",t)}catch(e){console.error("[BuddyChatDB] Failed to cleanup other user chats:",e)}}async cleanupStaleChats(){try{let e=Date.now()-36e5;await this.store.deleteWhere(t=>t.timestamp<e)}catch(e){console.error("[BuddyChatDB] Failed to cleanup old chats:",e)}}async cleanup(e){await this.cleanupStaleChats(),await this.cleanupOtherUserChats(e)}async getAllChats(){try{return await this.store.getAll()}catch(e){return console.error("[BuddyChatDB] Failed to get all chats:",e),[]}}async getStorageStats(){let e=await this.getAllChats();if(0===e.length)return{totalChats:0,totalSize:0,oldestChat:null,newestChat:null};let t=e.reduce((e,t)=>e+JSON.stringify(t).length,0),n=e.map(e=>e.timestamp);return{totalChats:e.length,totalSize:t,oldestChat:Math.min(...n),newestChat:Math.max(...n)}}constructor(){this.hasInitializedCleanup=!1,this.store=new e$(eX)}}class e2 extends e1{async loadChat(e){let t=this.generateKey(e),n=this.cache[t];if(n)return n;let a=await super.loadChat(e);return a&&(this.cache[t]=a),a}async saveChat(e){await super.saveChat(e);let t=this.generateKey(e);this.cache[t]=e}async deleteChat(e){await super.deleteChat(e);let t=this.generateKey(e);delete this.cache[t]}constructor(...e){super(...e),this.cache={}}}let e3=new e2,e5=(e,t)=>{let n=(0,H.CU)();(0,h.useEffect)(()=>(window.buddyDebug=async()=>{let a=n.getState(),o=t(),r=a.ThemePicker,i=await e3.getStorageStats(),l={messages:e,reducer:a.Buddy,serialized:o,themes:r,storageStats:i};return console.log(l),l},()=>{delete window.buddyDebug}),[e,t,n])},e6={createCard:{present:()=>M.Ru._({id:"YFvSg3"}),past:()=>M.Ru._({id:"Z801fH"})},editCardById:{present:()=>M.Ru._({id:"y5kNPl"}),past:()=>M.Ru._({id:"nTOyvW"})},editAllCards:{present:()=>M.Ru._({id:"+mgW41"}),past:()=>M.Ru._({id:"tor7fY"})},focusCardById:{present:()=>M.Ru._({id:"dwh4Lg"}),past:()=>M.Ru._({id:"t0SVyb"})},removeCards:{present:()=>M.Ru._({id:"PPHKL3"}),past:()=>M.Ru._({id:"EgCNgl"})},setCardHtml:{present:()=>M.Ru._({id:"jubeck"}),past:()=>M.Ru._({id:"+BZeOo"})},moveCard:{present:()=>M.Ru._({id:"2VD+0p"}),past:()=>M.Ru._({id:"B8He3D"})},duplicateCard:{present:()=>M.Ru._({id:"tO+JlV"}),past:()=>M.Ru._({id:"PdoIWT"})},revertToCheckpoint:{present:()=>M.Ru._({id:"fIJtam"}),past:()=>M.Ru._({id:"i8Of62"})},suggestThemes:{present:()=>M.Ru._({id:"EGiXRh"}),past:()=>M.Ru._({id:"exJFz8"})},readUrl:{present:()=>M.Ru._({id:"L7svJg"}),past:()=>M.Ru._({id:"cQlPDN"})},webSearch:{present:()=>M.Ru._({id:"f2YVZg"}),past:()=>M.Ru._({id:"AzLUkE"})}},e4=e=>e6[e];var e8=n(82957);n(90010);let e7=e=>"result"===e.state&&!!e.result&&"object"==typeof e.result&&"error"===e.result.status,e9=e=>"result"===e.state&&!!e.result&&"object"==typeof e.result&&"success"===e.result.status,te=(e,t,n,a)=>{for(let o of[tn,tt])if(o(e,t,n,a))return},tt=(e,t,n,a)=>{let o=function(e){var t;let n=(null==(t=e.parts)?void 0:t.filter(e=>"tool-invocation"===e.type))||[],a=null;return n.filter(e=>"tool-invocation"===e.type).forEach(e=>{e9(e.toolInvocation)&&"suggestedThemes"in e.toolInvocation.result&&(a=e.toolInvocation.result.suggestedThemes)}),a}(n);if(!o)return!1;let r={messageId:n.id,title:M.Ru._({id:"H7jm8i"}),type:"suggest-themes",themes:o};return e.dispatch((0,G.AY)(a)),e.dispatch((0,G.Jw)(r)),!0},tn=(e,t,n,a)=>{let o=eN(t,(0,W.SJ)(e.getState()).id),r=ta(e,n,a,o);return!!r&&(e.dispatch((0,G.AY)(a)),e.dispatch((0,G.AY)(o)),e.dispatch((0,G.Jw)(r)),e.dispatch((0,G.rD)({messageId:r.messageId,variationId:r.variations[1].id})),!0)},ta=(e,t,n,a)=>{let o=function(e,t){var n;return((null==(n=e.parts)?void 0:n.filter(e=>"tool-invocation"===e.type))||[]).filter(e=>"tool-invocation"===e.type).map(e=>{if(e9(e.toolInvocation)&&"suggestionId"in e.toolInvocation.result){let n=e.toolInvocation.result.suggestionId;if(n)return t[n]}}).filter(e=>!!e)}(t,e.getState().Buddy.suggestions);if(0===o.length)return null;let r=t.id,{originalPreviewCardIds:i,modifiedPreviewCardIds:l,originalScrollToCardId:s,modifiedScrollToCardId:d,previewType:c}=to({beforeContent:n.jsonContent,afterContent:a.jsonContent,suggestions:o}),u={id:"original",messageId:r,name:M.Ru._({id:"HxF6Fk"}),toApplyCheckpointId:n.id,previewCardIds:i,scrollToCardId:s,previewType:c},p={id:"modified",messageId:r,name:M.Ru._({id:"tgWuMB"}),toApplyCheckpointId:a.id,previewCardIds:l,scrollToCardId:d,previewType:c};return{type:"applied-changes",messageId:r,title:function(e){return 0===e.length?M.Ru._({id:"Ef7StM"}):e.length>1?M.Ru._({id:"WTvBlv"}):e4(e[0].type).past()}(o),variations:[u,p]}},to=e=>{let{beforeContent:t,afterContent:n,suggestions:a}=e,o=new A.KE({extensions:(0,e8.C)(),content:n}),r=new A.KE({extensions:(0,e8.C)(),content:t}),i=1===a.length&&"card"===a[0].previewType,l=a.map(e=>({pos:e.getAppliedFirstPos({editor:o}),suggestion:e})).filter(e=>null!=e.pos).sort((e,t)=>e.pos-t.pos)[0].suggestion;return{originalPreviewCardIds:l.getOriginalPreviewCardIds({editor:r}),modifiedPreviewCardIds:l.getModifiedPreviewCardIds({editor:o}),originalScrollToCardId:l.originalCardToSelect({editor:r}),modifiedScrollToCardId:l.modifiedCardToSelect({editor:o}),previewType:i?"card":"doc"}},tr={type:"doc",content:[{type:"document",attrs:{aiOptions:{preserveLayouts:!1,imageOptions:{license:"All",provider:"aiGenerated",generateStyle:"Subtle and professional with a modern and tech-focused design, using light shades of blue and white for a clean, corporate look.",model:"flux-1-schnell",stylePreset:"Theme"}},docId:"nono90o4qpq5ob7",background:{type:"none"},docFlags:{cardLayoutsEnabled:!0},format:"deck",customCode:{},settings:{defaultFullBleed:"contained",stylesDerivedFrom:"deck_default",cardDimensions:"fluid",verticalAlign:"center",defaultContentWidth:"lg",fontSize:"md",scaleContentToFit:!1,animationsEnabled:!0},generateStatus:"done",generateInfo:{interactionId:"q2dl35labe1zc6v",streamId:"nono90o4qpq5ob7",lastEventId:"8",lastCompletedCardId:"5e8a3a2i4zeax4f",lastCompletedCardIndex:7}},content:[{type:"card",attrs:{id:"1643zoszvd9ioaj",previewContent:null,background:{type:"none"},container:{},cardSize:"default",layout:"left",layoutTemplateColumns:null,layoutTemplateRows:null,verticalAlign:null,generatorInput:null,fontScale:null},content:[{type:"cardAccentLayoutItem",attrs:{itemId:"accent",fitType:"fill",background:{type:"image",image:{id:"IoMxT",horizontalAlign:null,savedMediaId:"czelj4ujxi4tv6v",src:"https://cdn-staging.gamma.app/QWjS6fBfpt/generated-images/0_RF_8Yh9hDshk2BGwP-w.jpg",tempUrl:null,uploadStatus:3,meta:{width:896,height:1152},providerMeta:null,aiParams:{model:"flux-1-schnell",steps:30,width:896,height:1152,prompt:"bright futuristic cityscape, abstract, glowing lines and shapes, AI-powered skyscrapers",stylePreset:"Theme",stylePrompt:"Subtle and professional with a modern and tech-focused design, using light shades of blue and white for a clean, corporate look.",interactionId:"q2dl35labe1zc6v",upscaleFactor:1},loadImageParams:{provider:"aiGenerated",query:"bright futuristic cityscape, abstract, glowing lines and shapes, AI-powered skyscrapers",options:{model:"flux-1-schnell",stylePreset:"Theme",stylePrompt:"Subtle and professional with a modern and tech-focused design, using light shades of blue and white for a clean, corporate look.",aspectRatio:"portrait"}},loadImageStatus:"done",loadImageId:"VkEw8",name:null,query:"bright futuristic cityscape, abstract, glowing lines and shapes, AI-powered skyscrapers",source:"image.ai-generated",showPlaceholder:null,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null},clickBehavior:null,href:null,provider:"baseten"},source:"image.ai-generated",mask:{effect:"faded"}}}},{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:1},content:[{type:"text",text:"Artificial Intelligence: Reshaping the Future of Software Engineering"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Artificial Intelligence (AI) is transforming the software engineering landscape, offering unprecedented opportunities to enhance efficiency, creativity, and problem-solving in the development process."}]},{type:"contributors",attrs:{horizontalAlign:null,showTime:!0,hiddenContributorIds:[]}}]}]},{type:"card",attrs:{id:"subtxtl909ov81t",previewContent:null,background:{type:"none"},container:{},cardSize:"default",layout:"blank",layoutTemplateColumns:null,layoutTemplateRows:null,verticalAlign:null,generatorInput:null,fontScale:null},content:[{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:1},content:[{type:"text",text:"Understanding AI: Fundamentals and Capabilities"}]},{type:"gridLayout",attrs:{colWidths:[25,25,25,25],fullWidthBlock:!1},content:[{type:"gridCell",attrs:{verticalAlign:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Machine Learning"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Algorithms learn from data to improve performance, making predictions and automating tasks."}]}]},{type:"gridCell",attrs:{verticalAlign:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Deep Learning"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Neural networks mimic the human brain, enabling complex pattern recognition and decision-making."}]}]},{type:"gridCell",attrs:{verticalAlign:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Natural Language Processing"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Enables computers to understand and interpret human language, facilitating communication and interaction."}]}]},{type:"gridCell",attrs:{verticalAlign:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Computer Vision"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:'Allows computers to "see" and interpret images and videos, opening doors for automation and analysis.'}]}]}]}]}]},{type:"card",attrs:{id:"dst7w3sibmp242d",previewContent:null,background:{type:"none"},container:{},cardSize:"default",layout:"left",layoutTemplateColumns:null,layoutTemplateRows:null,verticalAlign:null,generatorInput:null,fontScale:null},content:[{type:"cardAccentLayoutItem",attrs:{itemId:"accent",fitType:"fill",background:{type:"image",image:{id:"7vuqd",horizontalAlign:null,savedMediaId:"qxjreo3e6ows005",src:"https://cdn-staging.gamma.app/QWjS6fBfpt/generated-images/XLtRiykvWKF70DvzIe5Rp.jpg",tempUrl:null,uploadStatus:3,meta:{width:896,height:1152},providerMeta:null,aiParams:{model:"flux-1-schnell",steps:30,width:896,height:1152,prompt:"a flowchart or diagram illustrating the software development lifecycle, showing the stages and how AI integrates into each step",stylePreset:"Theme",stylePrompt:"Subtle and professional with a modern and tech-focused design, using light shades of blue and white for a clean, corporate look.",interactionId:"q2dl35labe1zc6v",upscaleFactor:1},loadImageParams:{provider:"aiGenerated",query:"a flowchart or diagram illustrating the software development lifecycle, showing the stages and how AI integrates into each step",options:{model:"flux-1-schnell",stylePreset:"Theme",stylePrompt:"Subtle and professional with a modern and tech-focused design, using light shades of blue and white for a clean, corporate look.",aspectRatio:"portrait"}},loadImageStatus:"done",loadImageId:"xu1J9",name:null,query:"a flowchart or diagram illustrating the software development lifecycle, showing the stages and how AI integrates into each step",source:"image.ai-generated",showPlaceholder:null,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null},clickBehavior:null,href:null,provider:"baseten"},source:"image.ai-generated",mask:{effect:"faded"}}}},{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:1},content:[{type:"text",text:"The Role of AI in Software Development Lifecycle"}]},{type:"smartLayout",attrs:{variantKey:"timeline",options:{orientation:"vertical",twoSided:!1,cellSize:"xl"},fullWidthBlock:!1},content:[{type:"smartLayoutCell",attrs:{id:"SvHzr",options:{},width:null,image:null,label:null},content:[{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Requirement gathering and analysis."}]}]},{type:"smartLayoutCell",attrs:{id:"cWKyF",options:{},width:null,image:null,label:null},content:[{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Code design and development."}]}]},{type:"smartLayoutCell",attrs:{id:"EfcAJ",options:{},width:null,image:null,label:null},content:[{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Testing and quality assurance."}]}]},{type:"smartLayoutCell",attrs:{id:"MXt73",options:{},width:null,image:null,label:null},content:[{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Deployment and maintenance."}]}]}]}]}]},{type:"card",attrs:{id:"7rv84ceo7lrhxcb",previewContent:null,background:{type:"none"},container:{},cardSize:"default",layout:"top",layoutTemplateColumns:null,layoutTemplateRows:null,verticalAlign:null,generatorInput:null,fontScale:null},content:[{type:"cardAccentLayoutItem",attrs:{itemId:"accent",fitType:"fill",background:{type:"image",image:{id:"tdPKv",horizontalAlign:null,savedMediaId:"fihn4qh2q7w1oe3",src:"https://cdn-staging.gamma.app/QWjS6fBfpt/generated-images/DvbFABVzie8oFJ1YYs_dc.jpg",tempUrl:null,uploadStatus:3,meta:{width:1216,height:832},providerMeta:null,aiParams:{model:"flux-1-schnell",steps:30,width:1216,height:832,prompt:"a developer using a code editor with AI-powered code completion and suggestions, lines of code highlighted and suggestions appearing on screen",stylePreset:"Theme",stylePrompt:"Subtle and professional with a modern and tech-focused design, using light shades of blue and white for a clean, corporate look.",interactionId:"q2dl35labe1zc6v",upscaleFactor:1},loadImageParams:{provider:"aiGenerated",query:"a developer using a code editor with AI-powered code completion and suggestions, lines of code highlighted and suggestions appearing on screen",options:{model:"flux-1-schnell",stylePreset:"Theme",stylePrompt:"Subtle and professional with a modern and tech-focused design, using light shades of blue and white for a clean, corporate look.",aspectRatio:"landscape"}},loadImageStatus:"done",loadImageId:"KnMgT",name:null,query:"a developer using a code editor with AI-powered code completion and suggestions, lines of code highlighted and suggestions appearing on screen",source:"image.ai-generated",showPlaceholder:null,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null},clickBehavior:null,href:null,provider:"baseten"},source:"image.ai-generated",mask:{effect:"faded"}}}},{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:1},content:[{type:"text",text:"Enhancing Code Generation and Automation"}]},{type:"smartLayout",attrs:{variantKey:"bullets",options:{cellSize:15,numbered:!1},fullWidthBlock:!1},content:[{type:"smartLayoutCell",attrs:{id:"uc0WK",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Code completion"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"AI predicts and suggests code snippets as developers type, improving efficiency and reducing errors."}]}]},{type:"smartLayoutCell",attrs:{id:"sDMsL",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Automated code generation"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"AI can generate code from natural language descriptions, automating repetitive tasks and freeing up developers for more complex work."}]}]},{type:"smartLayoutCell",attrs:{id:"6_00F",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Refactoring and optimization"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"AI can analyze code and suggest improvements, optimizing performance and maintainability."}]}]}]}]}]},{type:"card",attrs:{id:"p5l6uht47h0ongb",previewContent:null,background:{type:"none"},container:{},cardSize:"default",layout:"right",layoutTemplateColumns:null,layoutTemplateRows:null,verticalAlign:null,generatorInput:null,fontScale:null},content:[{type:"cardAccentLayoutItem",attrs:{itemId:"accent",fitType:"fill",background:{type:"image",image:{id:"kickO",horizontalAlign:null,savedMediaId:"p46pf7pmt8zigwu",src:"https://cdn-staging.gamma.app/QWjS6fBfpt/generated-images/h04N7s6Ww1toWmq7RSyiW.jpg",tempUrl:null,uploadStatus:3,meta:{width:896,height:1152},providerMeta:null,aiParams:{model:"flux-1-schnell",steps:30,width:896,height:1152,prompt:"a computer screen displaying a testing environment, with code highlighted and test results displayed, showing AI-powered tools in action",stylePreset:"Theme",stylePrompt:"Subtle and professional with a modern and tech-focused design, using light shades of blue and white for a clean, corporate look.",interactionId:"q2dl35labe1zc6v",upscaleFactor:1},loadImageParams:{provider:"aiGenerated",query:"a computer screen displaying a testing environment, with code highlighted and test results displayed, showing AI-powered tools in action",options:{model:"flux-1-schnell",stylePreset:"Theme",stylePrompt:"Subtle and professional with a modern and tech-focused design, using light shades of blue and white for a clean, corporate look.",aspectRatio:"portrait"}},loadImageStatus:"done",loadImageId:"akxtK",name:null,query:"a computer screen displaying a testing environment, with code highlighted and test results displayed, showing AI-powered tools in action",source:"image.ai-generated",showPlaceholder:null,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null},clickBehavior:null,href:null,provider:"baseten"},source:"image.ai-generated",mask:{effect:"faded"}}}},{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:1},content:[{type:"text",text:"Improving Software Testing and Quality Assurance"}]},{type:"smartLayout",attrs:{variantKey:"iconsText",options:{cellSize:"xl",orientation:"vertical",twoSided:!1},fullWidthBlock:!1},content:[{type:"smartLayoutCell",attrs:{id:"oN4Fo",options:{},width:null,image:{loadImageParams:{provider:"fontawesome",query:"bug",options:{license:"All",aspectRatio:"landscape"}},loadImageStatus:"done",loadImageId:"ozCK1",source:"image.icon",src:"https://cdn-staging.gamma.app/_app_static/icons/v0/bug.svg",tempUrl:"",meta:{height:512,width:512},query:"bug",uploadStatus:3},label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Bug detection"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"AI can identify potential defects and vulnerabilities in code, improving software quality and reducing risks."}]}]},{type:"smartLayoutCell",attrs:{id:"wGAuu",options:{},width:null,image:{loadImageParams:{provider:"fontawesome",query:"test",options:{license:"All",aspectRatio:"landscape"}},loadImageStatus:"done",loadImageId:"sDgNK",source:"image.icon",src:"https://cdn-staging.gamma.app/_app_static/icons/v0/vials.svg",tempUrl:"",meta:{height:512,width:512},query:"test",uploadStatus:3},label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Automated testing"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"AI can create and execute tests automatically, increasing test coverage and efficiency."}]}]},{type:"smartLayoutCell",attrs:{id:"goCsu",options:{},width:null,image:{loadImageParams:{provider:"fontawesome",query:"performance",options:{license:"All",aspectRatio:"landscape"}},loadImageStatus:"done",loadImageId:"JbXE0",source:"image.icon",src:"https://cdn-staging.gamma.app/_app_static/icons/v0/chart-simple.svg",tempUrl:"",meta:{height:512,width:448},query:"performance",uploadStatus:3},label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Performance analysis"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"AI can monitor software performance and identify bottlenecks, optimizing performance and user experience."}]}]}]}]}]},{type:"card",attrs:{id:"y4odbtb4upq3ift",previewContent:null,background:{type:"none"},container:{},cardSize:"default",layout:"blank",layoutTemplateColumns:null,layoutTemplateRows:null,verticalAlign:null,generatorInput:null,fontScale:null},content:[{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:1},content:[{type:"text",text:"AI-Powered Software Maintenance and Optimization"}]},{type:"smartLayout",attrs:{variantKey:"pyramid",options:{},fullWidthBlock:!1},content:[{type:"smartLayoutCell",attrs:{id:"heB4z",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Predictive maintenance"}]}]},{type:"smartLayoutCell",attrs:{id:"XYkDn",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Performance optimization"}]}]},{type:"smartLayoutCell",attrs:{id:"5V7bG",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Security patching"}]}]}]}]}]},{type:"card",attrs:{id:"ixg1xiht8rgz588",previewContent:null,background:{type:"none"},container:{},cardSize:"default",layout:"left",layoutTemplateColumns:null,layoutTemplateRows:null,verticalAlign:null,generatorInput:null,fontScale:null},content:[{type:"cardAccentLayoutItem",attrs:{itemId:"accent",fitType:"fill",background:{type:"image",image:{id:"z4IBN",horizontalAlign:null,savedMediaId:"2mbwgbdat5hbbo5",src:"https://cdn-staging.gamma.app/QWjS6fBfpt/generated-images/BTpnB4rh5sLATVKCePiCM.jpg",tempUrl:null,uploadStatus:3,meta:{width:896,height:1152},providerMeta:null,aiParams:{model:"flux-1-schnell",steps:30,width:896,height:1152,prompt:"a futuristic cityscape, showing a balance between technology and nature, a blend of AI and ethical considerations",stylePreset:"Theme",stylePrompt:"Subtle and professional with a modern and tech-focused design, using light shades of blue and white for a clean, corporate look.",interactionId:"q2dl35labe1zc6v",upscaleFactor:1},loadImageParams:{provider:"aiGenerated",query:"a futuristic cityscape, showing a balance between technology and nature, a blend of AI and ethical considerations",options:{model:"flux-1-schnell",stylePreset:"Theme",stylePrompt:"Subtle and professional with a modern and tech-focused design, using light shades of blue and white for a clean, corporate look.",aspectRatio:"portrait"}},loadImageStatus:"done",loadImageId:"7VF7H",name:null,query:"a futuristic cityscape, showing a balance between technology and nature, a blend of AI and ethical considerations",source:"image.ai-generated",showPlaceholder:null,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null},clickBehavior:null,href:null,provider:"baseten"},source:"image.ai-generated",mask:{effect:"faded"}}}},{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:1},content:[{type:"text",text:"Ethical Considerations and Responsible AI Practices"}]},{type:"smartLayout",attrs:{variantKey:"textBoxes",options:{cellSize:"xl",orientation:"vertical",twoSided:!1},fullWidthBlock:!1},content:[{type:"smartLayoutCell",attrs:{id:"om1EM",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Bias detection"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"AI models can perpetuate existing biases, necessitating careful analysis and mitigation."}]}]},{type:"smartLayoutCell",attrs:{id:"D-jOF",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Data privacy"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"AI systems often rely on large datasets, requiring robust data privacy and security measures."}]}]},{type:"smartLayoutCell",attrs:{id:"n7iki",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Transparency and explainability"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Understanding how AI models make decisions is crucial for trust and accountability."}]}]}]}]}]},{type:"card",attrs:{id:"5e8a3a2i4zeax4f",previewContent:null,background:{type:"none"},container:{},cardSize:"default",layout:"left",layoutTemplateColumns:null,layoutTemplateRows:null,verticalAlign:null,generatorInput:null,fontScale:null},content:[{type:"cardAccentLayoutItem",attrs:{itemId:"accent",fitType:"fill",background:{type:"image",image:{id:"8sgUZ",horizontalAlign:null,savedMediaId:"73wqna30pkk9j1g",src:"https://cdn-staging.gamma.app/QWjS6fBfpt/generated-images/XBXNDbQuLFDPjE4LT3KWK.jpg",tempUrl:null,uploadStatus:3,meta:{width:896,height:1152},providerMeta:null,aiParams:{model:"flux-1-schnell",steps:30,width:896,height:1152,prompt:"a futuristic tech scene, showing AI-powered robots and software collaborating with human developers, with a positive and hopeful mood",stylePreset:"Theme",stylePrompt:"Subtle and professional with a modern and tech-focused design, using light shades of blue and white for a clean, corporate look.",interactionId:"q2dl35labe1zc6v",upscaleFactor:1},loadImageParams:{provider:"aiGenerated",query:"a futuristic tech scene, showing AI-powered robots and software collaborating with human developers, with a positive and hopeful mood",options:{model:"flux-1-schnell",stylePreset:"Theme",stylePrompt:"Subtle and professional with a modern and tech-focused design, using light shades of blue and white for a clean, corporate look.",aspectRatio:"portrait"}},loadImageStatus:"done",loadImageId:"2fNqi",name:null,query:"a futuristic tech scene, showing AI-powered robots and software collaborating with human developers, with a positive and hopeful mood",source:"image.ai-generated",showPlaceholder:null,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null},clickBehavior:null,href:null,provider:"baseten"},source:"image.ai-generated",mask:{effect:"faded"}}}},{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:1},content:[{type:"text",text:"The Future of AI in Software Engineering: Trends and Predictions"}]},{type:"smartLayout",attrs:{variantKey:"stats",options:{cellSize:"xl",orientation:"vertical",twoSided:!1},fullWidthBlock:!1},content:[{type:"smartLayoutCell",attrs:{id:"eErVH",options:{},width:null,image:null,label:"1"},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Increased automation"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"AI will continue to automate more tasks, freeing developers for creative and strategic work."}]}]},{type:"smartLayoutCell",attrs:{id:"ca3B6",options:{},width:null,image:null,label:"2"},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"More personalized experiences"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"AI will enable the development of highly personalized software experiences tailored to individual users."}]}]},{type:"smartLayoutCell",attrs:{id:"K6Iai",options:{},width:null,image:null,label:"3"},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Enhanced security"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"AI will play a crucial role in detecting and preventing cyber threats, ensuring software security."}]}]}]}]}]}]}]},ti={type:"doc",content:[{type:"document",attrs:{aiOptions:{preserveLayouts:!1,imageOptions:{license:"All",provider:"aiGenerated",generateStyle:"light green white cool, friendly playful elegant clean modern fresh",model:"recraft-v3-svg",stylePreset:"Theme"}},docId:"u8p5nbzhww4im32",background:{type:"none"},docFlags:{cardLayoutsEnabled:!0},format:"deck",customCode:{},settings:{defaultFullBleed:"contained",stylesDerivedFrom:"deck_default",cardDimensions:"fluid",verticalAlign:"center",defaultContentWidth:"lg",fontSize:"md",scaleContentToFit:!1,animationsEnabled:!0},generateStatus:"done",generateInfo:{interactionId:"pcrgh5cmhjmbu0r",streamId:"u8p5nbzhww4im32",lastEventId:"6",lastCompletedCardId:"hm6st3psdgzor5y",lastCompletedCardIndex:5}},content:[{type:"card",attrs:{id:"7r1rzy9nzyuqjvz",previewContent:null,background:{type:"none"},container:{},cardSize:"default",layout:"left",layoutTemplateColumns:null,layoutTemplateRows:null,verticalAlign:null,generatorInput:null,fontScale:null},content:[{type:"cardAccentLayoutItem",attrs:{itemId:"accent",fitType:"fill",background:{type:"image",image:{id:"3yTLK",horizontalAlign:null,savedMediaId:"lifgg20xpoutrce",src:"https://cdn-staging.gamma.app/QWjS6fBfpt/generated-images/T8KNdVM9zsJ9S_ym8eTyP.svg",tempUrl:null,uploadStatus:3,meta:{width:1024,height:1707},providerMeta:null,aiParams:{model:"recraft-v3-svg",steps:30,width:1024,height:1707,prompt:"Authentic Japanese sukiyaki hotpot on a traditional low table, steaming with flavorful broth and various colorful ingredients, soft warm lighting, cozy home dinning setting",stylePreset:"Theme",stylePrompt:"light green white cool, friendly playful elegant clean modern fresh",interactionId:"pcrgh5cmhjmbu0r",upscaleFactor:1},loadImageParams:{provider:"aiGenerated",query:"Authentic Japanese sukiyaki hotpot on a traditional low table, steaming with flavorful broth and various colorful ingredients, soft warm lighting, cozy home dinning setting",options:{model:"recraft-v3-svg",stylePreset:"Theme",stylePrompt:"light green white cool, friendly playful elegant clean modern fresh",aspectRatio:"portrait"}},loadImageStatus:"done",loadImageId:"I2A0Q",name:null,query:"Authentic Japanese sukiyaki hotpot on a traditional low table, steaming with flavorful broth and various colorful ingredients, soft warm lighting, cozy home dinning setting",source:"image.ai-generated",showPlaceholder:null,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null},clickBehavior:null,href:null,provider:"recraft"},source:"image.ai-generated",mask:{effect:"faded"}}}},{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:1},content:[{type:"text",text:"Sukiyaki: A Delicious Japanese Hotpot"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Embark on a culinary journey to Japan with the art of making sukiyaki at home. This traditional Japanese hotpot dish offers a unique dining experience that combines rich flavors, social interaction, and the pleasure of cooking together. In this presentation, we'll guide you through selecting ingredients, preparing the perfect broth, and mastering the cooking techniques for an authentic sukiyaki experience."}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Whether you're a novice cook or an adventurous foodie, sukiyaki allows you to create a customizable meal that's both nutritious and flavorful. So, gather friends and family at the table for a communal cooking experience that will leave your taste buds and your spirit enriched."}]},{type:"contributors",attrs:{horizontalAlign:null,showTime:!0,hiddenContributorIds:[]}}]}]},{type:"card",attrs:{id:"4uj9pir12jyf982",previewContent:null,background:{type:"none"},container:{},cardSize:"default",layout:"right",layoutTemplateColumns:null,layoutTemplateRows:null,verticalAlign:null,generatorInput:null,fontScale:null},content:[{type:"cardAccentLayoutItem",attrs:{itemId:"accent",fitType:"fill",background:{type:"image",image:{id:"HOy7V",horizontalAlign:null,savedMediaId:"1w6fe4naysajnsu",src:"https://cdn-staging.gamma.app/QWjS6fBfpt/generated-images/MVt3q2RSgW2aV4NyNsWpF.svg",tempUrl:null,uploadStatus:3,meta:{width:1024,height:1707},providerMeta:null,aiParams:{model:"recraft-v3-svg",steps:30,width:1024,height:1707,prompt:"Variety of fresh ingredients for sukiyaki laid out on a wooden cutting board, including thin slices of beef, colorful vegetables, tofu, and seasonings, bright kitchen lighting",stylePreset:"Theme",stylePrompt:"light green white cool, friendly playful elegant clean modern fresh",interactionId:"pcrgh5cmhjmbu0r",upscaleFactor:1},loadImageParams:{provider:"aiGenerated",query:"Variety of fresh ingredients for sukiyaki laid out on a wooden cutting board, including thin slices of beef, colorful vegetables, tofu, and seasonings, bright kitchen lighting",options:{model:"recraft-v3-svg",stylePreset:"Theme",stylePrompt:"light green white cool, friendly playful elegant clean modern fresh",aspectRatio:"portrait"}},loadImageStatus:"done",loadImageId:"6BSwv",name:null,query:"Variety of fresh ingredients for sukiyaki laid out on a wooden cutting board, including thin slices of beef, colorful vegetables, tofu, and seasonings, bright kitchen lighting",source:"image.ai-generated",showPlaceholder:null,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null},clickBehavior:null,href:null,provider:"recraft"},source:"image.ai-generated",mask:{effect:"faded"}}}},{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:1},content:[{type:"text",text:"Ingredients for Authentic Sukiyaki"}]},{type:"smartLayout",attrs:{variantKey:"iconsText",options:{cellSize:"xl",orientation:"vertical",twoSided:!1},fullWidthBlock:!1},content:[{type:"smartLayoutCell",attrs:{id:"tS2ML",options:{},width:null,image:{loadImageParams:{provider:"fontawesome",query:"beef",options:{license:"All",aspectRatio:"landscape"}},loadImageStatus:"done",loadImageId:"QFUSR",source:"image.icon",src:"https://cdn-staging.gamma.app/_app_static/icons/v0/meat.svg",tempUrl:"",meta:{height:512,width:512},query:"beef",uploadStatus:3},label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Thinly Sliced Beef"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Use premium cuts like wagyu or ribeye for maximum flavor and tenderness. Slice against the grain for even cooking."}]}]},{type:"smartLayoutCell",attrs:{id:"p--DO",options:{},width:null,image:{loadImageParams:{provider:"fontawesome",query:"vegetables",options:{license:"All",aspectRatio:"landscape"}},loadImageStatus:"done",loadImageId:"rjjNp",source:"image.icon",src:"https://cdn-staging.gamma.app/_app_static/icons/v0/burger-lettuce.svg",tempUrl:"",meta:{height:512,width:512},query:"vegetables",uploadStatus:3},label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Colorful Vegetables"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Include a variety of colorful vegetables like shirataki, mushrooms, carrots, and lotus root for texture and flavor."}]}]},{type:"smartLayoutCell",attrs:{id:"l2zIi",options:{},width:null,image:{loadImageParams:{provider:"fontawesome",query:"tofu",options:{license:"All",aspectRatio:"landscape"}},loadImageStatus:"done",loadImageId:"kPSX8",source:"image.icon",src:"https://cdn-staging.gamma.app/_app_static/icons/v0/scanner-touchscreen.svg",tempUrl:"",meta:{height:512,width:512},query:"tofu",uploadStatus:3},label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Bland Ingredients"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Don't forget tofu and boiled eggs for protein and as mild flavors to absorb the rich broth."}]}]},{type:"smartLayoutCell",attrs:{id:"81-Il",options:{},width:null,image:{loadImageParams:{provider:"fontawesome",query:"miso",options:{license:"All",aspectRatio:"landscape"}},loadImageStatus:"done",loadImageId:"Sd5x7",source:"image.icon",src:"https://cdn-staging.gamma.app/_app_static/icons/v0/mistletoe.svg",tempUrl:"",meta:{height:512,width:576},query:"miso",uploadStatus:3},label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Seasonings"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Use soy sauce, sake, and mirin for marinades, and miso for enhancing the broth's umami flavor."}]}]}]}]}]},{type:"card",attrs:{id:"qn6znn1bychl8v2",previewContent:null,background:{type:"none"},container:{},cardSize:"default",layout:"blank",layoutTemplateColumns:null,layoutTemplateRows:null,verticalAlign:null,generatorInput:null,fontScale:null},content:[{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:1},content:[{type:"text",text:"Preparing the Broth and Dipping Sauce"}]},{type:"gridLayout",attrs:{colWidths:[33.33,33.33,33.33],fullWidthBlock:!1},content:[{type:"gridCell",attrs:{verticalAlign:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Classic Dashi Broth"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Start with a traditional dashi broth by simmering kombu seaweed and katsuobushi for a rich umami flavor. Add soy sauce, mirin, and sake to create a savory base for your sukiyaki."}]}]},{type:"gridCell",attrs:{verticalAlign:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Modern Variations"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Experiment with other broths like savory tonkotsu (pork bone) or light chicken-based options for different flavor profiles. Always ensure your broth is hot and flavorful before adding ingredients."}]}]},{type:"gridCell",attrs:{verticalAlign:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Perfect Ponzu Sauce"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Prepare a dipping sauce by whisking together soy sauce, vinegar, and yuzu citrus juice. This tangy ponzu complements the rich flavors of the cooked ingredients and adds brightness to every bite."}]}]}]}]}]},{type:"card",attrs:{id:"vaz2qowbjo6u8wy",previewContent:null,background:{type:"none"},container:{},cardSize:"default",layout:"left",layoutTemplateColumns:null,layoutTemplateRows:null,verticalAlign:null,generatorInput:null,fontScale:null},content:[{type:"cardAccentLayoutItem",attrs:{itemId:"accent",fitType:"fill",background:{type:"image",image:{id:"Dr61d",horizontalAlign:null,savedMediaId:"rg9v2ib7d761apq",src:"https://cdn-staging.gamma.app/QWjS6fBfpt/generated-images/A_JAcGJeT5Vzb08u0j7MD.svg",tempUrl:null,uploadStatus:3,meta:{width:1024,height:1707},providerMeta:null,aiParams:{model:"recraft-v3-svg",steps:30,width:1024,height:1707,prompt:"Artful arrangement of thinly sliced beef ribeye, chicken thigh, pork belly, and an assortment of colorful vegetables on a large oval platter, studio lighting",stylePreset:"Theme",stylePrompt:"light green white cool, friendly playful elegant clean modern fresh",interactionId:"pcrgh5cmhjmbu0r",upscaleFactor:1},loadImageParams:{provider:"aiGenerated",query:"Artful arrangement of thinly sliced beef ribeye, chicken thigh, pork belly, and an assortment of colorful vegetables on a large oval platter, studio lighting",options:{model:"recraft-v3-svg",stylePreset:"Theme",stylePrompt:"light green white cool, friendly playful elegant clean modern fresh",aspectRatio:"portrait"}},loadImageStatus:"done",loadImageId:"I98zN",name:null,query:"Artful arrangement of thinly sliced beef ribeye, chicken thigh, pork belly, and an assortment of colorful vegetables on a large oval platter, studio lighting",source:"image.ai-generated",showPlaceholder:null,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null},clickBehavior:null,href:null,provider:"recraft"},source:"image.ai-generated",mask:{effect:"faded"}}}},{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:1},content:[{type:"text",text:"Choosing the Right Meat and Vegetables"}]},{type:"smartLayout",attrs:{variantKey:"bullets",options:{cellSize:"xl",numbered:!1,orientation:"vertical",twoSided:!1},fullWidthBlock:!1},content:[{type:"smartLayoutCell",attrs:{id:"8raJF",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Meat Showcase"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Opt for thinly sliced premium beef cuts like wagyu or ribeye for their tender texture and rich flavor. Chicken thigh and pork (especially thin belly slices) also work beautifully in sukiyaki."}]}]},{type:"smartLayoutCell",attrs:{id:"XE09H",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Vegetable Variety"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Include a colorful array of vegetables including shirataki (white konnyaku noodles), cremini mushrooms, napa cabbage, lotus root, and zucchini for texture and flavor contrast."}]}]},{type:"smartLayoutCell",attrs:{id:"ClCeh",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Seafood Addition"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Crimp shrimp, mussels, and crab legs can add seafood flair to your sukiyaki, but be mindful of cooking times to prevent overcooking."}]}]},{type:"smartLayoutCell",attrs:{id:"NNGn3",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Extra Protein"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Eggs and tofu are great additions that absorb the savory flavors of the broth and provide protein variety for a balanced meal."}]}]}]}]}]},{type:"card",attrs:{id:"bvrndod7ra8z3og",previewContent:null,background:{type:"none"},container:{},cardSize:"default",layout:"left",layoutTemplateColumns:null,layoutTemplateRows:null,verticalAlign:null,generatorInput:null,fontScale:null},content:[{type:"cardAccentLayoutItem",attrs:{itemId:"accent",fitType:"fill",background:{type:"image",image:{id:"TwXRr",horizontalAlign:null,savedMediaId:"91bxczdf7i0zzce",src:"https://cdn-staging.gamma.app/QWjS6fBfpt/generated-images/7WgUlbv23EbSrim9Ri_Z6.svg",tempUrl:null,uploadStatus:3,meta:{width:1024,height:1707},providerMeta:null,aiParams:{model:"recraft-v3-svg",steps:30,width:1024,height:1707,prompt:"Hands demonstrating sukiyaki cooking technique, including layering ingredients and dipping in sauce, warm lighting highlighting steam and vibrant colors",stylePreset:"Theme",stylePrompt:"light green white cool, friendly playful elegant clean modern fresh",interactionId:"pcrgh5cmhjmbu0r",upscaleFactor:1},loadImageParams:{provider:"aiGenerated",query:"Hands demonstrating sukiyaki cooking technique, including layering ingredients and dipping in sauce, warm lighting highlighting steam and vibrant colors",options:{model:"recraft-v3-svg",stylePreset:"Theme",stylePrompt:"light green white cool, friendly playful elegant clean modern fresh",aspectRatio:"portrait"}},loadImageStatus:"done",loadImageId:"32cfG",name:null,query:"Hands demonstrating sukiyaki cooking technique, including layering ingredients and dipping in sauce, warm lighting highlighting steam and vibrant colors",source:"image.ai-generated",showPlaceholder:null,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null},clickBehavior:null,href:null,provider:"recraft"},source:"image.ai-generated",mask:{effect:"faded"}}}},{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:1},content:[{type:"text",text:"Cooking Techniques for Sukiyaki"}]},{type:"smartLayout",attrs:{variantKey:"timeline",options:{orientation:"vertical",twoSided:!1,cellSize:"xl"},fullWidthBlock:!1},content:[{type:"smartLayoutCell",attrs:{id:"DWv1n",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Heat Management"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Start by heating the broth to a gentle simmer. As cooking progresses, adjust the temperature to maintain a controlled bubble for even cooking of all ingredients."}]}]},{type:"smartLayoutCell",attrs:{id:"DcERF",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Layering Ingredients"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Add ingredients in order of cooking time. Begin with tough vegetables and tougher meats, then add more delicate items as the meal progresses."}]}]},{type:"smartLayoutCell",attrs:{id:"H5JS-",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Tasting and Adjusting"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Regularly taste the broth and adjust seasonings. Stir the pot occasionally to ensure even cooking, but let ingredients cook briefly for optimal texture."}]}]},{type:"smartLayoutCell",attrs:{id:"LnBta",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Serving"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"As ingredients are cooked, remove them from the pot and dip in the prepared ponzu sauce before eating. Continue until all ingredients are cooked and enjoyed."}]}]}]}]}]},{type:"card",attrs:{id:"hm6st3psdgzor5y",previewContent:null,background:{type:"none"},container:{},cardSize:"default",layout:"blank",layoutTemplateColumns:null,layoutTemplateRows:null,verticalAlign:null,generatorInput:null,fontScale:null},content:[{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:1},content:[{type:"text",text:"Mastering the Donabe Setup"}]},{type:"smartLayout",attrs:{variantKey:"textBoxes",options:{cellSize:20},fullWidthBlock:!1},content:[{type:"smartLayoutCell",attrs:{id:"pBrxI",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Choosing the Right Donabe"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Select a traditional earthenware donabe pot designed for sukiyaki. Its thick walls retain heat evenly, creating an optimal cooking environment. If unavailable, a deep cast-iron or stainless steel pot can be used as a substitute."}]}]},{type:"smartLayoutCell",attrs:{id:"5CagX",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Setup and Heating"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Place the donabe in the center of the table. Use a table-top burner for easy access and to maintain heat throughout the meal. Pre-heat the pot before adding ingredients to ensure a flavorful start."}]}]},{type:"smartLayoutCell",attrs:{id:"vWoKO",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Layering Ingredients"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Arrange ingredients in a visually appealing manner around the donabe. This encourages communal cooking and makes it easier for guests to add ingredients as they wish."}]}]},{type:"smartLayoutCell",attrs:{id:"ykwm0",options:{},width:null,image:null,label:null},content:[{type:"heading",attrs:{horizontalAlign:null,placeholder:null,level:4},content:[{type:"text",text:"Temperature Control"}]},{type:"paragraph",attrs:{horizontalAlign:null,placeholder:null,fontSize:null},content:[{type:"text",text:"Maintain a gentle simmer to prevent overcooking delicate ingredients. Adjust the heat as needed throughout the meal to maintain optimal cooking conditions for various foods."}]}]}]}]}]}]}]},tl=[{description:"replace content",userMessages:["actually we're going to lahaina, replace all the content about wailea"],editorContent:ti},{description:"whats on second card",userMessages:["whats on second card","delete the second card"],editorContent:tr},{description:"move accent to right",userMessages:["move the first card image to the right","make the accent image 50% wide"],editorContent:tr},{description:"regenerate accent image",userMessages:["change the first card image to be of pikachu"],editorContent:tr},{description:"add a conclusion card",userMessages:["add a conclusion card"],editorContent:tr},{description:"delete all but the first card",userMessages:["delete all but the first card"],editorContent:tr},{description:"delete everything but the 5th card",userMessages:["delete everything but the 5th card"],editorContent:tr},{description:"visual appeal and undo",userMessages:["make the second slide more visually appealing","undo that"],editorContent:tr},{description:"sukiyaki - edit to ingredients",userMessages:["rewrite the broth card to be about creating a sukiyaki broth","give me a specific recipe for the sukiyaki broth, show for 2 poeple and 4 people","great now add a delicious looking sukiyaki top banner"],editorContent:ti,themeId:"pistachio"},{description:"sukiyaki - split the first card",userMessages:["split the first card into two cards"],editorContent:ti,themeId:"pistachio"}],ts=e=>{let{reload:t,setMessages:n,isLoading:a}=e,o=(0,H.CU)(),r=(0,H.jL)(),i=(0,h.useRef)(1),[l,s]=(0,h.useState)(!1),d=(0,h.useRef)([]),c=(0,h.useRef)(!1),u=(0,h.useRef)(a);(0,h.useEffect)(()=>{u.current=a},[a]);let p=(0,h.useCallback)(()=>{c.current=!1},[]),g=(0,h.useCallback)(()=>{if(u.current)return;if(0===d.current.length){console.log("No remaining messages"),s(!1),m.current&&(clearInterval(m.current),m.current=null);return}console.log("send message");let[e,...a]=d.current;d.current=a;let o={id:"user-".concat(i.current++),content:e,role:"user"};c.current=!0,n(e=>[...e,o]),t()},[t,n]),m=(0,h.useRef)(null);return{startTestCase:(0,h.useCallback)((e,t)=>{if(m.current)return void console.log("NOT STARTING INTERVAL");n(()=>[]),s(!0),t.themeId&&(0,V.kl)(o.getState()).find(e=>e.id===t.themeId),d.current=t.userMessages,m.current=setInterval(g,1e3)},[r,g,n,o]),isRunning:l,markFinish:p}},td=(0,R.d_)("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",8),tc=e=>"buddy-".concat(e,"-").concat(td());var tu=n(24302),tp=n(58809),th=n(17074),tg=n(87996),tm=n(80180),tf=n(76694);let ty=(0,R.d_)("1234567890abcdefghijklmnopqrstuvwxyz",16),tv=e=>{let{focusInput:t}=e,n=(0,H.CU)(),a=(0,z.d)(),[r,i]=(0,h.useState)([]),l=(0,h.useCallback)(()=>{i([])},[]),s=(0,h.useCallback)(e=>{i(t=>t.filter(t=>t.id!==e))},[]),d=r.some(e=>!!e.isUploading),c=(0,h.useCallback)(e=>{var l;let d=(0,tp.Jo)(n.getState()),c=null==d||null==(l=d.organization)?void 0:l.id;if(!c)return void console.error("Could not find current doc's workspace id");if(0===e.length)return;let u=e.filter(e=>e.type.startsWith("image/"));if(0===u.length)return;let p=10-r.length;if(p<=0)return void a({title:(0,o.jsx)(k.x6,{id:"ff3IAf"}),description:(0,o.jsx)(k.x6,{id:"VzjO+n",values:{FILE_LIMIT:10}}),status:"warning",duration:3e3,isClosable:!0,position:"bottom-right"});let h=u.slice(0,p);t(),h.forEach(e=>{if("application/pdf"===e.type||e.name.toLowerCase().endsWith(".pdf")){let t={id:ty(),src:"",name:e.name,mimeType:e.type,isUploading:!0,isPdf:!0,size:e.size};i(e=>[...e,t]),(0,tg.QM)(e,c,{onUploadComplete:e=>{i(n=>n.map(n=>n.id===t.id?{...n,src:e.src,isUploading:!1}:n))},onUploadFailed:()=>s(t.id)},"node","importPdf")}else{let t=URL.createObjectURL(e),n={id:ty(),src:t,name:e.name,mimeType:e.type,isUploading:!0,isPdf:!1,size:e.size};i(e=>[...e,n]),(0,tg.QM)(e,c,{onUploadComplete:e=>{i(t=>t.map(t=>t.id===n.id?{...t,src:e.src,isUploading:!1}:t))},onUploadFailed:()=>s(n.id)},"node")}})},[t,s,n,r.length]),{inputElement:u,onClick:p}=(0,th.c)({handleFilesCallback:c,multiple:!0,accept:"image/*"});return{uploadedFiles:r,hiddenFileInput:u,uploadFiles:c,openFilePicker:p,removeFile:s,resetFiles:l,isUploading:d}},tb=e=>{let{uploadFiles:t}=e;return{onPaste:(0,h.useCallback)(e=>{var n;let a=null==(n=e.clipboardData)?void 0:n.items;if(!a)return;let o=[];Array.from(a).forEach(e=>{if(e.type.startsWith("image/")){let t=e.getAsFile();t&&o.push(t)}}),o.length>0&&(e.preventDefault(),t(o))},[t])}},tw=e=>{let{uploadFiles:t}=e,n=(0,h.useRef)(null),a=(0,h.useCallback)(e=>e.dataTransfer.items&&Array.from(e.dataTransfer.items).some(e=>"file"===e.kind&&e.type.startsWith("image/")),[]),o=(0,h.useCallback)(e=>{var a;e.preventDefault(),null==(a=n.current)||a.classList.remove(tf.u),t(Array.from(e.dataTransfer.files))},[t]),r=(0,h.useCallback)(e=>{var t;e.preventDefault(),null==(t=n.current)||t.classList.remove(tf.u)},[]),i=(0,h.useCallback)(e=>{var t;a(e)&&((0,tm.JO)(e),null==(t=n.current)||t.classList.add(tf.u))},[a]);return{ref:n,onDragLeave:r,onDragOver:i,onDrop:o}};var tx=n(39247);let tI=e=>{let{cardInView:t}=e,n=(0,H.GV)((0,tx.F1)(t.cardId)),a=null!=n?n:t.cardId;return(0,o.jsx)(I.E,{colorScheme:"blue",variant:"full"===t.inView?"solid":"outline",size:"sm",borderRadius:"md",px:2,py:1,maxW:"200px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flexShrink:0,children:a},t.cardId)};var tC=n(17496),tS=n(29810),tk=n(19783),tA=n(39892),tT=n(95889);let tz=e=>{let{handleNewChat:t,messages:n}=e,a=(0,tA.ez)("unlimited_credits");return(0,o.jsx)(tC.S,{in:!0,children:(0,o.jsxs)(w.z,{mt:2,children:[n.length>0&&(0,o.jsx)(P.$,{size:"sm",variant:"link",onClick:t,leftIcon:(0,o.jsx)(j.g,{icon:E.V3T,size:"sm"}),children:(0,o.jsx)(k.x6,{id:"hIQkLb"})}),(0,o.jsx)(tS.h,{}),!a&&(0,o.jsx)(tk.f,{modalId:"ai-credits-modal-message-list",variant:"ghost",justify:"flex-end",segmentEvent:tT.VV.GAMMA_UPSELL_CALLOUT_AI_CREDITS_BUDDY_EDIT_CHAT})]})})};var tP=n(16936),tE=n(55597),tj=n(57963),tM=n(90184),tR=n(89942),tD=n(18833),tB=n(42328),tL=n(71093),t_=n(60908);let tN=(0,tD.P)(r.a),tO=e=>{let{file:t,removeFile:n,boxSize:a}=e,{isZoomed:i,enterZoom:l,exitZoom:c}=(0,tL.RL)(t.id),u=(0,h.useCallback)(()=>{t.isPdf||t.isUploading||l()},[t.isPdf,t.isUploading,l]);return(0,o.jsxs)(tN,{layout:!0,initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},position:"relative",role:"group",children:[t.isPdf?(0,o.jsxs)(b.s,{boxSize:a,borderRadius:"md",border:"1px solid",borderColor:"gray.200",bg:"gray.50",display:"flex",flexDir:"column",p:2,children:[(0,o.jsx)(d.E,{fontSize:"xxs",fontWeight:"semibold",noOfLines:1,children:t.name}),(0,o.jsxs)(d.E,{fontSize:"xxs",mt:0,color:"gray.600",children:[((t.size||0)/1024).toFixed(0)," KB"]}),(0,o.jsx)(tS.h,{}),(0,o.jsx)(w.z,{children:(0,o.jsx)(I.E,{fontSize:"xxs",colorScheme:"gray",children:"PDF"})})]}):(0,o.jsxs)(r.a,{position:"relative",children:[(0,o.jsx)(D._,{src:t.isUploading?t.src:(0,t_.Ub)(t.src,t_.p7),fallbackSrc:t.src,alt:t.name,boxSize:a,objectFit:"cover",borderRadius:"md",border:"1px solid",borderColor:"gray.200",opacity:t.isUploading?.6:1,cursor:t.isUploading?"default":"zoom-in",onClick:u}),!t.isUploading&&(0,o.jsx)(tL.Gx,{isZoomed:i,exitZoom:c,editor:{isThumbnail:!1,isEditable:!1},children:(0,o.jsx)(b.s,{justify:"center",align:"center",h:"100%",w:"100%",children:(0,o.jsx)(D._,{src:t.src,alt:t.name,maxW:"90vw",maxH:"90vh",objectFit:"contain"})})})]}),t.isUploading&&(0,o.jsx)(r.a,{position:"absolute",inset:0,display:"flex",justifyContent:"center",alignItems:"center",children:(0,o.jsx)(s.y,{size:"sm",color:"deepocean.900"})}),!t.isUploading&&(0,o.jsx)(tP.K,{opacity:0,_groupHover:{opacity:1},transitionProperty:"common",transitionDuration:"normal",position:"absolute",top:"-6px",insetEnd:"-6px",size:"xs",onClick:()=>n(t.id),"aria-label":M.Ru._({id:"cILfnJ"}),icon:(0,o.jsx)(j.g,{icon:E.Jyw})})]})},tF=e=>{let{uploadedFiles:t,removeFile:n,boxSize:a,...r}=e;return(0,o.jsx)(w.z,{spacing:2,flexWrap:"wrap",as:tD.P.div,layout:!0,...r,children:(0,o.jsx)(tB.N,{initial:!1,children:t.map(e=>(0,o.jsx)(tO,{file:e,removeFile:n,boxSize:a},e.id))})})},tU=e=>{let{isLoading:t,handleSubmit:n,handleStop:a,canStop:r,isDisabled:i,...l}=e,c=(0,tR.ez)("unlimited_credits");return(0,o.jsxs)(b.s,{...l,children:[(0,o.jsx)(s.y,{boxSize:8,position:"absolute",zIndex:10,pointerEvents:"none",color:"deepocean.950",opacity:+!!t,transitionProperty:"common",transitionDuration:"normal"}),(0,o.jsx)(S.Tz,{placement:"top",label:r?(0,o.jsx)(x.T,{spacing:0,children:(0,o.jsx)(k.x6,{id:"ygCKqB"})}):(0,o.jsxs)(x.T,{spacing:0,children:[(0,o.jsx)(k.x6,{id:"9p1o+z"}),!c&&(0,o.jsx)(d.E,{color:"gray.400",children:(0,o.jsx)(tM.G,{type:"imageChat",ms:0})}),(0,o.jsx)(S.iM,{shortcut:"Enter"})]}),children:(0,o.jsx)(tP.K,{size:"sm",icon:r?(0,o.jsx)(j.g,{icon:tE.APi}):(0,o.jsx)(j.g,{icon:tE.fmP}),isDisabled:i,"aria-label":M.Ru._({id:"hQRttt"}),onClick:e=>{if(r){e.stopPropagation(),a();return}n()}})})]})},tH=e=>{let{onSubmit:t,onStop:n,inputRef:a,input:i,setInput:s,onUploadClick:d,isLoading:c,uploadedFiles:u,uploadFiles:p,removeFile:h,canSubmit:g}=e,m=(0,tu.dU)("deepocean.100","gray.700"),f=(0,tu.dU)("deepocean.600","deepocean.300"),y=(0,tu.dU)("white","elevation.1"),v=(0,tu.dU)("rgba(255, 255, 255, 0.8)","rgba(0, 0, 0, 0.8)"),b=M.Ru._({id:"OHwVfR"}),{onPaste:x}=tb({uploadFiles:p}),{...I}=tw({uploadFiles:p});return(0,o.jsx)(l.B,{spacing:0,children:(0,o.jsx)(l.B,{...I,spacing:1,position:"relative",borderRadius:"md",border:"1px solid",borderColor:m,transitionDuration:"normal",transitionProperty:"border-color","data-drop-text":b,sx:{"&:focus-within":{borderColor:f},"&.is-dragging-over":{"&::before":{content:"attr(data-drop-text)",position:"absolute",inset:0,bg:v,backdropFilter:"blur(8px)",borderRadius:"md",pointerEvents:"none",zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"lg",fontWeight:"semibold",color:"sky.600"}}},bg:y,children:(0,o.jsxs)(r.a,{borderRadius:"md",border:"none",p:2,pt:3,position:"relative",children:[(0,o.jsx)(tj._,{ref:a,placeholder:M.Ru._({id:"xOHKQG"}),value:i,onChange:e=>s(e.target.value),onKeyDown:e=>{if("Enter"===e.key&&!e.shiftKey){var t;e.preventDefault(),null==(t=e.currentTarget.form)||t.requestSubmit()}},onPaste:x,initialHeight:"30px",resizeOnMount:!1,fontSize:"md",m:0,p:0,px:1,maxHeight:"16rem",overflowY:"auto",borderRadius:"none",border:"none",sx:{"&:focus":{border:"none",outline:"none",boxShadow:"none"}},bg:y,_hover:{bg:"transparent"},_focus:{bg:"transparent"}}),(0,o.jsx)(tC.S,{in:u.length>0,animateOpacity:!0,children:(0,o.jsx)(tF,{uploadedFiles:u,removeFile:h,py:2,boxSize:"4.5rem"})}),(0,o.jsxs)(w.z,{mt:2,zIndex:1,h:8,children:[(0,o.jsx)(P.$,{colorScheme:"gray","aria-label":"Upload files",borderRadius:"md",size:"xs",leftIcon:(0,o.jsx)(j.g,{icon:E.QLR}),onClick:d,children:(0,o.jsx)(k.x6,{id:"ONWvwQ"})}),(0,o.jsx)(tS.h,{}),(0,o.jsx)(tU,{isLoading:c,handleSubmit:t,handleStop:n,canStop:c,isDisabled:!g&&!c,top:"1.5",insetEnd:"2",zIndex:10,spacing:2})]})]})})})},tq=e=>{let{status:t,messages:n,handleNewChat:a,manualSubmit:r,handleStop:i,lastTokensUsed:l}=e,s=(0,H.GV)(G.y3),d=(0,eI.u)("buddyDebug"),[c,u]=(0,h.useState)(""),p=(0,h.useRef)(null),{uploadedFiles:g,uploadFiles:m,openFilePicker:f,removeFile:y,resetFiles:v,isUploading:C,hiddenFileInput:S}=tv({focusInput:(0,h.useCallback)(()=>{var e;null==(e=p.current)||e.focus()},[])}),k="submitted"===t||"streaming"===t,A=!k&&!C&&(""!==c.trim()||g.length>0),T=(0,h.useCallback)(()=>{A&&(r(c,g),u(""),v())},[A,c,r,v,g]);(0,h.useEffect)(()=>{var e;null==(e=p.current)||e.focus()},[]);let z=(0,tu.dU)("sky.100","gray.700"),P=(0,tu.dU)("sky.50","gray.900");return(0,o.jsxs)(x.T,{direction:"column",align:"stretch",p:2,borderTop:"1px solid",borderColor:z,bg:P,children:[d&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(I.E,{maxW:"fit-content",children:["Last request: ",Math.trunc(l/1e3),"k/",Math.trunc(200),"k (",Math.trunc(l/2e5*100),"%) tokens used"]}),(0,o.jsx)(w.z,{spacing:2,overflowX:"auto",py:1,children:s.map(e=>(0,o.jsx)(tI,{cardInView:e},e.cardId))})]}),S,(0,o.jsxs)(b.s,{as:"form",onSubmit:e=>{e.preventDefault(),T()},direction:"column",children:[(0,o.jsx)(tH,{onSubmit:T,onStop:i,inputRef:p,input:c,setInput:u,onUploadClick:f,isLoading:k,uploadedFiles:g,uploadFiles:m,removeFile:y,canSubmit:A}),(0,o.jsx)(tz,{handleNewChat:a,messages:n})]})]})},tV=e=>{let{isReceivingMessages:t,messagesLength:n}=e,a=(0,h.useRef)(null),o=(0,h.useRef)(t),r=(0,h.useRef)(!1),i=(0,h.useRef)(null),l=(0,h.useRef)(!1);return(0,h.useEffect)(()=>{let e=o.current;o.current=t,!e&&t&&(r.current=!1);let s=()=>{a.current&&a.current.scrollIntoView({behavior:"auto",block:"end"})},d=()=>{let e=i.current;if(!e)return!1;let t=e.scrollTop;return e.scrollHeight-t-e.clientHeight<200},c=()=>{t&&!d()&&(r.current=!0)};n>0&&s();let u=i.current;if(u&&u.addEventListener("scroll",c),t){s();let e=setInterval(()=>{r.current||s()},100);return()=>{clearInterval(e),u&&u.removeEventListener("scroll",c)}}if(e&&!t){let e=0,t=setInterval(()=>{s(),++e>=10&&clearInterval(t)},100);return()=>{clearInterval(t),u&&u.removeEventListener("scroll",c)}}if(!l.current){l.current=!0;let e=0,t=setInterval(()=>{s(),++e>=10&&clearInterval(t)},100);return()=>{clearInterval(t),u&&u.removeEventListener("scroll",c)}}return()=>{u&&u.removeEventListener("scroll",c)}},[n,t]),{scrollToRef:a,scrollContainerRef:i}};var tW=n(31113),tG=n(27229),tJ=n(67909),tK=n(36071),tY=n(54731),tQ=n(17920),tZ=n(3674),t$=n(40691),tX=n(88738),t0=n(32617);let t1=e=>{let{buttonText:t="\uD83D\uDC1B",debugTitle:n,debugObject:a}=e,i=(0,t0.u)("buddyDebug"),{isOpen:l,onOpen:s,onClose:d}=(0,tG.j)(),c=(0,h.useCallback)(()=>{try{return tX.Bh(a)}catch(e){return"Error dumping YAML: ".concat(e instanceof Error?e.message:"Unknown error","\n\nRaw object:\n").concat(JSON.stringify(a,null,2))}},[a]);return i?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(P.$,{size:"xs",onClick:s,children:t}),(0,o.jsxs)(tJ.aF,{isOpen:l,onClose:d,size:"xl",children:[(0,o.jsx)(tK.m,{}),(0,o.jsxs)(tY.$,{children:[n&&(0,o.jsx)(tQ.r,{children:n}),(0,o.jsx)(tZ.s,{}),(0,o.jsx)(t$.c,{maxHeight:"80vh",overflow:"auto",children:(0,o.jsx)(r.a,{overflow:"auto",as:"pre",fontSize:"xs",children:c()})})]})]})]}):null};var t2=n(9329);function t3(){let e=(0,t2._)(["\n  0% {\n    background-position: 200% 0;\n  }\n  100% {\n    background-position: -200% 0;\n  }\n"]);return t3=function(){return e},e}let t5=(0,n(83004).i7)(t3()),t6=e=>{let{children:t,...n}=e,a=(0,tu.dU)("linear(to-r, deepocean.400 0%, deepocean.700 50%, deepocean.400 100%)","linear(to-r, deepocean.300 0%, deepocean.500 50%, deepocean.300 100%)");return(0,o.jsx)(d.E,{...n,backgroundClip:"text",bgGradient:a,backgroundSize:"200% 100%",animation:"".concat(t5," 3s linear infinite"),children:t})},t4=e=>{let{invocation:t}=e,n="result"===t.state&&t.result,a=(0,tu.dU)("deepocean.800","deepocean.300");if(!n){let e=e4(t.toolName).present()||M.Ru._({id:"Z3FXyt"});return(0,o.jsxs)(w.z,{justify:"center",align:"center",children:[(0,o.jsx)(s.y,{size:"xs",color:"deepocean.500"}),(0,o.jsxs)(t6,{fontSize:"sm",fontWeight:"semibold",children:[e,"..."]})]})}return e7(t)?(0,o.jsxs)(w.z,{justify:"space-between",w:"100%",children:[(0,o.jsxs)(d.E,{fontSize:"sm",color:"red.600",fontWeight:"semibold",children:["Error: ",t.result.error]}),(0,o.jsx)(t1,{buttonText:t.toolName,debugTitle:"".concat(t.toolName," (ERROR)"),debugObject:{args:t.args,...t.result}})]}):e9(t)?(0,o.jsxs)(w.z,{justify:"space-between",width:"100%",children:[(0,o.jsx)(d.E,{fontSize:"xs",color:a,fontWeight:"semibold",children:(0,o.jsxs)(w.z,{children:[(0,o.jsx)(j.g,{icon:tE.p7g}),(0,o.jsx)(d.E,{fontSize:"sm",children:e4(t.toolName).past()})]})}),(0,o.jsx)(t1,{debugTitle:t.toolName,debugObject:{args:t.args,...t.result}})]}):null};var t8=n(12417),t7=n(17859),t9=n(83743);let ne=e=>{let{variant:t,onClick:n,ariaLabel:a,...r}=e,i="go-back"===t;return(0,o.jsx)(P.$,{variant:i?"ghost":"plain",size:"xs",onClick:n,"aria-label":a||(i?"Go back":"Cancel"),rightIcon:(0,o.jsx)(j.g,{icon:i?E.U23:E.XOT,fixedWidth:!0}),...r,children:i?(0,o.jsx)(k.x6,{id:"CKyk7Q"}):(0,o.jsx)(k.x6,{id:"dEgA5A"})})};var nt=n(91792),nn=n(65950),na=n(83049),no=n(11818);let nr=h.memo(e=>{let{initialContent:t,isSelected:n,showSelectedBorder:a,interactionId:i,cardIds:s,themeId:d,children:c,...u}=e,p=J(),[g,m]=(0,h.useState)(!1),f=(0,H.GV)((0,V.c8)(d));return((0,nt.rd)(),(0,no.NC)(f),(0,h.useEffect)(()=>{requestAnimationFrame(()=>{m(!0)})},[]),g)?(0,o.jsx)(na.q,{initialContent:t,theme:f,onCreate:e=>{e.gammaOrgId=(0,Y.gx)(),e.gammaDocId=p.editor.gammaDocId,requestAnimationFrame(()=>{(0,et.Sg)({editor:e,content:t,theme:f,interactionId:i})})},children:(0,o.jsxs)(l.B,{justify:"start",align:"start",spacing:1,pos:"relative",...u,children:[s.map(e=>(0,o.jsx)(r.a,{borderRadius:"md",border:"1px solid",borderColor:"gray.200",overflow:"hidden",...a&&{cursor:"pointer"},...n&&a&&{borderColor:"trueblue.500",border:"2px solid"},...!n&&a&&{borderColor:"gray.200",border:"2px solid"},children:(0,o.jsx)(nn.N,{cardId:e},e)},e)),c]})}):null});nr.displayName="DocEditorPreview";let ni=(0,h.memo)(e=>{let{variation:t}=e,n=J(),a=(0,H.GV)((0,G.B3)(t)),{themeId:r,jsonContent:i}=(0,H.GV)((0,G.BV)(t.toApplyCheckpointId)),l=[t.previewCardIds[0]],s=(0,h.useCallback)(()=>{a||eh.applyResultVariation(n,t),eh.focusResultVariation(n,t)},[n,a,t]);return(0,o.jsx)(b.s,{overflow:"hidden",role:"group",transitionProperty:"height border",transitionDuration:"0.2s",flexDirection:"column",justifyContent:"start",position:"relative",align:"center",maxH:"200px",css:{"--editor-width":"176px","--line-thickness":"1px"},children:(0,o.jsxs)(nr,{initialContent:i,themeId:r,cardIds:l,showSelectedBorder:!0,isSelected:a,onClick:s,interactionId:t.messageId,children:[(0,o.jsx)(I.E,{colorScheme:"sky",variant:"subtle",position:"absolute",bottom:1,insetEnd:1,zIndex:1,children:t.name}),a&&(0,o.jsx)(I.E,{colorScheme:"deepocean",bg:"deepocean.500",variant:"solid",position:"absolute",top:0,borderTopRadius:"none",color:"white",left:"50%",transform:"translateX(-50%)",zIndex:2,fontSize:"xs",opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:(0,o.jsx)(k.x6,{id:"9krCfL"})})]})})});ni.displayName="MessageResultCardVariation";let nl=(0,h.memo)(e=>{let{variation:t}=e,n=J(),a=(0,H.GV)((0,G.B3)(t)),{themeId:r,jsonContent:i}=(0,H.GV)((0,G.BV)(t.toApplyCheckpointId)),l=t.previewCardIds,s=(0,tu.dU)("gray.50","gray.700"),d=(0,tu.dU)("trueblue.500","trueblue.400"),c=(0,tu.dU)("trueblue.600","trueblue.400"),u=(0,tu.dU)("trueblue.300","trueblue.500"),p=(0,h.useCallback)(()=>{if(!a)return void eh.applyResultVariation(n,t);eh.focusResultVariation(n,t)},[n,a,t]);return(0,o.jsxs)(b.s,{borderRadius:"md",bg:s,border:"2px solid",borderColor:a?d:"transparent",outline:a?"1px solid var(--chakra-colors-trueblue-500)":"none",_hover:{borderColor:a?c:u},p:1,overflow:"hidden",role:"group",transitionProperty:"height border",transitionDuration:"0.2s",flexDirection:"column",justifyContent:"start",onClick:p,cursor:"pointer",position:"relative",align:"center",maxH:"300px",css:{"--editor-width":"166px","--line-thickness":"1px"},children:[(0,o.jsx)(nr,{initialContent:i,themeId:r,cardIds:l,showSelectedBorder:!1,interactionId:t.messageId}),(0,o.jsx)(I.E,{colorScheme:"sky",variant:"subtle",position:"absolute",bottom:1,insetEnd:1,zIndex:1,children:t.name}),a&&(0,o.jsx)(I.E,{colorScheme:"deepocean",bg:"deepocean.500",variant:"solid",position:"absolute",top:0,borderTopRadius:"none",color:"white",insetStart:"50%",transform:"translateX(-50%)",zIndex:2,fontSize:"xs",opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:(0,o.jsx)(k.x6,{id:"0MgdN+"})})]})});nl.displayName="MessageResultDeckVariation";let ns=e=>{let{title:t,children:n}=e,a=(0,tu.dU)("titanium.900","deepocean.300"),i=(0,tu.dU)("gray.100","gray.700"),s=(0,tu.dU)("deepocean.800","deepocean.300");return(0,o.jsx)(l.B,{p:2,border:"1px solid",borderColor:i,align:"space-between",w:"100%",borderRadius:"md",children:(0,o.jsxs)(w.z,{justify:"space-between",w:"100%",children:[(0,o.jsxs)(w.z,{children:[(0,o.jsx)(r.a,{color:s,children:(0,o.jsx)(j.g,{icon:tE.QRE,fixedWidth:!0,size:"sm"})}),(0,o.jsx)(d.E,{fontSize:"sm",fontWeight:"semibold",color:a,children:t})]}),n]})})},nd=e=>{let{result:t,showCancelButton:n,cancelRollback:a,onGoBack:i,state:s,ratings:c}=e,u=(0,tu.dU)("deepocean.800","deepocean.300");return"done"===s?(0,o.jsx)(ns,{title:t.title,children:(0,o.jsx)(ne,{variant:"go-back",onClick:i})}):(0,o.jsxs)(l.B,{align:"space-between",w:"100%",children:[(0,o.jsxs)(w.z,{justify:"space-between",w:"100%",py:2,pb:0,border:"1px solid",borderColor:"transparent",children:[(0,o.jsxs)(w.z,{spacing:1,children:[(0,o.jsx)(r.a,{color:u,children:(0,o.jsx)(j.g,{icon:E.B4x,fixedWidth:!0,size:"sm"})}),(0,o.jsx)(d.E,{fontSize:"sm",fontWeight:"semibold",children:(0,o.jsx)(k.x6,{id:"kNTUcC"})})]}),n&&(0,o.jsx)(ne,{variant:"cancel",onClick:a})]}),(0,o.jsxs)(l.B,{spacing:4,children:[(0,o.jsx)(t9.r,{columns:2,spacing:1,children:t.variations.map((e,t)=>"doc"===e.previewType?(0,o.jsx)(nl,{variation:e},t):(0,o.jsx)(ni,{variation:e},t))}),(0,o.jsxs)(w.z,{justify:"space-between",w:"100%",children:[(0,o.jsx)(d.E,{fontSize:"xs",children:(0,o.jsx)(k.x6,{id:"5gB/9E"})}),(0,o.jsx)(r.a,{children:c})]})]})]})};var nc=n(56570),nu=n(79536);let np=e=>{let{result:t,state:n,ratings:a}=e,{isOpen:i,onOpen:s,onClose:c}=(0,tG.j)(),u="current"===n||i,p=(0,H.GV)(V.ST),g=(0,H.GV)(W.SJ),m=(0,q.d)(),f=(0,tu.dU)("deepocean.800","deepocean.300"),y=(0,h.useCallback)(e=>{m(e)},[m]);return u?(0,o.jsxs)(l.B,{align:"space-between",w:"100%",children:[(0,o.jsxs)(w.z,{justify:"space-between",w:"100%",px:0,pb:0,border:"1px solid",borderColor:"transparent",children:[(0,o.jsxs)(w.z,{children:[(0,o.jsx)(r.a,{color:f,children:(0,o.jsx)(j.g,{icon:E.B4x,fixedWidth:!0,size:"sm"})}),(0,o.jsx)(d.E,{fontSize:"sm",fontWeight:"semibold",children:(0,o.jsx)(k.x6,{id:"9KqPc+"})})]}),i&&(0,o.jsx)(P.$,{variant:"ghost",size:"xs",onClick:c,"aria-label":"close",rightIcon:(0,o.jsx)(j.g,{icon:E.bnw,fixedWidth:!0}),children:(0,o.jsx)(k.x6,{id:"yz7wBu"})})]}),(0,o.jsx)(l.B,{spacing:4,children:(0,o.jsx)(nc.x,{templateColumns:{base:"repeat(2, 1fr)",md:"repeat(2, 1fr)"},gap:3,children:t.themes.map(e=>{let{themeId:t,wasOriginal:n}=e,a=p.find(e=>e.id===t);return a?(0,o.jsxs)(r.a,{position:"relative",children:[(0,o.jsx)(nu.e,{theme:a,isChecked:(null==g?void 0:g.id)===t,onThemeClicked:y,variant:"ghost-bordered",disableEditing:!0,previewHeightEm:6,compact:!0},t),n&&(0,o.jsx)(I.E,{colorScheme:"sky",variant:"subtle",position:"absolute",bottom:1,insetEnd:1,zIndex:1,children:(0,o.jsx)(k.x6,{id:"HxF6Fk"})})]},t):null})})}),(0,o.jsx)(r.a,{display:"flex",justifyContent:"flex-end",children:a})]}):(0,o.jsx)(ns,{title:t.title,children:(0,o.jsx)(P.$,{variant:"ghost",size:"xs",onClick:s,"aria-label":"Open",rightIcon:(0,o.jsx)(j.g,{icon:E.fyG,fixedWidth:!0}),children:(0,o.jsx)(k.x6,{id:"1TNIig"})})})},nh=e=>{let{message:t,lastUserMessage:n,result:a,state:r,cancelRollback:i,onGoBack:l,chatId:s}=e,d="rolling-back"===r,c=(0,o.jsx)(nm,{chatId:s,result:a,message:t,lastUserMessage:n});return"suggest-themes"===a.type?(0,o.jsx)(np,{result:a,state:r,ratings:c}):"suggest-images"===a.type?(0,o.jsx)("div",{children:"NOT IMPLEMENTED"}):"applied-changes"===a.type?(0,o.jsx)(nd,{result:a,cancelRollback:i,showCancelButton:d,state:r,onGoBack:l,ratings:c}):null},ng=[{key:"instructions",label:(0,o.jsx)(k.x6,{id:"Tq32Jp"})},{key:"incorrect-information",label:(0,o.jsx)(k.x6,{id:"UZQ7Jv"})},{key:"too-many-changes",label:(0,o.jsx)(k.x6,{id:"YI0lXP"})},{key:"formatting",label:(0,o.jsx)(k.x6,{id:"TO8fPE"})}],nm=h.memo(e=>{var t;let{result:n,message:a,lastUserMessage:r,chatId:i}=e,[l,s]=(0,h.useState)(null),d=null==(t=a.parts)?void 0:t.filter(e=>"tool-invocation"===e.type).map(e=>e.toolInvocation),c=null==d?void 0:d.map(e=>e.toolName).reduce((e,t)=>{var n;return e[t]=(null!=(n=e[t])?n:0)+1,e.all+=1,e},{all:0}),u=(0,h.useCallback)(e=>{s(e),(0,t7.yC)({chatId:i,toolInvocations:d,toolCount:c,rating:e,interactionId:n.messageId,messageId:n.messageId,userMessage:null==r?void 0:r.content,agentType:"Buddy"})},[i,d,c,n.messageId,null==r?void 0:r.content]),p=(0,h.useCallback)((e,t,a)=>{(0,t7.Y2)({chatId:i,toolInvocations:d,toolCount:c,rating:e,interactionId:n.messageId,messageId:n.messageId,feedback:t,userMessage:null==r?void 0:r.content,tags:a,agentType:"Buddy"})},[i,d,c,n.messageId,null==r?void 0:r.content]);return(0,o.jsx)(t8.f3,{setRating:u,RatingButtons:t8.Ep,size:"xs",rating:null!=l?l:void 0,trackFeedback:p,feedbackTags:ng})});nm.displayName="MessageResultRatings";let nf=e=>e.reduce((t,n,a)=>a===e.length-1?[...t,n]:[...t,n,(0,o.jsx)("br",{},"br-".concat(a))],[]),ny=e=>{let{content:t}=e,n=nf(t.trim().split("\n"));return(0,o.jsx)(b.s,{whiteSpace:"pre-wrap",textOverflow:"ellipsis",overflow:"hidden",direction:"column",maxW:"100%",children:(0,o.jsx)(d.E,{children:n})})},nv=e=>{var t;let{message:n,chatId:a,messageIndex:r,goBackToMessage:i,isLast:l,lastUserMessage:s,...c}=e,u=(0,H.GV)(G.RR),p=(0,H.GV)((0,G.fN)(n.id)),g="done";u===r?g="rolling-back":l&&(g="current");let m=eO(),f=(0,h.useCallback)(()=>{i(n)},[i,n]);return(0,o.jsxs)(x.T,{...tW.i,p:0,alignSelf:"flex-start",width:"100%",position:"relative",align:"start",...c,children:[null==(t=n.parts)?void 0:t.map((e,t)=>{if("text"===e.type)return"USER_ABORTED"===e.text?(0,o.jsx)(d.E,{fontSize:"xs",fontWeight:"semibold",children:(0,o.jsx)(k.x6,{id:"7175a1"})},t):(0,o.jsx)(ny,{content:e.text},t);if("tool-invocation"===e.type){let t=e.toolInvocation;return(0,o.jsx)(t4,{invocation:t},"".concat(t.toolCallId,"-result"))}return null}),p&&(0,o.jsx)(nh,{chatId:a,message:n,lastUserMessage:s,result:p,state:g,onGoBack:f,cancelRollback:m})]})},nb=e=>{let t,{message:n}=e,a=n.content.replace("the current deck is ","");try{t=JSON.parse(a)}catch(e){t=null}return(0,o.jsxs)(l.B,{children:[(0,o.jsx)(t1,{buttonText:"Current Deck",debugTitle:"Current Deck",debugObject:t||{error:"Failed to parse current deck JSON",rawContent:a}}),t&&(0,o.jsxs)(d.E,{fontSize:"xs",fontWeight:"bold",children:["docHtml.type: ",t.docHtml.type]}),t&&"selection"in t&&(0,o.jsxs)(l.B,{fontSize:"xs",wordBreak:"break-all",overflowY:"auto",width:"250px",children:[(0,o.jsx)(d.E,{fontSize:"xs",fontWeight:"bold",children:"Selection"}),Object.entries(t.selection||{}).map((e,t)=>{let[n,a]=e;return(0,o.jsxs)(r.a,{children:[(0,o.jsx)("b",{children:n}),(0,o.jsx)("br",{}),a]},t)})]})]})},nw=e=>{let{url:t,name:n}=e,{isZoomed:a,enterZoom:i,exitZoom:l}=(0,tL.RL)(t),s=(0,h.useCallback)(()=>{i()},[i]);return(0,o.jsxs)(r.a,{position:"relative",children:[(0,o.jsx)(t_.Me,{src:t,alt:n,boxSize:"64px",objectFit:"cover",borderRadius:"md",border:"1px solid",borderColor:"gray.200",cursor:"zoom-in",onClick:s,resizeParams:t_.p7}),(0,o.jsx)(tL.Gx,{isZoomed:a,exitZoom:l,editor:{isThumbnail:!1,isEditable:!1},children:(0,o.jsx)(b.s,{justify:"center",align:"center",h:"100%",w:"100%",children:(0,o.jsx)(t_.Me,{src:t,alt:n,maxW:"90vw",maxH:"90vh",objectFit:"contain"})})})]})},nx=e=>{var t,n;let{message:a,...r}=e,i=(0,eI.u)("buddyDebug"),s=(0,tu.dU)("periwinkle.100","periwinkle.900"),c=(0,tu.dU)("titanium.900","white");if("current-deck"===a.id)return i?(0,o.jsx)(x.T,{...tW.i,...r,bg:s,color:c,maxW:"90%",alignSelf:"flex-end",borderBottomEndRadius:"0",align:"start",children:(0,o.jsx)(nb,{message:a})}):null;let u=null!=(n=null==(t=a.experimental_attachments)?void 0:t.filter(e=>{var t;return null==(t=e.contentType)?void 0:t.startsWith("image")}))?n:[];return(0,o.jsxs)(l.B,{children:[(null==u?void 0:u.length)>0&&(0,o.jsx)(w.z,{flexDirection:"row-reverse",w:"100%",children:u.map(e=>(0,o.jsx)(nw,{url:e.url,name:e.name},e.url))}),(0,o.jsx)(x.T,{...tW.i,...r,bg:s,color:c,maxW:"90%",alignSelf:"flex-end",borderBottomEndRadius:"0",align:"start",children:(0,o.jsx)(d.E,{children:a.content})})]})},nI=(0,h.memo)(e=>{let{height:t}=e;return(0,o.jsx)(r.a,{height:t,width:"100%"})});nI.displayName="Spacer";let nC=e=>{let{chatId:t,messages:n,goBackToMessage:a,isReceivingMessages:r}=e,i=(0,H.GV)(G.RR),{scrollToRef:l,scrollContainerRef:s}=tV({isReceivingMessages:r,messagesLength:n.length});return(0,o.jsxs)(x.T,{ref:s,fontSize:"14px",spacing:4,px:0,width:"100%",alignItems:"stretch",flex:1,p:4,overflowY:"auto",children:[n.map((e,r)=>{if(null!=i&&i<r)return null;if("assistant"===e.role){let i;return r>0&&"user"===n[r-1].role&&(i=n[r-1]),(0,o.jsx)(nv,{chatId:t,message:e,messageIndex:r,goBackToMessage:a,isLast:r===n.length-1,lastUserMessage:i},e.id)}return"user"===e.role?(0,o.jsx)(nx,{message:e},e.id):null}),(0,o.jsx)(nI,{height:"20px"}),(0,o.jsx)("div",{ref:l})]})};var nS=n(68917),nk=n(78140),nA=n(36999),nT=n(41283),nz=n(85595);let nP=e=>{let{testCases:t,onSelectTestCase:n,isRunning:a,...r}=e;return(0,o.jsxs)(nk.W,{children:[(0,o.jsx)(nA.I,{as:P.$,rightIcon:(0,o.jsx)(nS.D,{}),size:"sm",...r,children:"Test Cases"}),(0,o.jsx)(nT.c,{children:t.map((e,t)=>(0,o.jsx)(nz.D,{isDisabled:a,onClick:()=>n(e),children:(0,o.jsx)(d.E,{fontSize:"sm",children:e.description})},t))})]})},nE=(0,h.memo)(e=>{var t;let{saveChat:n,...a}=e,r=(0,H.CU)(),i=(0,H.jL)(),l=(0,H.GV)(G.eb),s=(0,H.GV)(W.sX),d=(0,z.d)(),c=(0,h.useRef)((0,O.O)()),u=(0,h.useRef)(null),p=(0,H.GV)(G.G);(0,K.t)();let g=(0,H.GV)(G.TD),m=(0,H.GV)(G.ZT),y=J(),v=(0,h.useRef)(),b=(0,h.useRef)(null),I=(0,h.useRef)(""),[C,S]=(0,h.useState)(0),k=(0,q.d)(),A=(0,h.useCallback)(e=>{let t=(0,V.ST)(r.getState()).find(t=>t.id===e);t&&k(t)},[k,r]);eQ(l);let D=(0,h.useRef)(g),{messages:B,setInput:L,isLoading:_,setMessages:U,reload:Q,status:Z,stop:$}=(0,T.Y_)({id:p,initialMessages:g,api:"".concat(f.$.API_HOST,"/ai/agent/message?agentName=Buddy"),credentials:"include",streamProtocol:"data",maxSteps:25,body:{messageId:c.current,workspaceId:(0,Y.gx)(),context:{type:"doc",docId:s}},onError:e=>{d({title:"Chat error",description:e.message,position:"top",status:"error",duration:3e3})},onFinish:async(e,t)=>{let{finishReason:a,usage:o}=t;S(o.promptTokens),c.current=(0,O.O)(),await new Promise(e=>setTimeout(e,0)),console.log("[buddy] onFinish",{message:e,finishReason:a,status:Z,statusRef:I.current}),("tool-calls"!==a||"ready"===I.current)&&(te(r,l,e,b.current),et(),b.current=null,await new Promise(e=>setTimeout(e,0)),await n(en()))},onToolCall:async e=>{let{toolCall:t}=e;u.current=new AbortController,console.log("[buddy] onToolCall",{messageId:v.current,toolCall:t,status:Z,statusRef:I.current});try{let e=r.getState(),n=(0,G.eb)(e),a=(0,W.SJ)(e);if(!n)throw Error("Cannot perform tool call without an editor");let o=!1;b.current||(o=!0,b.current=eN(n,a.id));let i=v.current,l={editor:n,store:r,imageOptions:y.imageOptions,theme:a,abortController:u.current,applyTheme:A},s=eL[t.toolName];if(!s)throw Error("Invalid tool ".concat(t.toolName));let d=await s.execute(t.args,l,t,i);if(d.messageId=i,u.current=null,o)return{...d,beforeCheckpointId:b.current.id};return d}catch(e){var n,a;if(u.current=null,(null==(n=e.message)?void 0:n.includes("Request was cancelled"))||(null==(a=e.message)?void 0:a.includes("aborted"))||"AbortError"===e.name)throw e;return console.log(e.stack),{status:"error",error:e.message,messageId:v.current}}}});v.current=null==(t=B[B.length-1])?void 0:t.id,I.current=Z,D.current=B;let{startTestCase:X,isRunning:ee,markFinish:et}=ts({reload:Q,setMessages:U,isLoading:_}),en=(0,h.useCallback)(()=>(0,G.W0)(D.current)(r.getState()),[r]);e5(B,en),D.current=B;let ea=(0,h.useCallback)(e=>{let t=tc(s||"");i((0,G.ZQ)({isUnloading:e,newChatId:t})),U([])},[i,s,U]),eo=eF(B),er=(0,h.useCallback)((e,t,n)=>{if(!l)return;let a=(0,G.KF)(r.getState()),o=(0,W.SJ)(r.getState()),s=eh.getDeckInfo({editor:l,store:r,imageOptions:y.imageOptions,theme:o},n);U(n=>{a&&(n=n.slice(0,a.messageIndex+1),i((0,G._i)()));let o=n.filter(e=>"current-deck"!==e.id),r="the current deck is ".concat(JSON.stringify(s)),l={id:(0,R.Ak)(),role:"user",content:e,experimental_attachments:t.map(e=>({url:e.src,contentType:e.mimeType,name:e.name}))};return L(""),[...o,{id:"current-deck",role:"user",content:r,parts:[{type:"text",text:r}]},l]}),Q()},[i,l,Q,L,U,r,y]);(0,h.useEffect)(()=>{m&&("ready"===I.current?er(m.message,[],m.context):d({title:M.Ru._({id:"cii4bX"}),description:M.Ru._({id:"wqxsb/"}),position:"top",status:"warning",duration:5e3}),i((0,G.z8)()))},[i,er,m,L,d]);let ei=(0,h.useCallback)(()=>{var e;$(),null==(e=u.current)||e.abort();let t=B[B.length-1];U(F.Uv),console.log("handle stop DONE",{lastMessage:t,beforeCheckpointRef:b.current,status:Z,aiSdkMessageIdRef:v.current,statusRef:I.current}),te(r,l,t,b.current),b.current=null},[$,B,U,Z,r,l]);return(0,o.jsxs)(x.T,{...a,justifyContent:"space-between",align:"stretch",position:"relative",height:"100%",spacing:0,children:[(0,o.jsxs)(w.z,{display:"none",children:[(0,o.jsx)(P.$,{position:"absolute",size:"sm",boxShadow:"base",leftIcon:(0,o.jsx)(j.g,{icon:E.V3T,fixedWidth:!0}),borderRadius:"full",variant:"plain",isDisabled:_,onClick:()=>ea(!1),"aria-label":"",top:2,insetStart:4,zIndex:1,children:"reset"}),(0,o.jsx)(nP,{testCases:tl,onSelectTestCase:e=>{X(l,e)},isRunning:ee,position:"absolute",top:2,insetEnd:4,zIndex:1})]}),!B.length&&(0,o.jsx)(N,{}),B.length>0&&(0,o.jsx)(nC,{chatId:p,messages:B,goBackToMessage:eo,isReceivingMessages:_}),(0,o.jsx)(tq,{status:Z,messages:B,handleNewChat:()=>ea(!1),manualSubmit:er,handleStop:ei,editor:l,lastTokensUsed:C})]})});nE.displayName="Toolbar";var nj=n(3247),nM=n(33633),nR=n(647),nD=n(95563),nB=n(17928),nL=n(74158);let n_={createCard:e=>new eT(e),duplicateCard:e=>new eE(e),editCardById:e=>new eM(e),removeCards:e=>new eD(e),editAllCards:e=>new eM(e),moveCard:e=>new ex(e),setCardHtml:()=>{throw Error("Not implemented")},focusCardById:()=>{throw Error("Not implemented")},revertToCheckpoint:()=>{throw Error("Not implemented")},suggestThemes:()=>{throw Error("Not implemented")},readUrl:()=>{throw Error("Not implemented")},webSearch:()=>{throw Error("Not implemented")}},nN=()=>{let e=(0,H.GV)(W.sX),t=(0,H.CU)(),n=(0,H.jL)(),[a,o]=(0,h.useState)(!1);return(0,h.useEffect)(()=>{(async()=>{var t;let a=null==(t=(0,Y.HW)())?void 0:t.id,r=(0,Y.gx)();if(!a||!r||!e){console.error("[useBuddyPersistence] Missing user, workspace or doc context, skipping load"),o(!0);return}try{let t=await e3.loadChat({docId:e,workspaceId:(0,Y.gx)(),userId:(0,Y.HW)().id});if(null==t?void 0:t.chatData){let{chatData:e}=t,a={chatId:e.chatId||tc(t.docId),initialMessages:e.messages,checkpoints:e.checkpoints,chosenResultVariations:e.chosenResultVariations,results:e.results,suggestions:e.suggestions.reduce((e,t)=>{let n=function(e){let t=n_[e.type];if(!t)throw Error("Unknown suggestion type: ".concat(e.type));try{return t(e.input)}catch(t){return console.error("[loadBuddySuggestion] Error loading suggestion ".concat(e.type),t),null}}(t);return n?{...e,[n.id]:n}:(console.warn("[BuddySlice] Failed to load suggestion ".concat(t.type)),e)},{})};console.log("LOADING BUDDY CHAT",a),n((0,G.yB)(a))}else n((0,G.ZQ)({isUnloading:!1,newChatId:tc(e)}))}catch(t){console.error("[useBuddyPersistence] Failed to load initial data, potentially corrupt -- Deleting",t),await e3.deleteChat({docId:e,workspaceId:r,userId:a}),n((0,G.ZQ)({isUnloading:!1,newChatId:tc(e)}))}finally{o(!0)}})()},[t,n,e]),{saveChat:(0,h.useCallback)(async t=>{var n;let a=null==(n=(0,Y.HW)())?void 0:n.id,o=(0,Y.gx)();if(!a||!o||!e)return void console.error("[useBuddyPersistence] Missing user, workspace or doc context, skipping save");let r=e0({userId:a,workspaceId:o,docId:e,chatData:t});if(r)try{await e3.saveChat(r),console.log("[useBuddyPersistence] Saved chat state for doc: ".concat(r.docId),{messages:t.messages})}catch(e){console.error("[useBuddyPersistence] Failed to save chat:",e)}},[e]),isLoaded:a}},nO=e=>{let{closePanel:t}=e,n=(0,nt.rd)(),{saveChat:a,isLoaded:r}=nN();return(0,o.jsx)(S.L8,{isDark:n,children:(0,o.jsx)(nR.Z,{bgColor:n?"gray.800":"white",w:"100%",color:n?"white":"titanium.900",children:(0,o.jsxs)(b.s,{direction:"column",w:"100%",h:"100%",children:[(0,o.jsxs)(w.z,{position:"relative",py:2,px:4,children:[(0,o.jsx)(b.s,{flex:1,children:(0,o.jsx)(x.T,{align:"start",spacing:0,children:(0,o.jsx)(nD.N,{children:(0,o.jsxs)(w.z,{align:"center",children:[(0,o.jsx)(k.x6,{id:"mw/rmM"}),(0,o.jsx)(I.E,{colorScheme:"purple",size:"sm",children:(0,o.jsx)(k.x6,{id:"YBt9YP"})})]})})})}),(0,o.jsx)(C.J,{onClick:t})]}),(0,o.jsx)(b.s,{direction:"column",h:"100%",overflowY:"auto",overflowX:"hidden",className:"".concat("design-partner-panel-wrapper"," buddy-scroll"),w:"100%",children:r&&(0,o.jsx)(nE,{saveChat:a})})]})})})};nO.panelPosition="right",nO.panelName="buddy-chat",nO.canCollapse=!1,nO.minWidth=400,nO.alwaysDocked=!0;let nF=()=>{let e=(0,H.jL)(),t=(0,H.GV)(W.wC),n=(0,H.GV)(W.Ik),a=t!==eW.w.SLIDE_VIEW&&n,{togglePanel:o,isPanelOpen:r}=(0,nM.ww)(nO,a);return(0,h.useEffect)(()=>nB.LF.on("queueBuddyEditMessage",t=>{e((0,G.R)(t)),o({disableTransition:!0,override:"open"})}),[e,o]),{toggleBuddyChatPanel:o,isBuddyChatPanelOpen:r}},nU=()=>{let e=(0,t0.u)("buddyEdit"),{toggleBuddyChatPanel:t}=nF();(0,h.useEffect)(()=>{if(e)return nj.WC.on("keydown","buddy-chat",e=>(!!(0,A.U0)()&&!!e.metaKey||!!e.ctrlKey)&&"e"===e.key&&(e.preventDefault(),t({disableTransition:!0}),!0))},[t,e])},nH=e=>{let t=(0,H.jL)(),{setMessages:n}=(0,T.Y_)({id:tc(e)});return(0,h.useCallback)(()=>{t((0,G.ZQ)({isUnloading:!0})),n([])},[t,n])},nq=(e,t)=>{let n=nH(t);(0,h.useEffect)(()=>{e&&t&&e.on("destroy",()=>{console.log("[buddy persistence] unload buddy chat"),n()})},[t,e,n])};var nV=n(65280),nW=n(5291),nG=n(59190),nJ=n(30188),nK=n(82927),nY=n(85057),nQ=n(10817),nZ=n(53907),n$=n(91242);let nX=()=>{let e=document.createElement("span");e.classList.add("collaboration-cursor__caret","streaming-cursor"),e.setAttribute("style","border-color: var(--chakra-colors-trueblue-100)");let t=document.createElement("div");return t.classList.add("collaboration-cursor__label","streaming-cursor__label"),t.setAttribute("style","background-color: var(--chakra-colors-trueblue-100); color: var(--chakra-colors-trueblue-400)"),e.insertBefore(t,null),e},n0=A.YY.create({name:"aiGeneration",addOptions:()=>({provider:null}),addStorage:()=>({generationEnabled:!1}),onCreate(){let{provider:e}=this.options;e&&e.awareness&&e.awareness.on("change",()=>{if(!e.awareness)return;let t=!1;for(let[n,a]of e.awareness.getStates())a.isStreaming&&n!==e.awareness.clientID&&(t=!0);let n=(0,H.KA)();(0,nZ.kg)(n.getState())!==t&&n.dispatch((0,nZ.gR)(t))})},addCommands(){return{setAIGenerationRunning:e=>()=>{var t,n;return this.storage.generationEnabled=e,null==(n=this.options.provider)||null==(t=n.awareness)||t.setLocalStateField("isStreaming",e),!0}}},addProseMirrorPlugins(){let{storage:e}=this;return[new el.k_({key:new el.hs("aiGeneration"),props:{decorations(t){if(!e.generationEnabled)return a.zF.empty;let n=[],o=t.doc.content.size-2,r=(0,A.eL)(t.doc.resolve(o),ev.jg),i=r?(0,n$.s)(t.doc.resolve(r.pos),-1):null;return i&&r&&(n.push(a.NZ.widget(i.from,nX,{key:"sal",side:10})),n.push(a.NZ.node(r.pos,r.pos+r.node.nodeSize,{class:"ai-generate-streaming-card"}))),a.zF.create(t.doc,n)}}})]}});var n1=n(15440);let n2=()=>new el.k_({key:n1.G,state:{init:()=>new n1.Z,apply:(e,t,n,a)=>t.apply(e,a)}}),n3=A.YY.create({name:"aiModifications",onCreate(){this.options.document.on("afterAllTransactions",e=>{let t=n1.G.getState(this.editor.view.state);t&&t.flushMoveInstructionQueue(this.editor.view.state)})},addProseMirrorPlugins:()=>[n2()],addCommands:()=>({setInteractionRange:(e,t)=>n=>{let{tr:a}=n;return a.setMeta("aiModificationAction",{type:"setInteractionRange",rangeId:e,range:t}),!0}})});var n5=n(93298),n6=n(6018),n4=n(69551),n8=n(23513),n7=n(53615),n9=n(67200),ae=n(23050),at=n(91656);let an=e=>{let{selection:t}=e,n=t.$head||t.$anchor,a=(0,A.eL)(n,e=>"paragraph"===e.type.name||(0,at.x)(e));return a&&a.node.content.size?a:null},aa=e=>{let{view:t,state:n,isFlagEnabled:a,editor:o}=e;if(!a)return null;let{selection:r}=n,{empty:i}=r,l=ae.nD.getState(n),s=an(n),d=null==l?void 0:l.loading;return t.hasFocus()&&i&&s&&o.isEditable&&!d?s:null},ao=e=>new el.k_({key:ae.nD,state:{init:()=>({loading:!1,insertedRange:null,interactionId:null}),apply(e,t){let n=e.getMeta("autocompleteEvent");return(null==n?void 0:n.type)==="reset"?{loading:!1,insertedRange:null,interactionId:null}:(null==n?void 0:n.type)==="load"?{loading:!0,insertedRange:null,interactionId:null}:(null==n?void 0:n.type)==="insert"?{loading:!1,insertedRange:n.range,interactionId:n.interactionId}:(0,n9.Xq)(e)?{loading:!1,insertedRange:null,interactionId:null}:t}},props:{handleKeyDown(t,n){var a,o,r;if("Tab"!==n.key){let n=ae.nD.getState(t.state);return(null==n?void 0:n.insertedRange)&&e.commands.setMeta("autocompleteEvent",{type:"reset"}),!1}let{state:i}=t,l=aa({view:t,state:i,isFlagEnabled:eI.of.get("arrowAutocomplete"),editor:e}),{selection:s}=i;return s.from===s.to&&(null==(a=s.$from.nodeBefore)?void 0:a.type.name)==="text"&&!!l&&(n.preventDefault(),(0,t7.TS)(),e.commands.autoComplete(),null==(o=(r=e.commands).forceHideAutocompleteButton)||o.call(r,!0),!0)},decorations(e){let t=[],n=ae.nD.getState(e),{selection:o,doc:r}=e,{loading:i,insertedRange:l}=n||{};if(i){let e=a.NZ.widget(o.from,()=>{let e=document.createElement("span");return e.className="autocomplete-loading",e});t.push(e)}if(l){let e;try{e=(0,A.Nx)(r,l,e=>e.isTextblock)}catch(t){e=[]}e.forEach(e=>{let{node:n,pos:o}=e,r=Math.max(o+1,l.from),i=Math.min(o+n.nodeSize-1,l.to),s=a.NZ.inline(r,i,{class:"autocomplete-inserted autocomplete-highlight"});t.push(s)})}return t.length?a.zF.create(r,t):a.zF.empty}}}),ar=/(\+\+\+)/,ai=A.YY.create({name:"autocomplete",addProseMirrorPlugins(){return[ao(this.editor)]},addCommands:()=>({autoOutline:()=>e=>{let{editor:t,state:n,tr:a}=e,{selection:o,doc:r}=n,{$from:i,from:l}=o,s=(0,ei.JO)(n,i.after()),d=(0,A.KP)(ev.jg)(o);return!!d&&!!s&&((0,n7.s6)(r,d.pos,l),a.setMeta("autocompleteEvent",{type:"load"}),!0)},autoComplete:()=>e=>{var t;let{editor:n,state:a,tr:o}=e,{selection:r,doc:i}=a,{from:l}=r,s=(0,ei.JO)(a,l);if(!(eI.of.get("aiAutocomplete")&&r.empty&&r instanceof el.U3&&s))return!1;let d=(0,H.KA)().getState(),c=null==(t=(0,tp.Jo)(d))?void 0:t.organization;if(!(0,n4.ny)("autocomplete",c))return!1;let u=(0,n7.s6)(i,Math.max(r.from-1e3,0),r.from),p=(0,n5.p9)(u).slice(-200),h=(0,n5.$0)(p),g=i.textBetween(r.from-10,r.to);o.setMeta("autocompleteEvent",{type:"load"});let m=(0,t7.$F)(),f=performance.now(),y={interactionId:m,interface:"autocomplete",inputContent:u};return(0,t7.rl)(y),(0,ef.K8)({promptKey:"Autocomplete",variables:{text:h},interactionId:m,workspaceId:(0,Y.gx)()}).then(e=>{var t,o,r;let i=(0,ei.d_)(a,s);if(!e||!i)throw Error("No completion or insertPos");e=e.trim();let l={from:i,to:i},d=n.chain().insertMarkdownAt(l,e).command(e=>{let{tr:t}=e,n=(0,n8.i)(t);return!n||(l.to=n.to,t.setSelection(n).scrollIntoView(),!0)});(null==(t=a.doc.resolve(i).nodeBefore)?void 0:t.isText)&&!(g.endsWith(" ")||g.endsWith("\n"))&&d.insertContentAt(i," ",{updateSelection:!1}).command(e=>{let{tr:t}=e;return l.to+=1,t.setSelection(new el.U3(t.doc.resolve(l.to))),!0}),d.setMeta("autocompleteEvent",{range:l,interactionId:m,type:"insert"}).run(),(0,t7.UL)({...y,outputContent:e,latency:performance.now()-f,timeToComplete:performance.now()-f}),null==(o=(r=n.commands).forceHideAutocompleteButton)||o.call(r,!1),n.commands.focus(),(0,n6.w)("autocomplete",c,m)}).catch(e=>{console.warn("Error fetching autocomplete",e),n.commands.setMeta("autocompleteEvent",{type:"reset"})}),!0}}),addInputRules:()=>[new A.fV({find:ar,handler:e=>{let{range:t,chain:n}=e;(0,t7.kD)(),n().setTextSelection(t).deleteSelection().autoComplete().run()}})]});var al=n(67733),as=n(41427),ad=n(77711);let ac=e=>e.pos+e.node.nodeSize-1;class au{initialize(e){let{buttonElement:t,tippyTarget:n,onHide:a}=e;if(this.isFlagEnabled){if(!t||!n)return void console.warn("[AutocompleteButtonView] initialize. No element provided");this.element=t,this.target=n,this.onHide=a,this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.createTooltip(),this.element.style.visibility="visible"}}createTooltip(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(!this.isFlagEnabled)return;let n=t||this.view.dom.parentElement;n&&this.element&&(this.tippy=(0,al.Ay)(n,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"right",hideOnClick:"toggle",offset:[0,8],...e}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",this.tippyBlurHandler))}update(e,t){if(!this.isFlagEnabled)return;let{state:n,composing:a}=e,{doc:o,selection:r}=n,i=t&&ad.f.getState(t),l=ad.f.getState(e.state),s=t&&t.doc.eq(o)&&t.selection.eq(r)&&this.isEditable===this.editor.isEditable&&(null==i?void 0:i.forceHide)===l.forceHide;if(!this.element||!this.target){if(!l.buttonElement||!l.tippyTarget)return;this.initialize(l)}let d=!(null==t?void 0:t.selection.eq(r)),c=!(null==t?void 0:t.doc.eq(o));if(this.isEditable=this.editor.isEditable,!this.editor.isEditable||!0===l.forceHide)return void this.hide();if(!a&&!s)if(d&&!c){if(!this.shouldShow({view:e,state:n}))return void this.hide();this.show()}else c&&(this.hide(),this.typingTimeout&&clearTimeout(this.typingTimeout),this.typingTimeout=setTimeout(()=>{this.editor&&this.view.hasFocus()&&this.shouldShow({view:e,state:this.editor.state})&&this.show()},750))}show(){var e,t;if(!this.isFlagEnabled||!this.validParentNode||(this.nodeEndPos=ac(this.validParentNode),!this.nodeEndPos))return;let n=(0,as.KQ)(this.validParentNode.node);null==(e=this.tippy)||e.setProps({getReferenceClientRect:()=>(0,A.MG)(this.editor.view,this.nodeEndPos||0,this.nodeEndPos||0),placement:"rtl"===n?"left":"right"}),this.element&&(this.element.style.transform="rtl"===n?"scaleX(-1)":"none"),null==(t=this.tippy)||t.show()}hide(){var e;this.isFlagEnabled&&(this.onHide&&"function"==typeof this.onHide&&this.onHide(),null==(e=this.tippy)||e.hide())}destroy(){var e,t,n;this.isFlagEnabled&&(this.typingTimeout&&clearTimeout(this.typingTimeout),(null==(e=this.tippy)?void 0:e.popper.firstChild)&&this.tippy.popper.firstChild.removeEventListener("blur",this.tippyBlurHandler),null==(t=this.tippy)||t.destroy(),null==(n=this.element)||n.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler))}constructor({editor:e,view:t}){this.element=null,this.target=null,this.preventHide=!1,this.typingTimeout=null,this.validParentNode=null,this.nodeEndPos=null,this.mousedownHandler=()=>{this.nodeEndPos&&this.isFlagEnabled&&(this.preventHide=!0,this.editor.commands.setTextSelection(this.nodeEndPos),setTimeout(()=>{(0,t7.py)(),this.editor.commands.autoComplete(),this.hide()}))},this.focusHandler=()=>{setTimeout(()=>this.update(this.view))},this.blurHandler=e=>{var t,n;let{event:a}=e;if(this.preventHide){this.preventHide=!1;return}(null==a?void 0:a.relatedTarget)&&(null==(n=this.element)||null==(t=n.parentNode)?void 0:t.contains(a.relatedTarget))||(null==a?void 0:a.relatedTarget)!==this.editor.view.dom&&this.hide()},this.tippyBlurHandler=e=>{this.blurHandler({event:e})},this.shouldShow=e=>{let{view:t,state:n}=e;return!!this.isFlagEnabled&&(this.validParentNode=aa({view:t,state:n,isFlagEnabled:this.isFlagEnabled,editor:this.editor}),!!this.validParentNode)},this.isFlagEnabled=eI.of.get("arrowAutocomplete"),this.editor=e,this.view=t,this.isEditable=e.isEditable}}let ap=A.YY.create({name:"autocompleteButton",addCommands:()=>({forceHideAutocompleteButton:e=>t=>{let{tr:n}=t;return n.setMeta(ad.f,{forceHide:e}),!0}}),addProseMirrorPlugins(){let{editor:e}=this;return[new el.k_({key:ad.f,state:{init:()=>({buttonElement:null,tippyTarget:null,forceHide:!1,onHide:()=>{}}),apply(e,t){let n=e.getMeta(ad.f);return n?{...t,...n}:t}},view:t=>new au({view:t,editor:e})})]}});var ah=n(21938),ag=n(55084),am=n(22249);let af=(e,t)=>new el.k_({props:{attributes:()=>{let e=(0,H.KA)().getState(),n=(0,am.iZ)("buddy-chat")(e);return t.salPanelOpen?{class:"sal-active"}:n?{class:"buddy-active"}:{class:""}},decorations:n=>{let{doc:o,selection:r}=n;if(!e.isEditable)return;let{from:i,to:l}=r,s=[],d=(0,H.KA)().getState(),c=(0,ag.yZ)(d);if((0,am.iZ)("image-chat")(d)&&c&&r instanceof el.nh)return s.push(a.NZ.node(r.from,r.to,{class:"is-selecting-node"})),a.zF.create(o,s);let u=(0,am.iZ)("buddy-chat")(d);return t.salPanelOpen||u?((0,es.IV)(r.$from,ev.jg).forEach((e,t)=>{s.push(a.NZ.node(e.pos,e.pos+e.node.nodeSize,{class:(0,ah.cx)(0==t?"sal-active-card buddy-active-card":"sal-active-card-parent")}))}),(0,es.We)(e)||(r instanceof el.U3?s.push(a.NZ.inline(i,l,{class:(0,ah.cx)("sal-selection-text")})):r instanceof el.nh&&s.push(a.NZ.node(i,l,{class:(0,ah.cx)("sal-selection-node")}))),a.zF.create(o,s)):void 0}}}),ay=A.YY.create({name:"salExtension",addStorage:()=>({salPanelOpen:!1}),addProseMirrorPlugins(){return[af(this.editor,this.storage)]},addCommands(){return{setSalOpen:e=>t=>{let{state:n,dispatch:a}=t;return this.storage.salPanelOpen=e,!0}}}});var av=n(78116),ab=n(60122),aw=n(62040),ax=n(73364);class aI extends ax.c{[Symbol.iterator](){return this.yarray[Symbol.iterator]()}values(){let e=this.yarray.length,t=-1;return{[Symbol.iterator]:()=>({next(){return++t===e?{value:void 0,done:!0}:{value:this.yarray.get(t),done:!1}}})}}forEach(e){return this.yarray.forEach(e)}set(e,t){return this.doc.transact(n=>{this.map.has(e)&&this.delete(e),this.yarray.push([{key:e,val:t}])}),t}delete(e){let t=0;for(let n of this.yarray){if(n.key===e){this.yarray.delete(t);break}t++}}get(e){let t=this.map.get(e);return t&&t.val}has(e){return this.map.has(e)}constructor(e){super(),this.yarray=e,this.doc=e.doc,this.map=new Map;let t=e.toArray();this.doc.transact(n=>{for(let n=t.length-1;n>=0;n--){let a=t[n];this.map.has(a.key)?e.delete(n):this.map.set(a.key,a)}}),e.observe(t=>{let n=new Map,a=Array.from(t.changes.added);t.changes.deleted.forEach(e=>{e.content.getContent().forEach(e=>{this.map.get(e.key)===e&&(this.map.delete(e.key),n.set(e.key,{action:"delete",oldValue:e.val}))})});let o=new Map;a.map(e=>e.content.getContent()).flat().forEach(e=>{o.set(e.key,e)});let r=new Set,i=e.toArray();this.doc.transact(t=>{for(let t=i.length-1;t>=0&&(o.size>0||r.size>0);t--){let a=i[t];if(r.has(a.key))r.delete(a.key),e.delete(t,1);else if(o.get(a.key)===a){let e=this.map.get(a.key);if(e)r.add(a.key),n.set(a.key,{action:"update",oldValue:e.val,newValue:a.val});else{let e=n.get(a.key);e&&"delete"===e.action?n.set(a.key,{action:"update",newValue:a.val,oldValue:e.oldValue}):n.set(a.key,{action:"add",newValue:a.val})}o.delete(a.key),this.map.set(a.key,a)}else o.has(a.key)&&(r.add(a.key),o.delete(a.key))}}),n.size>0&&this.emit("change",[n])})}}class aC{run(e){}}class aS extends aC{createKeyValue(e,t){return new aI(e.getArray(t))}getRestoreMap(e){return e.getMap("annotationsAbsolute")}run(e){let t=this.createKeyValue(e,"annotationsAbsoluteKV");for(let[n,a]of this.getRestoreMap(e).entries())t.set(n,a)}constructor(...e){super(...e),this.name="AnnotationsYKeyValue"}}class ak{runMigrations(){let e=this.getMigrationsMap();for(let t of this.migrations)if(!this.hasRunMigration(t.name))try{t.run(this.document),e.set(t.name,!0)}catch(e){}}getMigrationsMap(){return this.document.getMap(ak.ANNOTATION_MIGRATIONS_KEY)}hasRunMigration(e){return this.getMigrationsMap().get(e)||!1}constructor(e){this.migrations=[new aS],this.document=e,this.document.transact(()=>{this.runMigrations()}),this.annotations=this.document.getMap("annotations"),this.annotationsAbsolute=new aI(this.document.getArray("annotationsAbsoluteKV"))}}ak.ANNOTATION_MIGRATIONS_KEY="annotationMigrations";class aA{get id(){return this.decoration.type.spec.id}get from(){return this.decoration.from}get data(){return this.decoration.type.spec.data}get HTMLAttributes(){return this.decoration.type.attrs}toString(){return JSON.stringify({id:this.id,data:this.data,from:this.from,HTMLAttributes:this.HTMLAttributes})}constructor(e){this.decoration=e}}var aT=n(53885),az=n(46814),aP=n(35342),aE=n.n(aP),aj=n(831),aM=n.n(aj),aR=n(67864);function aD(e){let t=[];for(let n=e.length-1;n>=0;n--){let a=e[n];t.push({...a,prev:a.next,next:a.prev})}return t}class aB{flushUndoQueue(){let{undoQueue:e}=this;return this.undoQueue=[],e}set(e,t){let n=this.map.get(e);return this.undoQueue.unshift({type:"set",key:e,next:n,prev:t}),this.map.set(e,t)}delete(e){let t=this.map.get(e);return void 0===t||this.undoQueue.unshift({type:"set",key:e,next:t,prev:void 0}),this.map.delete(e)}constructor(e){this.map=e,this.undoQueue=[]}}class aL{persistRestoreMap(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={deletion:0,relToAbs:0,setting:0,total:0},a=performance.now();(t||this.hasChanges)&&(this.transactYDoc(()=>{let t=performance.now();for(let{key:e}of this.restoreMap)this.restoreMap.delete(e);n.deletion=performance.now()-t,this.map.forEach(t=>{let{id:a,pos:o,data:r}=t;try{let t=performance.now(),i=this.relToAbs(e,o);n.relToAbs+=performance.now()-t;let l=performance.now();this.restoreMap.set(a,{id:a,data:r,absPos:i}),n.setting+=performance.now()-l}catch(e){console.error("[Annotations] persistRestoreMap error: ",e.message)}})}),n.total=performance.now()-a,this.log("[Annotations] persistRestoreMap in ".concat(n.total,"ms"),{values:this.restoreMap.yarray.toArray(),performance:n}),this.hasChanges=!1)}flushMoveInstructionQueue(){let{moveInstructionMap:e}=this;return this.moveInstructionMap={},Object.values(e)}clearCutData(){this.cutData=null,this.filmstripCutData=null}getAnnotationsBetween(e,t,n){let a=[];for(let o of this.map.values())try{let r=this.relToAbs(e,o.pos);if(null===r)continue;t<=r&&r<n&&a.push({id:o.id,data:o.data,pos:r,relativePos:o.pos})}catch(e){console.warn("[Annotations] getAnnotationsBetween error: ",e.message)}return a}apply(e,t){if((0,n9.LP)(e)){try{this.createDecorations(t)}catch(e){console.warn("[Annotations] handle remote change, not create decorations: ".concat(e.message))}return this}let n=e.getMeta(aT.q);if(n){switch(n.type){case"addAnnotation":this.addAnnotation(n,t);break;case"restoreAnnotations":this.restoreAnnotations(n);break;case"clearAnnotations":this.clearAnnotations();break;case"deleteAnnotation":this.deleteAnnotation(n.id);break;case"refreshAnnotationDecorations":try{this.createDecorations(t)}catch(e){console.warn("could not create decorations: ".concat(e.message))}break;case"moveAnnotations":this.moveAnnotations(t,n.toMove)}return this.hasChanges=!0,this}switch(e.getMeta("uiEvent")){case"cut":this.handleCutTransaction(t,e);break;case"paste":this.handlePasteTransaction(t,e)}let a=e.getMeta("annotationEvent");switch(null==a?void 0:a.type){case"split-card":this.handleSplitCard(t,e,a);break;case"split-block":this.handleSplitBlock(t,e,a);break;case"join-forward":this.handleJoinForward(t,e,a);break;case"join-backward":this.handleJoinBackward(t,e,a);break;case"update-node-attrs":this.handleUpdateNodeAttrs(t,e,a);break;case"rearrange-cards":this.handleRearrangeCards(t,e,a);break;case"move":this.handleMove(t,e,a);break;case"merge-cards":this.handleMergeCards(t,e,a);break;case"drop":this.handleDropAnnotations(t,e,a);break;case"unwrap-node":this.handleUnwrapNode(t,e,a);break;case"wrap-nodes":this.handleWrapNodes(t,e,a);break;case"filmstrip-cut":this.handleFilmstripCut(t,e,a);break;case"filmstrip-paste":this.handleFilmstripPaste(t,e,a);break;default:e.getMeta("appendedTransaction")||(this.handleReplaceTransaction(t,e),this.handleReplaceAroundTransaction(t,e))}return e.docChanged&&(this.hasChanges=!0),this.handleLocalChange(e)}restore(e,t){t.forEach(t=>{let{next:n,key:a}=t;void 0===n?this.map.delete(a):this.map.set(a,{...n,pos:this.refreshRelativePos(e,n.pos)})}),this.persistRestoreMap(e,!0)}handleUnwrapNode(e,t,n){let{pos:a}=n,o=t.before.resolve(a),r=o.start(o.depth+1),i=t.before.resolve(r).end(),l=this.getAnnotationsBetween(e,r,i).map(t=>{let{id:n,relativePos:o}=t,i=this.relToAbs(e,o);return null===i?null:{id:n,newPos:a+(i-r)}}).filter(e=>!!e);this.log("%c[Annotations] unwrap node","color: green",{tr:t,pos:a,start:r,end:i,toMove:l}),l.length>0&&this.enqueueMoveInstructions(l)}handleWrapNodes(e,t,n){let{start:a,end:o,level:r}=n,i=this.getAnnotationsBetween(e,a,o).map(e=>{let{id:t,pos:n}=e;return{id:t,newPos:n+r}}).filter(e=>!!e);this.log("%c[Annotations] wrap nodes","color: green",{tr:t,start:a,end:o,toMove:i}),i.length>0&&this.enqueueMoveInstructions(i)}handleMergeCards(e,t,n){let{insertPos:a,contentPos:o}=n,r=t.before.nodeAt(o);if(!r)return void console.error("[AnnotationState] trying to merge cards, but cannot resolve content wrapper");let i=this.getAnnotationsBetween(e,o,o+r.nodeSize).map(e=>{let{id:t,pos:n}=e;return{id:t,newPos:a+(n-o-1)}});this.log("%c[Annotations] merge cards","color: green",{transaction:t,insertPos:a,contentPos:o,toMove:i}),i.length>0&&this.enqueueMoveInstructions(i)}handleRearrangeCards(e,t,n){let{rearrangedCardPositions:a,insertPos:o}=n,r=a.flatMap(n=>{let{newPos:a,oldPos:o}=n,r=t.before.resolve(o);return this.getAnnotationsBetween(e,o,o+r.nodeAfter.nodeSize).map(e=>{let{id:t,pos:n}=e;return{id:t,newPos:a+(n-o)}})}),i=[],l=(0,ev.aJ)(t.before);if(l){let n=a[0].oldPos,r=Math.min(n,o),s=Math.max(n,o);i=l.flatMap(n=>{let{node:o,pos:i}=n;if(!(i>=r&&i<=s&&!a.find(e=>e.id===o.attrs.id)))return[];{let n=t.before.resolve(i),a=i+n.nodeAfter.nodeSize;return this.getAnnotationsBetween(e,i,a).map(e=>{let{id:n,pos:a}=e;return{id:n,newPos:t.mapping.map(a)}})}})}this.log("%c[Annotations] rearrange cards","color: green",{transaction:t,rearrangedCardPositions:a,annotationsInRearrangedCards:r,jumpedAnnotations:i});let s=[...r,...i];s.length>0&&this.enqueueMoveInstructions(s)}handleMove(e,t,n){let{insertPos:a,insertPosRaw:o,pos:r,end:i}=n,l=this.getAnnotationsBetween(e,r,i).map(e=>{let{id:t,pos:n}=e;return{id:t,newPos:a+(n-r)}}),s=this.getAnnotationsBetween(e,Math.min(o,i),Math.max(o,r)).map(e=>{let{id:n,pos:a}=e;return{id:n,newPos:t.mapping.map(a)}});this.log("%c[Annotations] move","color: green",{transaction:t,insertPos:a,insertPosRaw:o,pos:r,end:i,annotationsInCard:l,jumpedAnnotations:s});let d=[...l,...s];d.length>0&&this.enqueueMoveInstructions(d)}handleUpdateNodeAttrs(e,t,n){let{pos:a}=n,o=t.doc.nodeAt(a);if(!o)return;let r=this.getAnnotationsBetween(e,a,a+o.nodeSize).map(e=>{let{id:t,pos:n}=e;return{id:t,newPos:n}});this.log("%c[Annotations] update node attrs","color: green",{transaction:t,pos:a,toMove:r}),r.length>0&&this.enqueueMoveInstructions(r)}handleJoinBackward(e,t,n){let{atBeginning:a,joinPos:o}=n;if(!a)return;let r=t.before.resolve(o),i=t.before.resolve(r.before()),l=i.nodeBefore,s=i.nodeAfter;if(!l||!s)return;let d=i.pos+s.nodeSize,c=i.pos-l.nodeSize,u=e.selection.from;this.log("%c[Annotations] join backward","color: green",{transaction:t,prevBlock:l,nextBlock:s,nextBlockPos:i.pos,nextBlockEnd:d,prevBlockPos:c,joinPoint:u});let p=this.getAnnotationsBetween(e,i.pos,d);if(0===p.length)return void this.enqueueRefreshDecorations();0===s.content.size?(p.forEach(e=>{let{id:t}=e;return this.undoableMap.delete(t)}),requestAnimationFrame(()=>{this.writeUndoStack(e)})):this.enqueueMoveInstructions(p.map(e=>{let{id:t,pos:n}=e,a=Math.max(n-i.pos-1,0);return{id:t,newPos:(0===l.content.size?c:u)+a}}))}handleJoinForward(e,t,n){let{atEnd:a,joinPos:o}=n;if(!a)return;let r=t.before.resolve(o),{pos:i,node:l}=(0,es.TK)(r,e=>e.isBlock)[0],s=t.before.resolve(r.after()),d=s.nodeAfter;if(!d)return;let c=s.pos+d.nodeSize;this.log("%c[Annotations] join forward","color: green",{sel:e.selection,prevBlock:l,transaction:t,deleteAnnotations:!!d.isAtom,joinPos:r.pos,prevBlockPos:i,nextBlockPos:s.pos,nextBlock:d});let u=this.getAnnotationsBetween(e,i,i+l.nodeSize),p=this.getAnnotationsBetween(e,s.pos,c);if(0===p.length&&0===u.length)return void this.enqueueRefreshDecorations();let h=t=>{t.forEach(e=>{let{id:t}=e;return this.undoableMap.delete(t)}),requestAnimationFrame(()=>{this.writeUndoStack(e)})};d.isAtom&&l.content.size>0?h(p):0===l.content.size?h(u):this.enqueueMoveInstructions(p.map(e=>{let{id:t,pos:n}=e,a=Math.max(n-s.pos-1,0);return{id:t,newPos:(0===l.content.size?i:o)+a}}))}handleSplitBlock(e,t,n){let{splitPos:a,atBeginning:o}=n;if(o)return void this.enqueueRefreshDecorations();let r=t.before.resolve(a),{pos:i,node:l}=(0,es.TK)(r,e=>e.isBlock)[0],{$from:s}=e.selection,d=(0,es.TK)(s,e=>e.isBlock)[0],c=this.getAnnotationsBetween(e,a,i+l.nodeSize).map(e=>{let{id:t,pos:n}=e,o=n-a;return{id:t,newPos:d.pos+(0===o?o:o+1)}});c.length>0?this.enqueueMoveInstructions(c):this.enqueueRefreshDecorations(),this.log("%c[Annotations] split block","color: green",{sel:e.selection,transaction:t,splitPos:a,toMove:c,$before:r})}handleSplitCard(e,t,n){let{splitPos:a}=n,o=t.before.resolve(a),r=(0,es.TK)(o,ev.jg)[0];if(!r)return;let i=r.pos,l=r.pos+r.node.nodeSize,s=this.getAnnotationsBetween(e,i,l).map(e=>{let{id:n,pos:o}=e;return{id:n,newPos:o===a?t.mapping.map(o+1)-1:t.mapping.map(o)}});this.log("%c[Annotations] split card","color: green",{transaction:t,splitPos:a,parentEnd:l,toMove:s}),this.enqueueMoveInstructions(s)}handlePasteTransaction(e,t){if(!this.cutData&&!this.filmstripCutData)return;let n=t.steps.find(e=>"replace"===e.jsonID);if(!n)return;let{from:a,to:o,slice:{openStart:r}}=n,i=e.doc.resolve(n.from),l=o===a?a:a+1,s=null==i.nodeBefore&&i.parent.isBlock,d=!r||s;if(this.log("%c[Annotations] paste transaction","color: green",{transaction:t,insertPos:a,resolved:i,isPasteBeginning:s,pasteType:this.cutData?"cut":"filmstrip-cut"}),this.cutData){let e=this.cutData;this.cutData=null;let t=e.toMove.map(e=>{let{id:t,offset:n}=e;return{id:t,newPos:l+(d?n:Math.max(0,n))}});t&&t.length>0&&(this.log("[Annotations] paste from cut final move",t),this.enqueueMoveInstructions(t))}else if(this.filmstripCutData){let n=this.filmstripCutData;this.filmstripCutData=null;let a=l-1;for(;a<e.doc.nodeSize;){let t=e.doc.nodeAt(a);if(t&&(0,ev.jg)(t))break;a++}let o=this.getMoveInstructionsForFilmstripPaste(t,n,a);o&&o.length>0&&(this.log("[Annotations] paste from filmstrip cut final move",o),this.enqueueMoveInstructions(o))}}getMoveInstructionsForFilmstripPaste(e,t,n){if(!t)return;let a=(0,A.xe)(e.doc,ev.jg);if(!a)return;let o=e.doc.resolve(n).depth,r=a.filter(t=>{let{pos:n}=t;return e.doc.resolve(n).depth===o}),i=r.findIndex(e=>e.pos===n);if(-1===i)return;let l=r.slice(i);return t.flatMap(e=>{let{cardIndex:t,annotations:n}=e;return n.map(e=>{let{id:n,offset:a}=e,o=l[t];if(o)return{id:n,newPos:o.pos+a}}).filter(e=>!!e)})}handleFilmstripPaste(e,t,n){if(!this.cutData&&!this.filmstripCutData)return;let{insertPos:a}=n;if(this.cutData){let e=this.cutData;this.cutData=null;let n=e.toMove.map(e=>{let{id:t,offset:n}=e;return{id:t,newPos:a+n}});n&&n.length>0&&(this.log("[Annotations] filmstripPaste from cut final move",{tr:t,cutData:e,moveInstructions:n}),this.enqueueMoveInstructions(n))}else if(this.filmstripCutData){let e=this.filmstripCutData;this.filmstripCutData=null;let n=this.getMoveInstructionsForFilmstripPaste(t,e,a);n&&n.length>0&&(this.log("%c[Annotations] filmstripPaste from filmstrip cut final move","color: green",{tr:t,filmstripCutData:e,moveInstructions:n}),this.enqueueMoveInstructions(n))}}handleFilmstripCut(e,t,n){this.cutData=null,this.filmstripCutData=n.deleted.map(n=>{let{cardIndex:a,pos:o}=n,r=t.before.resolve(o),i=o+r.nodeAfter.nodeSize;return{cardIndex:a,annotations:this.getAnnotationsBetween(e,o,i).map(e=>{let{id:t,pos:n}=e;return{id:t,offset:n-o}})}}),this.log("%c[Annotations] filmstripCut","color: green",{tr:t,filmstripCutData:this.filmstripCutData})}handleCutTransaction(e,t){let n=t.steps.find(e=>"replace"===e.jsonID);if(!n)return;this.filmstripCutData=null;let{from:a,to:o}=n,r=e.doc.resolve(a),i=null==r.nodeAfter&&null==r.nodeBefore&&r.parent.isBlock,l=this.getAnnotationsBetween(e,a-!!i,o),s=l.map(t=>{let n=this.relToAbs(e,t.relativePos);return{id:t.id,offset:n-a}});this.cutData={slice:n.slice,toMove:s},this.log("%c[Annotations] cut transaction","color:green",{isWholeBlock:i,resolved:r,transaction:t,annotations:l,moveData:s})}handlePrependContentToBlock(e,t){let n=t.steps.find(e=>"replace"===e.jsonID);if(!n)return;let{from:a}=n,o=t.before.resolve(a);if(!o.nodeAfter)return;let r=this.getAnnotationsBetween(e,a,a+o.nodeAfter.nodeSize).map(n=>{let{id:o,relativePos:r}=n,i=this.relToAbs(e,r);return{id:o,newPos:i===a?t.mapping.map(i+1)-1:t.mapping.map(i)}});r.length>0&&(this.log("%c[Annotations] replace transaction - prepend content","color:green",{tr:t,annotationsToMove:r}),this.enqueueMoveInstructions(r))}handleReplaceTransaction(e,t){let n=t.steps.find(e=>"replace"===e.jsonID);if(!n)return;let{from:a,to:o}=n,r=t.before.resolve(a),i=t.before.resolve(o),l=r.parent!==i.parent,s=0==n.slice.content.size,d=0===r.parentOffset&&o>=a+r.parent.nodeSize-2,c=d&&s;if(0===i.parentOffset&&i.depth===r.depth+1&&i.pos-r.pos==1)return this.handlePrependContentToBlock(e,t);let u=!1;if(l){var p;let n=[...c?[]:this.getAnnotationsBetween(e,a-r.parentOffset-1,a).map(t=>{let{id:n,relativePos:a}=t;return{id:n,newPos:this.relToAbs(e,a)}}),...this.getAnnotationsBetween(e,o,o+(null==(p=i.nodeAfter)?void 0:p.nodeSize)+1).map(n=>{let{id:a,relativePos:o}=n;return{id:a,newPos:t.mapping.map(this.relToAbs(e,o))}})];this.log("[Annotations] multiline to move",n),n.length>0&&(u=!0,this.enqueueMoveInstructions(n))}let h=this.getAnnotationsBetween(e,a-(c||l&&0===r.parentOffset?1:0),o);h.length>0&&(u=!0,this.log("[Annotations] to delete",h),h.forEach(e=>{this.undoableMap.delete(e.id)})),u&&(this.log("%c[Annotations] replace transaction","color:green",{tr:t,annotationsToDelete:h,isWholeBlock:c,isMultiline:l,replacingEntireFromBlock:d,replacingWithNothing:s}),requestAnimationFrame(()=>{this.writeUndoStack(e)}))}handleReplaceAroundTransaction(e,t){let n=aE()(t.steps.filter(e=>"replaceAround"===e.jsonID),t=>{let{from:n,to:a}=t;return this.getAnnotationsBetween(e,n,a)}),a=aM()(n,e=>e.id).map(e=>{let{id:n,pos:a}=e;return{id:n,newPos:t.mapping.map(a)}});return a.length>0&&this.log("%c[Annotations] replaceAround transaction","color:green",{tr:t,moveInsturctions:a}),0!==a.length&&(this.enqueueMoveInstructions(a),!0)}clearAnnotations(){this.transactYDoc(()=>{this.map.forEach((e,t)=>{this.map.delete(t)})})}restoreAnnotations(e){this.log("%c[Annotations] restoreAnnotations","color: green",e);let{toRestore:t}=e;this.clearAnnotations(),this.enqueueMoveInstructions(t.filter(e=>{let{absPos:t}=e;return null!=t}).map(e=>{let{absPos:t,id:n}=e;return{id:n,newPos:t}}))}addAnnotation(e,t){this.log("%c[Annotations] addAnnotation","color: green",e);let{pos:n,id:a,data:o}=e,r=this.absToRel(t,n);this.map.set(a,{id:a,pos:r,data:o})}deleteAnnotation(e){this.log("%c[Annotations] deleteAnnotation","color: green",e),this.map.delete(e)}moveAnnotations(e,t){let{map:n}=this;this.log("%c[Annotations] moveAnnotations","color: green",t),this.transactYDoc(()=>{t.forEach(t=>{let{id:a,newPos:o}=t,r=n.get(a)||{id:a};this.undoableMap.set(a,{...r,pos:this.absToRel(e,o)})})}),this.writeUndoStack(e)}writeUndoStack(e){let t=ab.Mj.getState(e).undoManager;if(0===t.undoStack.length)return;let n=this.undoableMap.flushUndoQueue();if(0===n.length)return;let a=t.undoStack[t.undoStack.length-1],o="annotations",r=a.meta.get(o)||[];r.length>0&&this.log("[Annotations] existing undo stack",{existing:r,toWrite:n,stack:t.undoStack});let i=[...n,...r];a.meta.set(o,i),this.log("[Annotations] writing to undo stack",i)}createDecorations(e){let{map:t}=this.options;this.refreshDecorations=!1;let n=[],o=[];t.forEach((t,r)=>{let i=(0,ei.d_)(e,t.pos);if(null==i)return;let l=e.doc.nodeAt(i);l&&((null==l?void 0:l.isInline)?n.push(a.NZ.inline(i,i+1,{class:"debug-comment-cursor"})):n.push(a.NZ.node(i,i+l.nodeSize,{class:"debug-comment-block"}))),o.push({id:r,data:t.data,relativePos:t.pos,pos:i})}),e.doc.descendants((e,t,r)=>(!(t>0)||!!(0,aR.cE)(r)||!!(0,aR.cE)(e))&&(o.filter(n=>n.pos>=t&&n.pos<t+e.nodeSize).forEach(o=>{let{id:r,data:i}=o;n.push(a.NZ.node(t,t+e.nodeSize,{},{isAnnotation:!0,id:r,data:i}))}),!0)),this.decorations=a.zF.create(e.doc,n),this.annotations=o}handleDropAnnotations(e,t,n){let{dragging:{origNodePos:a,inBlock:o,inCard:r},droppedBlockPos:i}=n,l=[];o.forEach(e=>{let t=e.pos-a;l.push({id:e.id,newPos:i+t})}),this.getAnnotationsBetween(e,i,i+1).filter(e=>!l.find(t=>t.id===e.id)).forEach(e=>{l.push({id:e.id,newPos:t.mapping.map(e.pos)})}),r.filter(e=>!l.find(t=>t.id===e.id)).forEach(e=>{let n=t.mapping.map(e.pos);l.push({newPos:n,id:e.id})}),this.log("%c[Annotations] handleDropAnnotations","color: green",{action:n,tr:t,toMove:l}),l.length>0&&this.enqueueMoveInstructions(l)}handleLocalChange(e){let t=[...this.decorations.find(void 0,void 0,e=>e.isAnnotation&&this.moveInstructionMap[e.id])],n=this.decorations.remove(eP()(t)).map(e.mapping,e.doc).add(e.doc,t);return this.decorations=n,this}absToRel(e,t){let n=(0,ei.JO)(e,t);if(!n)throw Error("Y.State non initialized");return n}relToAbs(e,t){return(0,ei.d_)(e,t)}refreshRelativePos(e,t){let{doc:n,type:a,binding:o}=ab.pJ.getState(e),r=(0,az.bL)(n,a,t,o.mapping);return(0,az.Bw)(r,a,o.mapping)}enqueueMoveInstructions(e){e.forEach(e=>{this.moveInstructionMap[e.id]&&console.error("[AnnotationState] trying to enqueue two move instructions for annotation with targetId=".concat(e.id)),this.moveInstructionMap[e.id]=e})}enqueueRefreshDecorations(){this.refreshDecorations=!0}transactYDoc(e){this.options.document.transact(e)}log(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];eI.of.get("debugComments")?console.log(...t):console.debug(...t)}constructor(e){this.options=e,this.decorations=a.zF.empty,this.annotations=[],this.refreshDecorations=!1,this.hasChanges=!1,this.filmstripCutData=null,this.cutData=null,this.moveInstructionMap={},this.map=e.map,this.restoreMap=e.restoreMap,this.undoableMap=new aB(this.map)}}let a_=e=>{let t=eH()(e=>{aT.q.getState(e.state).persistRestoreMap(e.state)},500);return new el.k_({key:aT.q,state:{init:()=>new aL(e),apply:(e,t,n,a)=>t.apply(e,a)},view:()=>({update(e){t(e)}}),props:{transformPasted(t){var n;let a=this.getState(e.editor.state),o=null==(n=t.content.firstChild)?void 0:n.attrs.docId;return o&&o!==e.editor.gammaDocId&&a.clearCutData(),t},handleDOMEvents:{copy(e){return this.getState(e.state).clearCutData(),!1}},decorations(t){let{decorations:n,annotations:a}=this.getState(t);return e.onUpdate&&e.onUpdate(n.find().map(e=>new aA(e)),a),n}}})},aN=A.YY.create({name:"annotation",onCreate(){let e=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];eI.of.get("debugComments")?console.log(...t):console.debug(...t)};this.options.document.on("afterAllTransactions",t=>{let n=aT.q.getState(this.editor.view.state),a=n.flushMoveInstructionQueue();a.length>0?(e("%c[Annotations] afterAllTransactions handling queued moves","color:pink",a),this.editor.commands.moveAnnotations(a)):n.refreshDecorations&&(e("%c[Annotations] afterAllTransactions refreshDecorations","color:pink"),this.editor.commands.refreshDecorations())});let t=aT.q.getState(this.editor.state);window.gammaAnnotations=t;let n=ab.Mj.getState(this.editor.state).undoManager;setTimeout(()=>{n.on("stack-item-popped",e=>{let a=e.stackItem.meta.get("annotations");if(!a)return void t.persistRestoreMap(this.editor.state,!0);let{undoStack:o,redoStack:r}=n;"undo"===e.type&&r.length>0?r[r.length-1].meta.set("annotations",aD(a)):"redo"===e.type&&o.length>0&&o[o.length-1].meta.set("annotations",aD(a)),t.restore(this.editor.state,a)})},0),t.map.observe(eH()(()=>{e("[Annotations] map observe -> resfreshDecorations"),this.editor.commands.refreshDecorations()})),this.editor.commands.refreshDecorations()},addCommands:()=>({restoreAnnotations:e=>t=>{let{dispatch:n,tr:a}=t;return n&&(a.setMeta(aT.q,{type:"restoreAnnotations",toRestore:Object.values(e)}),n(a)),!0},updateAttributes:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n=>{var a,o;let{tr:r,state:i,dispatch:l}=n,s=null,d=null,c=(a="string"==typeof e?e:e.name,(o=i.schema).nodes[a]?"node":o.marks[a]?"mark":null);return!!c&&("node"===c&&(s=(0,A.Pg)(e,i.schema)),"mark"===c&&(d=(0,A.I2)(e,i.schema)),l&&r.selection.ranges.forEach(e=>{let n=e.$from.pos,a=e.$to.pos;i.doc.nodesBetween(n,a,(e,o)=>{s&&s===e.type&&r.setNodeMarkup(o,void 0,{...e.attrs,...t}).setMeta("annotationEvent",{type:"update-node-attrs",pos:o}),d&&e.marks.length&&e.marks.forEach(i=>{if(d===i.type){let l=Math.max(o,n),s=Math.min(o+e.nodeSize,a);r.addMark(l,s,d.create({...i.attrs,...t}))}})})}),!0)}},wrapWithAnnotations:(e,t)=>n=>{let{state:a,tr:o,dispatch:r}=n,i=a.schema.nodes[e],{$from:l,$to:s}=a.selection,d=l.blockRange(s),c=d&&(0,aw.oM)(d,i,t);if(!c||!d)return!1;let{start:u,end:p}=d;return!r||(o.wrap(d,c).setMeta("annotationEvent",{type:"wrap-nodes",start:u,end:p,level:1}).scrollIntoView(),!0)},moveAnnotations:e=>t=>{let{dispatch:n,tr:a}=t;return n&&(a.setMeta(aT.q,{type:"moveAnnotations",toMove:e}),n(a)),!0},clearAnnotations:()=>e=>{let{dispatch:t,tr:n}=e;return t&&(n.setMeta(aT.q,{type:"clearAnnotations"}),t(n)),!0},refreshDecorations:()=>e=>{let{dispatch:t,tr:n}=e;return t&&(n.setMeta(aT.q,{type:"refreshAnnotationDecorations"}),t(n)),!0},addAnnotation:e=>{let{pos:t,id:n,data:a}=e;return e=>{let{dispatch:o,state:r}=e;return o&&r.tr.setMeta(aT.q,{type:"addAnnotation",id:n,data:a,pos:t}),!0}},deleteAnnotation:e=>t=>{let{dispatch:n,state:a}=t;return n&&a.tr.setMeta(aT.q,{type:"deleteAnnotation",id:e}),!0}}),addProseMirrorPlugins(){let{document:e,onUpdate:t}=this.options,n=new ak(e);return[a_({document:e,editor:this.editor,map:n.annotations,restoreMap:n.annotationsAbsolute,onUpdate:t})]}});var aO=n(36271);let aF=A.YY.create({name:"draftComments",addCommands:()=>({removeDraftComments:e=>t=>{let{dispatch:n,tr:a}=t;if(n){let t={type:"removeDraftComment",comments:Array.isArray(e)?e:[e]};a.setMeta(aO._,t),n(a)}return!0},createDraftComment:e=>t=>{let{dispatch:n,tr:a}=t;return n&&(a.setMeta(aO._,{type:"createDraftComment",comment:e}),n(a)),!0}}),addProseMirrorPlugins:()=>[(0,aO.h)()]});var aU=n(29608);let aH=new el.hs("mobileAnnotationPluginKey");class aq{apply(e,t){let n=e.getMeta(aH);return n&&"setPos"in n&&(this.pos=n.setPos),this}constructor(){this.pos=null}}let aV=A.YY.create({name:"mobileAnnotation",addCommands:()=>({setMobileAddBlockComment:e=>t=>{let{dispatch:n,tr:a,view:o}=t;if(!n)return!1;if(null===e)return a.setMeta(aH,{setPos:null}),n(a),!0;let{clientX:r,clientY:i}=e,l=o.posAtCoords({left:r,top:i});if(null===l)return!0;let s=(0,aR.CS)(l.inside,o);if(!s)return!1;let d=o.coordsAtPos(s.pos),c=r-d.left,u=i-d.top;return a.setMeta(aH,{setPos:{pos:s.pos,end:s.end,offsetX:c,offsetY:u}}),n(a),!0}}),addProseMirrorPlugins(){var e;return[(e=this.editor,new el.k_({key:aH,state:{init:()=>new aq,apply:(e,t,n,a)=>t.apply(e,a)},props:{handleDOMEvents:{click(t,n){if(!(0,aU.Xb)())return!1;if(n.target.closest("[data-comments-wrapper]"))return;let a=aH.getState(t.state);a.pos||(a.timeout?(clearTimeout(a.timeout),a.timeout=null,e.commands.setMobileAddBlockComment(n)):a.timeout=setTimeout(()=>{a.timeout=null},300))}},decorations(e){let t=aH.getState(e).pos;if(null===t)return a.zF.empty;let n=a.NZ.node(t.pos,t.end,{},{isMobileAnnotation:!0,type:"show-buttons",offsetX:t.offsetX,offsetY:t.offsetY});return a.zF.create(e.doc,[n])}}}))]}});var aW=n(50764);let aG=A.YY.create({name:"BlockHover",addProseMirrorPlugins(){return[(0,aW.bA)(this.editor)]}});var aJ=n(48993),aK=n(74677);let aY=A.YY.create({name:"editCardAI",onTransaction(e){var t;let{transaction:n}=e;if(!(!n.docChanged||n.getMeta("isEditCardVariant"))&&this.editor.isEditable&&eI.of.get("editCard2"))if(null==(t=n.getMeta(ab.pJ))?void 0:t.isUndoRedoOperation)aZ(n);else{if(!1===n.getMeta("addToHistory"))return;aQ(n)}}}),aQ=eH()(e=>{try{let t=(0,H.KA)(),n=t.getState(),a=(0,aJ.yL)(n);if(0===Object.keys(a).length)return;(0,aK.A)(e).forEach(n=>{let o={from:n.newStart,to:n.newEnd},r=(0,A.Nx)(e.doc,o,e=>(0,ev.jg)(e)&&!!a[e.attrs.id]);r.length&&r.forEach(e=>{var n;let{node:o}=e,r=o.attrs.id;console.debug("Clearing suggestions for card",r),null===tT.zS||void 0===tT.zS||tT.zS.track(tT.VV.AI_CARD_VARIATION_KEPT,{cardId:r,variantId:a[r].selected,isOriginal:null==(n=a[r].variants.find(e=>e.id===a[r].selected))?void 0:n.isOriginal,interactionId:a[r].interactionId,source:"edit"}),t.dispatch((0,aJ.YB)({cardId:r}))})})}catch(e){console.error("[caught] EditCard clearSuggestions error",e)}},250),aZ=e=>{try{let t=e.steps[0];if(!t||!(t instanceof aw.Ln))return;let n=t.slice.content,a=(0,H.KA)(),o=a.getState(),r=(0,aJ.yL)(o);if(0===Object.keys(r).length)return;n.descendants(e=>{if(!(0,ev.jg)(e))return;let t=e.attrs.id,n=r[t];if(!n)return;let o=n.variants.find(t=>JSON.stringify(t.card)===JSON.stringify(e.toJSON()));o&&a.dispatch((0,aJ.S6)({cardId:t,variantId:o.id}))})}catch(e){console.error("[caught] EditCard updateVariations error",e)}},a$=A.YY.create({name:"generateCard",addCommands:()=>({removeGeneratorInputsOnLoad:()=>e=>{let{tr:t,state:n,editor:a}=e;return!!a.isEditable&&((0,A.xe)(n.doc,e=>{var t;return(0,ev.jg)(e)&&(null==(t=e.attrs.generatorInput)?void 0:t.status)==="done"}).forEach(e=>{let{pos:n}=e;t.setNodeAttribute(n,"generatorInput",null)}),!0)}})});var aX=n(32380),a0=n(86083),a1=n(38934);let a2=A.YY.create({name:"collaboration",priority:a1.y.Collaboration,addOptions:()=>({document:null,field:"default",fragment:null}),onCreate(){this.editor.extensionManager.extensions.find(e=>"history"===e.name)&&console.warn('[tiptap warn]: "@tiptap/extension-collaboration" comes with its own history support and is not compatible with "@tiptap/extension-history".')},addCommands:()=>({undo:()=>e=>{let{tr:t,state:n,dispatch:a}=e;return t.setMeta("preventDispatch",!0),0!==ab.Mj.getState(n).undoManager.undoStack.length&&(!a||(0,aX.tN)(n)||!0)},redo:()=>e=>{let{tr:t,state:n,dispatch:a}=e;return t.setMeta("preventDispatch",!0),0!==ab.Mj.getState(n).undoManager.redoStack.length&&(!a||(0,aX.ZS)(n)||!0)}}),addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo()}},addProseMirrorPlugins(){let e=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field);return[(0,a0.YZ)(e),(0,aX.$J)()]}}),a3=()=>new el.k_({key:new el.hs("undoHistoryPlugin"),appendTransaction(e,t,n){if(e.some(e=>!1==e.getMeta("addToHistory"))){let e=n.tr;return e.setMeta("addToHistory",!1),e}return null}}),a5=A.YY.create({name:"undoHistory",priority:a1.y.UndoHistory,addProseMirrorPlugins:()=>[a3()],addCommands:()=>({noUndo:()=>e=>{let{tr:t}=e;return t.setMeta("addToHistory",!1),!0}})});var a6=n(97481),a4=n.n(a6),a8=n(33612),a7=n.n(a8);let a9=(e,t,n)=>{let a=e.resolve(t),o=e.resolve(n),r=a.nodeAfter,i=o.nodeBefore;return!!(r&&(0,ev.jg)(r)&&i&&(0,ev.jg)(i)&&r===i)};var oe=n(30963);let ot=(e,t,n)=>e!==t,on=e=>{let t=document.createElement("span");t.classList.add("ProseMirror-yjs-cursor"),t.setAttribute("style","border-color: ".concat(e.color));let n=document.createElement("div");n.setAttribute("style","background-color: ".concat(e.color)),n.insertBefore(document.createTextNode(e.name),null);let a=document.createTextNode(""),o=document.createTextNode("");return t.insertBefore(a,null),t.insertBefore(n,null),t.insertBefore(o,null),t},oa=e=>({style:"background-color: ".concat(e.color,"70"),class:"ProseMirror-yjs-selection"}),oo=(e,t)=>(n,o,r,i)=>{let l=[];l.push(a.NZ.widget(i,()=>t(n),{key:o+"",side:10}));let s=oe.jk(r,i),d=oe.T9(r,i);return l.push(a.NZ.inline(s,d,e(n),{inclusiveEnd:!0,inclusiveStart:!1})),l},or=/^#[0-9a-fA-F]{6}$/,oi=(e,t,n,o)=>{let r=ab.pJ.getState(e),i=r.doc,l=[];return null!=r.snapshot||null!=r.prevSnapshot||null===r.binding?a.zF.create(e.doc,[]):(t.getStates().forEach((t,a)=>{if(n(i.clientID,a,t)&&null!=t.cursor){let n=t.user||{};null==n.color?n.color="#ffa500":or.test(n.color)||console.warn("A user uses an unsupported color format",n),null==n.name&&(n.name="User: ".concat(a));let s=(0,az.bL)(i,r.type,m.sH(t.cursor.anchor),r.binding.mapping),d=(0,az.bL)(i,r.type,m.sH(t.cursor.head),r.binding.mapping);if(null!==s&&null!==d){let t=oe.T9(e.doc.content.size-1,0);s=oe.jk(s,t),d=oe.jk(d,t),l.push(...o(e,n,a,s,d))}}}),a.zF.create(e.doc,l))},ol=function(e){let{awarenessStateFilter:t=ot,cursorBuilder:n=on,selectionBuilder:a=oa,getSelection:o=e=>e.selection,createCursorDecorations:r=oo(a,n)}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"cursor";return new el.k_({key:ab.S6,state:{init:(n,a)=>oi(a,e,t,r),apply(n,a,o,i){let l=ab.pJ.getState(i),s=n.getMeta(ab.S6);return l&&l.isChangeOrigin||s&&s.awarenessUpdated?oi(i,e,t,r):a.map(n.mapping,n.doc)}},props:{decorations:e=>ab.S6.getState(e)},view:t=>{let n=()=>{t.docView&&(0,az.iZ)(t,ab.S6,{awarenessUpdated:!0})},a=()=>{let n=ab.pJ.getState(t.state),a=e.getLocalState()||{};if(null!=n.binding)if(t.hasFocus()){let r=o(t.state),l=(0,az.Bw)(r.anchor,n.type,n.binding.mapping),s=(0,az.Bw)(r.head,n.type,n.binding.mapping);null!=a.cursor&&m.uG(m.sH(a.cursor.anchor),l)&&m.uG(m.sH(a.cursor.head),s)||e.setLocalStateField(i,{anchor:l,head:s})}else null!=a.cursor&&null!==(0,az.bL)(n.doc,n.type,m.sH(a.cursor.anchor),n.binding.mapping)&&e.setLocalStateField(i,null)};return e.on("change",n),t.dom.addEventListener("focusin",a),t.dom.addEventListener("focusout",a),{update:a,destroy:()=>{t.dom.removeEventListener("focusin",a),t.dom.removeEventListener("focusout",a),e.off("change",n),e.setLocalStateField(i,null)}}}})},os=()=>null,od=e=>Array.from(e.entries()).map(e=>{let[t,n]=e;return{clientId:t,...n.user}}),oc=A.YY.create({name:"collaborationCursor",addOptions:()=>({provider:null,user:{name:null,color:null},render:e=>{let t=document.createElement("span");if(!e.isReady)return t;t.classList.add("collaboration-cursor__caret"),t.setAttribute("style","border-color: ".concat(e.color));let n=document.createElement("div");n.classList.add("collaboration-cursor__label"),n.setAttribute("style","background-color: ".concat(e.color,"; color: ").concat(a7()(e.color).isDark()?"white":"black"));let a=e.name.split(" ")[0];return n.insertBefore(document.createTextNode(a),null),t.insertBefore(n,null),t},buildSelection:e=>({style:"background-color: ".concat(e.color,"70"),class:"ProseMirror-yjs-selection"}),onUpdate:os}),addStorage:()=>({users:[]}),addCommands(){return{user:e=>()=>(this.options.user=a4()({},this.options.user,e),this.options.provider.awareness.setLocalStateField("user",this.options.user),!0)}},addProseMirrorPlugins(){return[ol((this.options.provider.awareness.setLocalStateField("user",this.options.user),this.storage.users=od(this.options.provider.awareness.states),this.options.provider.awareness.on("update",()=>{this.storage.users=od(this.options.provider.awareness.states)}),this.options.provider.awareness),{createCursorDecorations:(e,t,n,o,r)=>{let i=[];if(a9(e.doc,o,r))return i;i.push(a.NZ.widget(r,()=>this.options.render(t),{key:n+"",side:10}));let l=o<r?o:r,s=o>r?o:r;return i.push(a.NZ.inline(l,s,this.options.buildSelection(t),{inclusiveEnd:!0,inclusiveStart:!1})),i}})]}});var ou=n(7915);let op=A.YY.create({name:"globalDragHandle",priority:a1.y.GlobalDragHandle,addOptions:()=>({scrollerSelector:"body"}),addStorage:()=>({enabled:!0}),addProseMirrorPlugins(){return[(0,ou.l)({editor:this.editor,storage:this.storage,scrollerSelector:this.options.scrollerSelector})]},extendNodeSchema(e){var t;return{containerHandle:null!=(t=(0,A.gk)((0,A.iI)(e,"containerHandle",e)))&&t}}});var oh=n(1739),og=n(24926),om=n(55452);let of=new el.hs("erasingContent");class oy{toJSON(){return{datetime:this.timestamp.toISOString(),meta:this.tr.meta,steps:this.tr.steps.map(e=>e.toJSON())}}constructor(e){this.tr=e,this.timestamp=new Date(new Date().toLocaleString("en-US",{timeZone:"America/Los_Angeles"}))}}class ov{apply(e,t){return e.docChanged&&(this.transactions.unshift(new oy(e)),this.transactions.length>5&&this.transactions.pop()),this}constructor(){this.transactions=[]}}class ob extends Error{constructor(e){super(e||"Content erased"),this.name="ContentErasedError"}}let ow=A.YY.create({name:"ErasingContent",addProseMirrorPlugins(){let e=this,t=t=>{try{var n;let a=(0,nK.HW)();for(let t of this.options.messageLogger.flushMessages()){let n={...t.toDebugObject(),clientID:e.options.provider.document.clientID};og.yf.logger.info(t.toString(),n),console.log(t.toString(),n)}let o=Math.floor(performance.now()-this.options.startTime),r={event:"CONTENT_ERASED",didFilterTransaction:t.didFilterTransaction,tr:t.tr.toJSON(),prevTrs:null==(n=t.prevTrs)?void 0:n.map(e=>e.toJSON()),timeSinceOpened:o,isBackgrounded:!!document.hidden,docId:this.options.provider.configuration.name,clientID:this.options.provider.document.clientID,userId:null==a?void 0:a.id};og.yf.logger.error("[ErasingContent] ".concat(o," content erased (FILTERED: ").concat(t.didFilterTransaction,")"),r),om.Cp(new ob)}catch(e){console.error("Failed to log content erased",e),om.Cp(e)}};return[new el.k_({key:of,filterTransaction:(e,n)=>{if(!e.docChanged)return!0;let a=n.doc.type.createAndFill().content;if(null===e.doc.content.findDiffStart(a)){let a=new oy(e),o=of.getState(n),r=eI.of.get("filterContentErasingTrs");return t({tr:a,didFilterTransaction:r,prevTrs:null==o?void 0:o.transactions}),!r}return!0},state:{init:()=>new ov,apply:(e,t,n,a)=>t.apply(e,a)}})]}});var ox=n(86932),oI=n(64084);let oC=A.YY.create({name:"filmstrip",onCreate(){let e=ab.Mj.getState(this.editor.state).undoManager;e.on("stack-item-popped",t=>{let{undoStack:n,redoStack:a}=e,o=t.stackItem.meta.get("filmstripState");if(!o)return;let r=(0,oI.Tz)((0,H.KA)().getState());"undo"===t.type&&a.length>0?a[a.length-1].meta.set("filmstripState",r):"redo"===t.type&&n.length>0&&n[n.length-1].meta.set("filmstripState",r),(0,H.KA)().dispatch((0,oI.Uy)(o))})}});var oS=n(2426),ok=n(24037);class oA{initialize(e){let{element:t,tippyTarget:n,tippyOptions:a}=e;if(!t||!n)return void console.warn("[BubbleMenuView] initialize. No element provided");this.element=t,this.target=n,this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.createTooltip(a),this.element.style.visibility="visible"}createTooltip(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t||this.view.dom.parentElement;n&&this.element&&(this.tippy=(0,al.Ay)(n,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"bottom",hideOnClick:"toggle",offset:[0,5],...e}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",this.tippyBlurHandler))}update(e){let t=ok.X.getState(e.state);if(!this.element||!this.target){if(!t.element||!t.tippyTarget)return;this.initialize(t)}let n=t.getNodePos();if(!n)return void this.hide();this.show(n)}show(e){var t,n;let a=this.editor.view.state.doc.nodeAt(e),o=a?(0,as.KQ)(a):"ltr";null==(t=this.tippy)||t.setProps({getReferenceClientRect:()=>(0,A.MG)(this.editor.view,e,e),placement:"rtl"===o?"bottom-start":"bottom-end"}),null==(n=this.tippy)||n.show()}hide(){var e;this.onHide&&"function"==typeof this.onHide&&this.onHide(),null==(e=this.tippy)||e.hide()}destroy(){var e,t;(null==(e=this.tippy)?void 0:e.popper.firstChild)&&this.tippy.popper.firstChild.removeEventListener("blur",this.tippyBlurHandler),null==(t=this.tippy)||t.destroy(),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}constructor({editor:e,view:t}){this.element=null,this.target=null,this.getNodePos=()=>null,this.preventHide=!1,this.onHide=()=>{},this.focusHandler=()=>{setTimeout(()=>this.update(this.view))},this.blurHandler=e=>{var t,n;let{event:a}=e;if(this.preventHide){this.preventHide=!1;return}(null==a?void 0:a.relatedTarget)&&(null==(n=this.element)||null==(t=n.parentNode)?void 0:t.contains(a.relatedTarget))||(null==a?void 0:a.relatedTarget)!==this.editor.view.dom&&this.hide()},this.tippyBlurHandler=e=>{this.blurHandler({event:e})},this.editor=e,this.view=t}}let oT=A.YY.create({name:"gammaBubbleMenu",addCommands:()=>({forceHideGammaBubbleMenu:e=>t=>{let{tr:n}=t;return n.setMeta(ok.X,{forceHide:e}),!0}}),addProseMirrorPlugins(){let{editor:e}=this;return[new el.k_({key:ok.X,state:{init:()=>({element:null,tippyTarget:null,forceHide:!1,getNodePos:()=>null,tippyOptions:{}}),apply(e,t){let n=e.getMeta(ok.X);return n?{...t,...n}:t}},view:t=>new oA({view:t,editor:e})})]}});var oz=n(43028),oP=n(45574),oE=n(2320);let oj=A.YY.create({name:"scrollMargin",addProseMirrorPlugins:()=>[new el.k_({props:{scrollMargin:eo.E0,scrollThreshold:eo.E0}})]});var oM=n(25600),oR=n(25105),oD=n(27196),oB=n(51817),oL=n(12514),o_=n(21157),oN=n.n(o_),oO=n(80911);let oF=e=>{let{editor:t}=e,[n,a]=(0,h.useState)(null);(0,h.useEffect)(()=>{if(!t)return;let e=()=>{a(t.state.selection)};return e(),t.on("selectionUpdate",e),()=>{t.off("selectionUpdate",e)}},[t]);let r=n instanceof el.nh,i=n instanceof oO.J,s=oN()((null==n?void 0:n.toJSON().type)||"none"),d=oN()(r&&(null==n?void 0:n.node.type.name)||""),c=i?void 0:r?"blue":"green";return(0,o.jsx)(oL.Z,{children:(0,o.jsx)(b.s,{className:"selection-debugger",position:"absolute",top:"50px",left:"10px",zIndex:"999999",children:(0,o.jsxs)(l.B,{direction:"column",children:[(0,o.jsxs)(I.E,{colorScheme:c,children:[s,d&&(0,o.jsxs)("i",{children:[" (",d,")"]})]}),n&&(0,o.jsxs)(I.E,{colorScheme:"gray",children:["f:",n.from," - t:",n.to,i&&" | side:".concat(n.side)]})]})})})};var oU=n(68986),oH=n(65148);let oq=(0,R.d_)("1234567890",10),oV=()=>{let e=oU.e.getItem(oH.E.sessionId);if(e)return e;let t="".concat(+new Date,"__").concat(oq());return oU.e.setItem(oH.E.sessionId,t),t},oW=(e,t)=>{let{user:n,isUserLoading:a,anonymousUser:o,color:r}=(0,nK.ur)(),i=(0,h.useRef)(!1),l=(0,nL.wA)(),s=(0,h.useMemo)(()=>oV(),[]),d=(0,H.GV)(W.l$),c=(0,h.useMemo)(()=>({id:(null==n?void 0:n.id)||o.id,color:r.value,sessionId:d?s+"__pv":s,isPresenterView:d,idleSince:null,name:(null==n?void 0:n.displayName)||o.displayName||"",profileImageUrl:(null==n?void 0:n.profileImageUrl)||"",isReady:!a,spotlight:{pos:null,cardId:null}}),[n,r,a,d,o,s]);(0,h.useEffect)(()=>{if(!e||e.isDestroyed||!(null==t?void 0:t.awareness))return;e.commands.user(c),!i.current&&c.isReady&&(e.chain().blur().focusDelayed().run(),i.current=!0),l((0,W.vK)({sessionId:c.sessionId}));let n=(e,n)=>{let{added:a,updated:o,removed:r}=e;requestIdleCallback(()=>{if(!t.awareness)return;let e=od(t.awareness.states);l((0,W._)({collaborators:e}))},{timeout:500})};t.awareness.on("change",n);let a=eH()(n,W.Y5);return t.awareness.on("update",a),()=>{var e,o;null==(e=t.awareness)||e.off("change",n),null==(o=t.awareness)||o.off("update",a)}},[c,e,t,l]),(0,h.useEffect)(()=>{if(!e)return;let t=eH()(t=>{e.commands.user(t)},10);return(0,H.oM)(W.kM,t)},[e])};var oG=n(96284),oJ=n(22448),oK=n(10612),oY=n.n(oK);let oQ=e=>JSON.stringify(Array.from(e.entries())),oZ=e=>JSON.stringify(Array.from(e)),o$=e=>Array.from(e.entries()),oX=e=>e instanceof m.q7?{__type:e.constructor.name,id:e.id,length:e.length,info:e.info,parent:e.parent,parentSub:e.parentSub,content:{__type:e.content.constructor.name,...e.content}}:e,o0=()=>{let e=(0,oJ.xv)();return(0,oJ.Qj)(e,""),(0,oJ.zd)(e,u.Go.Sync),(0,oJ.zd)(e,1),(0,oJ.Gu)(e,new Uint8Array([])),(0,oJ.Fo)(e)};class o1{setTransaction(e){this.transaction=e}shouldAssociateTransaction(){return!1}getPayload(){return{}}toString(){let e="in"===this.dir?"\uD83D\uDFE9":"\uD83D\uDFE6",t=oY()(String(this.timestamp),5);return"".concat("[HocuspocusMessage]"," ").concat(t," ").concat(e," ").concat(this.typeName)}toDebugObject(){var e;return{event:"hocuspocus-message",docId:this.docId,userId:null==(e=(0,Y.HW)())?void 0:e.id,hocuspocusMessage:{dir:this.dir,timestamp:this.timestamp,typeName:this.typeName,messageType:this.messageType,payload:this.getPayload()}}}static fromOutgoingMessage(e,t){let n=0===e.encoder.cpos&&0===e.encoder.bufs.length?o0():(0,oJ.Fo)(e.encoder);return o1.fromData("out",n,t)}static fromIncomingMessage(e,t){return o1.fromData("in",new Uint8Array(e),t)}static fromData(e,t,n){let a=(0,oG.$C)(t),o=(0,oG.t3)(a);switch((0,oG.cw)(a)){case u.Go.Sync:return new o2(o,e,a,n);case u.Go.Awareness:return new o3(o,e,a,n);case u.Go.Auth:return new o5(o,e,a,n);case u.Go.QueryAwareness:return new o6(o,e,a,n);case u.Go.Stateless:return new o4(o,e,a,n);case u.Go.CLOSE:return new o8(o,e,a,n);case u.Go.SyncStatus:return new o7(o,e,a,n);default:return new o1(o,e,n)}}constructor(e,t,n){this.docId=e,this.dir=t,this.timestamp=n,this.messageType=null,this.typeName="DebugHocuspocusMessage",this.transaction=null}}class o2 extends o1{getPayload(){let{transaction:e}=this,t=null,n=null;if(0===this.syncStep){var a;a=this.update,t=JSON.stringify(o$(m.Zx(a)))}else this.syncStep>0&&(n=function(e){try{let t=m.W3(new Uint8Array(e));return{ds:JSON.stringify(o$(t.ds.clients)),structs:JSON.stringify(t.structs.map(oX))}}catch(e){return{}}}(this.update));let o={syncStepName:this.syncStepName,syncStep:this.syncStep,update:oZ(this.update),stateVector:t,decodedUpdate:n,transaction:null};return null!==e&&(o.transaction={beforeState:oQ(e.beforeState),beforeStateSize:e.beforeState.size,afterState:oQ(e.afterState),afterStateSize:e.afterState.size,changed:oQ(e.changed),changedSize:e.changed.size,deleteSet:oQ(e.deleteSet.clients),deleteSetSize:e.deleteSet.clients.size}),o}shouldAssociateTransaction(){return 2===this.syncStep}toString(){let e=super.toString();return"".concat(e," [step=").concat(this.syncStepName,"]")}constructor(e,t,n,a){super(e,t,a),this.messageType=u.Go.Sync,this.typeName="Sync",this.syncStep=(0,oG.cw)(n),this.syncStepName=0===this.syncStep?"SyncStep1":1===this.syncStep?"SyncStep2":"Update",this.update=(0,oG.bo)(n)}}class o3 extends o1{getPayload(){return{len:this.states.length,states:this.states}}constructor(e,t,n,a){super(e,t,a),this.messageType=u.Go.Awareness,this.typeName="Awareness",this.states=[];let o=(0,oG.bo)(n),r=(0,oG.$C)(o),i=(0,oG.cw)(r);for(let e=0;e<i;e++){let e=(0,oG.cw)(r),t=(0,oG.cw)(r),n=(0,oG.t3)(r);this.states.push({clientId:e,clock:t,state:n})}}}class o5 extends o1{getPayload(){return{authMessageType:this.authMessageTypeName,scope:this.scope}}toString(){let e=super.toString();return"".concat(e," [authType=").concat(this.authMessageTypeName,"]")}constructor(e,t,n,a){super(e,t,a),this.messageType=u.Go.Auth,this.typeName="Auth",this.authMessageType=(0,oG.cw)(n),this.authMessageTypeName=0===this.authMessageType?"Token":1===this.authMessageType?"PermissionDenied":"Authenticated",this.scope=(0,oG.t3)(n)}}class o6 extends o1{constructor(e,t,n,a){super(e,t,a),this.messageType=u.Go.QueryAwareness,this.typeName="QueryAwareness"}}class o4 extends o1{constructor(e,t,n,a){super(e,t,a),this.messageType=u.Go.Stateless,this.typeName="Stateless"}}class o8 extends o1{constructor(e,t,n,a){super(e,t,a),this.messageType=u.Go.CLOSE,this.typeName="Close"}}class o7 extends o1{getPayload(){return{saved:this.saved}}constructor(e,t,n,a){super(e,t,a),this.messageType=u.Go.SyncStatus,this.typeName="SyncStatus",this.saved=1===(0,oG.cw)(n)}}let o9=()=>{let e=(0,h.useRef)(null);return{onTransaction:(0,h.useCallback)(t=>{e.current=t},[]),getTransaction:(0,h.useCallback)(()=>{let t=e.current;return e.current=null,t},[])}};class re{onMessage(e){e.messageType!==u.Go.Awareness&&(this.buffer.push(e),this.buffer.length>this.bufferSize&&this.buffer.shift())}getMessages(){return this.buffer}flushMessages(){let e=this.buffer;return this.buffer=[],e}constructor(e=50){this.bufferSize=e,this.buffer=[]}}var rt=n(50333),rn=n.n(rt);let ra=e=>{let[t,n]=(0,h.useState)([]);return{logMessages:t,logPerfMessage:(0,h.useCallback)(t=>{if(!e)return;let a=performance.now(),o={msg:t,timestamp:a};n(e=>0===e.length?[...e,o]:e.find(e=>e.msg===t)||e[e.length-1].msg===t?e:(o.duration=rn()(a-e[e.length-1].timestamp,2),[...e,o]))},[e]),dumpLog:(0,h.useCallback)(()=>{e&&n(e=>{try{console.table(e)}catch(e){}return[]})},[e])}};var ro=n(80314),rr=n(37605);let ri="not-connecting-toast",rl=()=>{let e="dev"===f.$.APPLICATION_ENVIRONMENT||"staging"===f.$.APPLICATION_ENVIRONMENT;return(0,o.jsx)(b.s,{direction:"column",p:4,color:"white",bg:"yellow.500",borderRadius:"md",children:(0,o.jsxs)(b.s,{alignItems:"center",children:[(0,o.jsx)(s.y,{mr:4}),(0,o.jsxs)(r.a,{ml:3,children:[(0,o.jsx)(d.E,{lineHeight:6,fontSize:"sm",fontWeight:"bold",children:(0,o.jsx)(k.x6,{id:"9tGBiL",values:{GAMMA_ARTIFACT_PROPER_NOUN:L.TP}})}),(0,o.jsx)(d.E,{lineHeight:6,fontSize:"sm",children:(0,o.jsx)(k.x6,{id:"xpqx+T"})}),e&&(0,o.jsx)(w.z,{children:(0,o.jsxs)(ro.N,{href:"https://github.com/gamma-app/gamma/blob/main/packages/client/src/modules/tiptap_editor/CollaborativeEditor/DEBUG_NOT_CONNECTING_TOAST.md",color:"deepocean.500",children:[(0,o.jsx)(I.E,{colorScheme:"orange",fontSize:"xxs",me:1,children:"Gamma Only"}),"Debug Developer Connection Issues"]})})]})]})})},rs=e=>{let{enabled:t,docId:n}=e,a=(0,z.d)(),o=(0,h.useRef)(null),r=(0,h.useCallback)(()=>{a.close(ri),o.current&&(clearTimeout(o.current),o.current=null)},[a]);return(0,h.useEffect)(()=>{if(t)return o.current=setTimeout(()=>{a.isActive(ri)||(a({render:rl,duration:null,id:ri}),og.yf.logger.info("Editor slow load toast shown",{event:rr.ng.EDITOR_SLOW_LOAD,docId:n}))},15e3),()=>{o.current&&(clearTimeout(o.current),o.current=null)}},[n,t,a]),r};var rd=n(12733),rc=n(67604),ru=n(81141),rp=n(88586),rh=n(25991),rg=n(86497);let rm=e=>{let t=(0,rc.A)(e),n=new Date;return 4>=Math.abs((0,ru.A)(n,t))},rf=(e,t)=>{let[n,a]=(0,h.useState)(!1),o=(0,h.useRef)(null);(0,h.useEffect)(()=>{if(t){o.current&&clearTimeout(o.current),a(!1);return}return o.current=setTimeout(()=>{a(!0)},1e4),()=>{o.current&&clearTimeout(o.current)}},[t]);let r=(0,H.GV)(rh.TT)[e];if(!r)return!1;let i=r.lastSynced;return!!(i&&rm(i))||n},ry=(e,t)=>{let{isInOfflineMode:n}=(0,rp.utY)(),a=(0,rg.O)(),o=(0,H.GV)(rh.yy),r=rf(e,t);return n||(a||o)&&r};var rv=n(96500),rb=n(64268),rw=n(51504),rx=n(5221),rI=n(99745),rC=n(51684),rS=n(65905);let rk=()=>!!window.navigator&&!1===window.navigator.onLine,rA=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e4,[t,n]=(0,h.useState)(rk),a=(0,h.useRef)(null);return(0,rS.LQ)("offline",()=>{a.current=setTimeout(()=>{n(!0)},e)}),(0,rS.LQ)("online",()=>{a.current&&(clearTimeout(a.current),a.current=null),n(!1)}),t};var rT=n(14900),rz=n(43607),rP=n(69138),rE=n(29238);let rj=async(e,t,n,a)=>{try{let{id:o,length:r}=n||{},i=await fetch("".concat(f.$.MULTIPLAYER_WS_URL.replace("wss","https"),"/").concat(e,"/verify/").concat(t),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:o,length:r,clientCount:null==a?void 0:a.clientCount,totalCount:null==a?void 0:a.totalCount})});return await i.json()}catch(e){}},rM=e=>{let t=e.document.store.clients.get(e.document.clientID);if(t&&t.length)return t[t.length-1]},rR=e=>({clientCount:e.document.store.clients.size,totalCount:[...e.document.store.clients.values()].reduce((e,t)=>e+t.reduce((e,t)=>e+t.length,0),0)}),rD=async(e,t,n)=>{let a=rM(t),o=rR(t),r=await rj(e.gammaDocId,t.document.clientID,a,o);if(!r)return console.warn("[compareClocks] Failed to fetch remote clock"),!1;try{var i;let e=((null==a?void 0:a.id.clock)||0)+((null==a?void 0:a.length)||0),t=((null==r||null==(i=r.lastKnownItem.id)?void 0:i.clock)||0)+((null==r?void 0:r.lastKnownItem.length)||0),l=e-t;l>0&&console.warn("[compareClocks] Clock drift detected",{diffLastItem:l});let s=o.clientCount-(r.itemSummary.clientCount||0),d=o.totalCount-(r.itemSummary.totalCount||0);return s>0&&console.warn("[compareClocks] clientCount drift detected",{diffClientCount:s}),d>0&&console.warn("[compareClocks] totalCount drift detected",{diffTotalCount:d}),0===s&&d<=n&&l<=n}catch(e){console.warn("[compareClocks] Failed to fetch remote clock")}return!1},rB=e=>{let[t,n]=(0,h.useState)(null==e?void 0:e.status);return(0,h.useEffect)(()=>{if(!e)return;let t=e=>{let{status:t}=e;n(t)};return e.on("status",t),()=>{e.off("status",t)}},[e]),t},rL=e=>{let{editor:t,yProvider:n,enabled:a}=e,o=(0,H.CU)(),[r,i]=(0,h.useState)(Date.now()),[l,s]=(0,h.useState)(0),d=rB(n),[c,u]=(0,h.useState)(a);(0,h.useEffect)(()=>{if(!a)return void u(!1);u(!1);let e=g.wg(()=>{u(!0)},5e3);return()=>{g.DJ(e)}},[a,d]);let p=(0,eI.u)("dataSyncClockDriftTolerance"),m=(0,h.useCallback)(async()=>{if(!t||!n||!t.gammaDocId)return;let{online:e,backgrounded:a}=(0,rE.mN)(o.getState());e&&!a&&(await rD(t,n,p)?(s(0),i(Date.now())):(s(e=>e+1),console.warn("[useDataPersistenceSync_2] Clocks out of sync for doc",t.gammaDocId)))},[p,t,o,n]),f=0===l?2e4:4e3;return(0,h.useEffect)(()=>{if(!t||!n||!c)return;let e=setInterval(()=>{m()},f);return()=>{e&&clearInterval(e)}},[t,n,c,f,p,m]),{errorCount:l,yDocLastSynced:r,checkDataInSync:m}},r_="data-sync-error-toast",rN="data-sync-not-saved-toast",rO=(0,o.jsx)(j.g,{icon:rC.lEd,size:"2x"}),rF=(0,o.jsx)(j.g,{icon:rC.JAe,size:"2x"}),rU=e=>{let{type:t,yDocLastSynced:n}=e;return()=>(0,o.jsx)(b.s,{direction:"column",p:4,color:"white",bg:"warn"===t?"yellow.500":"red.500",borderRadius:"md",children:(0,o.jsxs)(b.s,{alignItems:"center",children:["warn"===t?rO:rF,(0,o.jsxs)(r.a,{ml:3,children:[(0,o.jsx)(d.E,{lineHeight:6,fontSize:"sm",fontWeight:"bold",children:"warn"===t?(0,o.jsx)(k.x6,{id:"BM8j3v",values:{GAMMA_PROPER_NOUN:L.On}}):(0,o.jsx)(k.x6,{id:"DgKz0c",values:{GAMMA_PROPER_NOUN:L.On}})}),n&&(0,o.jsx)(d.E,{lineHeight:6,fontSize:"sm",children:(0,o.jsx)(k.x6,{id:"VxWwaW",values:{0:(0,rT.Bo)(new Date(n).toISOString())}})}),"error"===t&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(rv.c,{pt:2}),(0,o.jsx)(d.E,{lineHeight:6,fontSize:"sm",pt:2,children:(0,o.jsx)(k.x6,{id:"Pw5K5r"})})]})]})]})})},rH=e=>{let{onClose:t}=e;return(0,o.jsxs)(rb.F,{status:"info",colorScheme:"gray",alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",children:[(0,o.jsx)(rw._,{}),(0,o.jsxs)(r.a,{flex:"1",maxWidth:"100%",children:[(0,o.jsx)(rx.X,{children:(0,o.jsx)(k.x6,{id:"BM8j3v",values:{GAMMA_PROPER_NOUN:L.On}})}),(0,o.jsx)(rI.T,{display:"block",children:(0,o.jsx)(k.x6,{id:"I1QCnH"})})]}),(0,o.jsx)(C.J,{size:"sm",onClick:t,position:"absolute",insetEnd:1,top:1})]})},rq=e=>{let{enabled:t,errorCount:n,errorCountThreshold:a,isPresentModeAndNotEditing:o,background:r,offline:i}=e;return!t||o||r||i||-1===a?"ignored":n>2*a?"error":n>a?"warn":"ok"},rV=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3,[t,n]=(0,h.useState)(!0),a=(0,h.useRef)(null);return(0,rS.LQ)("foreground",t=>{let{timeInBackground:o}=t;if(null===o)return void n(!0);if(o>6e4){a.current=setTimeout(()=>{n(!0)},e);return}n(!0)}),(0,rS.LQ)("background",()=>{a.current&&(clearTimeout(a.current),a.current=null),n(!1)}),t},rW=e=>{let{offline:t,yDocLastSynced:n}=e,a=(0,z.d)(),[r,i]=(0,h.useState)(!1),l=(0,rg.O)(),s=(0,H.GV)(rh.yy),d=(l||s)&&!t;return(0,h.useMemo)(()=>({warnOrError:e=>{if(d)return!a.isActive(rN)&&!r&&(a({id:rN,duration:null,render:e=>{let{onClose:t}=e;return rH({onClose:()=>{t(),i(!0)}})}}),!0);let t=rU({type:e,yDocLastSynced:n});return a.isActive(r_)?(a.update(r_,{render:t}),!1):(a({render:t,duration:null,id:r_}),!0)},recovered:e=>!!(d?a.isActive(rN)||r:a.isActive(r_))&&((a.isActive(r_)||a.isActive(rN))&&a.closeAll(),"ignored"!==e&&(d&&(a({title:(0,o.jsx)(k.x6,{id:"flElqq",values:{GAMMA_PROPER_NOUN:L.On}}),description:(0,o.jsx)(k.x6,{id:"Gm5OG1"}),status:"success",duration:5e3,id:"data-sync-saved-toast",isClosable:!0}),i(!1)),!0))}),[r,a,d,n])},rG=e=>{let{editor:t,yProvider:n,enabled:a}=e,o=(0,H.GV)(W.VJ),r=(0,rz.UT)("comment"),i=(0,H.GV)(W.jn),l=(0,tT.st)(),{user:s}=(0,nK.ur)(),d=(0,h.useRef)(),c=(0,eI.u)("dataSyncErrorThreshold"),{errorCount:u,yDocLastSynced:p}=rL({editor:t,yProvider:n,enabled:a&&r}),g={docSavedTime:i,yDocLastSynced:p,errorCount:u,clientID:null==n?void 0:n.document.clientID,userId:null==s?void 0:s.id},m=(0,h.useRef)(g);m.current=g;let f=rA(),y=rV(),v=(0,h.useRef)();v.current={errorCount:u,enabled:a,errorCountThreshold:c,isPresentModeAndNotEditing:o,background:!y,offline:f};let b=rq(v.current),w=rW({offline:f,yDocLastSynced:p});return(0,rP.V)(()=>{if("ok"===b||"ignored"===b){if(!w.recovered(b))return;let e=d.current?new Date-d.current:void 0;null==l||l.trackDocEvent(tT.ng.DATA_SYNC_RECOVER,{...m.current,duration:e}),og.yf.logger.info("Data sync recovered",{event:tT.ng.DATA_SYNC_RECOVER,docId:null==t?void 0:t.gammaDocId,errorStatusInput:v.current,docEventData:m.current}),d.current=void 0;return}w.warnOrError(b)&&(null==l||l.trackDocEvent(tT.ng.DATA_SYNC_ERROR,m.current),og.yf.logger.info("Data sync error",{event:tT.ng.DATA_SYNC_ERROR,docId:null==t?void 0:t.gammaDocId,dataSyncErrorType:b,errorStatusInput:v.current,docEventData:m.current}),"error"===b&&om.Cp("[useDataPersistenceSync] ERROR_THRESHOLD_EXCEEDED. docId: ".concat(null==t?void 0:t.gammaDocId)))},[l,null==t?void 0:t.gammaDocId,b,w],[b]),"error"===b},rJ=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=(0,h.useRef)(0),a=(0,h.useRef)(0),[o,r]=(0,h.useState)(!1),[i,l]=(0,h.useState)(0),[s,d]=(0,h.useState)(document.hidden),c=(0,h.useRef)(()=>{n.current++,n.current>=t&&(console.warn("[useRateLimiter] Limit hit! (".concat(t," per ").concat(e/1e3,"s)")),o||(r(!0),l(e=>e+1))),a.current||(a.current=g.yb(()=>{n.current>0?n.current--:(r(!1),g.vG(a.current),a.current=0)},e/t))});return(0,h.useEffect)(()=>{let e=()=>{d(document.hidden),c.current()};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[]),[c.current,o,i,s]},rK=()=>(0,o.jsxs)(x.T,{align:"flex-end",borderRadius:"base",shadow:"lg",p:3,bg:"gray.50",spacing:4,maxW:"300px",direction:"row",children:[(0,o.jsxs)(r.a,{children:[(0,o.jsx)(d.E,{fontSize:"md",fontWeight:"bold",children:(0,o.jsx)(k.x6,{id:"8kh5VW",values:{GAMMA_PROPER_NOUN:L.On}})}),(0,o.jsxs)(d.E,{fontSize:"sm",children:[(0,o.jsx)(k.x6,{id:"CDva2g"})," ",(0,o.jsx)("em",{children:(0,o.jsx)(k.x6,{id:"/vuJlA"})})," ","\uD83D\uDE0E"]})]}),(0,o.jsx)(r.a,{children:(0,o.jsx)(P.$,{size:"sm",onClick:()=>{window.location.reload()},children:(0,o.jsx)(k.x6,{id:"HpK/8d"})})})]}),rY=e=>{let t=(0,z.d)(),[n,a]=(0,h.useState)(!1);return(0,h.useEffect)(()=>{if(!e)return;let t=()=>{let t=e.getMap("SCHEMA_VERSION").get("REQUIRED_VERSION"),n=!!(t&&t>oB.f$);a(n),console[n?"warn":"debug"]("[SchemaVerifier] onUpdate",{requiredVersion:t,MY_VERSION:oB.f$,outdated:n})};return e.on("update",t),()=>{e.off("update",t)}},[e]),(0,h.useEffect)(()=>{n&&!t.isActive("schema_outdated")&&t({id:"schema_outdated",duration:null,status:"warning",isClosable:!1,position:"bottom-left",render:rK})},[n,t]),n},rQ="staging"===f.$.APPLICATION_ENVIRONMENT&&f.$.API_HOST.endsWith("api-custom-backend.staging.gamma.app"),rZ=e=>({DOC_ID:e,SCHEMA_VERSION:String(oB.f$),SHARE_TOKEN:f.$.SHARE_TOKEN,...rQ?{API_HOST:f.$.API_HOST}:{}}),r$=(0,h.memo)(e=>{let{doc:t,docId:n,onCreate:a,readOnly:b=!1,scrollingParentSelector:w,hideForPreview:x=!1,animationsExtensionEnabled:I=!1}=e,[C]=(0,h.useState)(()=>performance.now()),{timeOnCreate:S,timeOnSetupProvider:k,timeOnDownloadDoc:A}=(0,nG.n6)(),T=(0,nt.rd)(),{isUserLoading:z}=(0,nK.ur)(),[P,E]=(0,h.useState)(!1),j=(0,h.useRef)(!1);j.current=P;let[M,R]=(0,h.useState)(!1),[D,B]=(0,h.useState)(!1),L=(0,h.useRef)([]),[_,N]=(0,h.useState)(),[O,F]=(0,h.useState)(),[U,q]=(0,h.useState)(),[V]=(0,h.useState)(()=>new re),{onTransaction:G,getTransaction:J}=o9(),K=(0,nW.iJ)(),Y=(0,nW.iO)(),{isConnected:Q}=(0,v.u)(),Z=ry(n,M),$=rY(O);oW(_,U);let X=rG({editor:_,yProvider:U,enabled:M&&!b});(0,oD.Rf)(_);let[ee,et,en,ea]=rJ(),eo=t&&t.organization&&t.organization.id,er=rs({docId:n,enabled:!M}),ei=(0,t0.u)("debugLogging"),el=(0,H.GV)(eI.Gm),es=(0,t0.u)("waitForGammaPersistenceMeta"),ed=(0,H.jL)(),{logMessages:ec,logPerfMessage:eu,dumpLog:ep}=ra(ei);(0,nY.C)((0,h.useCallback)(()=>{U&&(U.disconnect(),U.configuration.parameters=rZ(n),setTimeout(()=>U.connect(),500))},[U,n])),(0,y.A)(),(0,rd.W)(_),(0,h.useEffect)(()=>{let e;if(!U)return;let t=en>10;if(et){console.warn("[CollaborativeEditor] Attempted to re-connect while rate limited (".concat(en," of ").concat(10,").")),U.disconnect();return}if(t){console.error("[CollaborativeEditor - RECONNECT_RATE_LIMIT] Max rate limit violations reached (".concat(10,"). Will reload.")),setTimeout(()=>{window.location.reload()},500);return}if(j.current)return ea?(console.debug("[CollaborativeEditor] Backgrounded, will wait ".concat(12e4,"s before disconnect")),e=g.wg(()=>{console.debug("[CollaborativeEditor] Disconnecting after grace period"),U.disconnect()},12e4)):(console.debug("[CollaborativeEditor] Foregrounded, so re-connecting"),U.connect()),()=>{e&&g.DJ(e)}},[U,ea,et,en]),(0,h.useEffect)(()=>{_&&!_.isDestroyed&&eo&&(_.commands.initializeUploadExtension(eo),_.commands.removeGeneratorInputsOnLoad())},[_,eo]),(0,h.useEffect)(()=>{O&&n&&Z&&K.loadYDoc(n,O,()=>{console.debug("offlineMode - [ydocOfflineApi] YDoc loaded from indexeddb"),R(!0),E(!0)})},[Z,O,n,K]),(0,h.useEffect)(()=>{console.debug("[CollaborativeEditor] Creating yProvider for doc",n);let e=new m.JA({});e.getXmlFragment("default").observeDeep((e,t)=>{G(t)}),F(e),e.getMap("GammaPersistenceMeta").observeDeep((t,n)=>{e.getMap("GammaPersistenceMeta").get("READY")&&(eu("Document data downloaded"),B(!0))}),eu("Setting up hocuspocus"),k();let t=new u.m({name:n,document:e,forceSyncInterval:15e3,token:rZ(n).SHARE_TOKEN||"null",websocketProvider:new u.nU({url:f.$.MULTIPLAYER_WS_URL,parameters:rZ(n)}),preserveConnection:!1,onOutgoingMessage(e){let{message:t}=e;try{let e=Math.floor(performance.now()-C),n=o1.fromOutgoingMessage(t,e);n.shouldAssociateTransaction()&&n.setTransaction(J()),V.onMessage(n)}catch(e){console.error("[CollaborativeEditor] Error processing outgoing message for debug",e)}},onMessage(e){let{message:t}=e;try{let e=Math.floor(performance.now()-C),n=o1.fromIncomingMessage(t.data,e);n.shouldAssociateTransaction()&&n.setTransaction(J()),V.onMessage(n)}catch(e){console.error("[CollaborativeEditor] Error processing incoming message for debug",e)}},onOpen(){if(!0===eI.of.get("hocuspocusOnAuthenticate"))return void console.log("[CollaborativeEditor] Provider opened. onAuthenticate is enabled so this is a no-op.");t.isAuthenticated=!0,console.log("[CollaborativeEditor] Provider opened.  Setting isAuthenticated to true.")},onStatus(e){let{status:t}=e;console.debug("[CollaborativeEditor][onStatus]",{status:t}),"connected"===t?(eu("Hocuspocus connected"),E(!0),j.current=!0):"connecting"===t&&(eu("Hocuspocus connecting"),ee())},onSynced(){console.debug("[CollaborativeEditor] Provider synced"),R(!0),er(),eu("Document data downloaded"),K.syncYDoc(n,e)},onDisconnect(e){let{event:n}=e;n.code===c.hR.code?console.error('[CollaborativeEditor] Provider disconnected with "Unauthorized.code", which is unexpected.',n):1008===n.code&&(t.disconnect(),nB.LF.emit(nB.DN.Y_DOC_IS_TOO_LARGE,{}),console.error("[CollaborativeEditor][onDisconnect] Document is too large, disconnecting"))}});return t.subscribeToBroadcastChannel(),q(t),ed((0,W.gS)({hocuspocusProvider:t})),f.$.DEBUG_ENABLED&&(window.gammaEditorProvider=t),L.current=[...I?[av.Q]:[],oz.EX,oj,oD.Li.configure({scrollerSelector:w}),a2.configure({document:e}),a5,n0.configure({provider:t}),oc.configure({provider:t}),aN.configure({document:e}),aV,aG,aF.configure(),ap,oS.bY,oT,oR.V,n3.configure({document:e}),ay,oE.c,oh.mk,oP.Q8,ox.wg,oM.bU,p.o5.configure({openDoubleQuote:!1,closeDoubleQuote:!1,openSingleQuote:!1,closeSingleQuote:!1}),op.configure({scrollerSelector:w}),ai,a$,aY,oC,nJ.o.configure({document:e}),ow.configure({startTime:C,messageLogger:V,provider:t})],()=>{console.warn("[CollaborativeEditor] Destroying yProvider for doc ",n),t.disconnect(),t.destroy(),delete window.gammaEditorProvider,q(void 0),R(!1),E(!1),B(!1),setTimeout(()=>{if(t&&t.awareness)try{t.awareness.destroy()}catch(e){console.warn("[CollaborativeEditor] Error destroying awareness provider.")}})}},[]);let eh=!!(P&&M&&(!es||D)&&t&&!z);(0,h.useEffect)(()=>{eh&&(eu("Is ready for TipTap"),A())},[eh,A,eu]),nU(),nq(_,n);let eg=(0,nV.K)();return(0,o.jsxs)(r.a,{display:x?"none":"block",w:"100%","data-testid":"collaborative-editor-wrapper",children:[eh&&el&&(0,o.jsx)(oF,{editor:_}),!_&&(0,o.jsx)(r.a,{flexDirection:"column",flex:"1",w:"100%",h:"var(--100vh)",bg:T?"gray.800":"gray.50",zIndex:"overlay","data-testid":"collaborative-editor-skeleton",inset:0,children:(0,o.jsx)(i.o,{h:"100%",children:(0,o.jsxs)(l.B,{align:"center",children:[(0,o.jsx)(s.y,{}),ec.map((e,t)=>{let{msg:n}=e;return(0,o.jsx)(d.E,{children:n},t)})]})})}),eh&&(0,o.jsx)(nQ.b,{extensions:L.current,doc:t,docId:n,editorId:"main",onCreate:e=>{let{editor:t}=e;setTimeout(()=>{N(t),a&&a(t),requestAnimationFrame(()=>{Q&&Y(n),eg(t),eu("Editor rendered"),S(),ep()})},10)},readOnly:$||b||!Z&&X,shouldSupportComments:!0,shouldSupportMenus:!0,scrollingParentSelector:w})]})});var rX=n(82059);let r0=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{docFlags:{}};return(0,Q.createDocWithCards)(t,[{type:"card",content:[{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"title",attrs:{level:rX.f.DefaultTitle}},{type:"contributors"}]}]},{type:"card",content:[{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"heading"}]}]}])},r1=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,Q.createDocWithCards)(e,[{type:"card",content:[{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"title",attrs:{level:rX.f.DefaultTitle}}]}]}])},r2=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{docFlags:{}};return{type:"doc",content:[{type:"document",attrs:t,content:[{type:"card",content:[{type:"title",attrs:{level:rX.f.DefaultTitle}},{type:"contributors"}]},{type:"card",attrs:{previewContent:null,background:{type:"none"},container:{},cardSize:"default",layout:"blank"},content:[{type:"heading",attrs:{horizontalAlign:null,level:2},content:[{type:"text",text:"Quick Start Checklist"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"zap",native:""}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Type "},{type:"text",marks:[{type:"code"}],text:"/"},{type:"text",marks:[{type:"bold"}],text:" in a card to open the slash menu"}]},{type:"bullet",attrs:{indent:1,fontSize:null},content:[{type:"text",text:"It lets you browse and add content blocks quickly"}]},{type:"bullet",attrs:{indent:1,fontSize:null},content:[{type:"text",text:"Content blocks can be added from the "},{type:"text",marks:[{type:"footnoteLabel",attrs:{noteId:"7jZEg"}}],text:"insert menu"},{type:"footnote",attrs:{noteId:"7jZEg"},content:[{type:"image",attrs:{id:"Y3FmX",horizontalAlign:null,src:"https://cdn.gamma.app/zc87vhr30n8uf3n/b98e59519a994c7abd900f44683bbb5d/optimized/insert-menu-explainer.gif",tempUrl:"blob:https://gamma.app/983566b4-f21e-4d28-bc69-d448c1976833",uploadStatus:0,meta:{width:700,height:459,date_file_modified:"2023/01/20 23:08:42 GMT",duration:4.42,aspect_ratio:1.525,has_clipping_path:!1,frame_count:36,colorspace:"RGB",average_color:"#f7f5f5"},providerMeta:null,name:"insert-menu-explainer.gif",query:null,source:"image.custom",showPlaceholder:!1,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null}}}]},{type:"text",text:" if you prefer to drag"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"heavy_plus_sign",native:""}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Add a new card"},{type:"text",text:" (type "},{type:"text",marks:[{type:"code"}],text:"/card"},{type:"text",text:") or select a template via the "},{type:"text",marks:[{type:"footnoteLabel",attrs:{noteId:"xLt8J"}}],text:"plus button"},{type:"footnote",attrs:{noteId:"xLt8J"},content:[{type:"image",attrs:{id:"3CSXR",horizontalAlign:null,src:"https://cdn.gamma.app/zc87vhr30n8uf3n/a8d6b7149f75401ebd54e6b022670a3e/optimized/image.png",tempUrl:"blob:https://gamma.app/5368f25a-cf30-4410-bf62-bd26080b01f5",uploadStatus:0,meta:{width:844,height:608,date_file_modified:"2023/01/20 21:38:09 GMT",aspect_ratio:1.388,has_clipping_path:!1,frame_count:1,colorspace:"RGB",average_color:"#f7f5f5"},providerMeta:null,name:"image.png",query:null,source:"image.custom",showPlaceholder:!1,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null}}}]}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"newspaper",native:"\uD83D\uDCF0"}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Create multi-column layouts"},{type:"text",text:" (type "},{type:"text",marks:[{type:"code"}],text:"/columns"},{type:"text",text:") or "},{type:"text",marks:[{type:"footnoteLabel",attrs:{noteId:"JyryA"}}],text:"drag blocks"},{type:"footnote",attrs:{noteId:"JyryA"},content:[{type:"image",attrs:{id:"iJXTh",horizontalAlign:null,src:"https://cdn.gamma.app/zc87vhr30n8uf3n/3e47c137ba5d4d13bdafda584b3a8f94/optimized/drag-columns-optimized.gif",tempUrl:"blob:https://gamma.app/654cd2e0-6972-4a24-a7c0-25eff0cf9050",uploadStatus:0,meta:{width:500,height:313,date_file_modified:"2023/01/20 21:35:04 GMT",duration:9.83,aspect_ratio:1.597,has_clipping_path:!1,frame_count:62,colorspace:"RGB",average_color:"#e8cac5"},providerMeta:null,name:"drag-columns-optimized.gif",query:null,source:"image.custom",showPlaceholder:!1,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null}}}]},{type:"text",text:" side by side"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"bridge_at_night",native:"\uD83C\uDF09"}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Add an image "},{type:"text",text:"(type "},{type:"text",marks:[{type:"code"}],text:"/image"},{type:"text",text:"). You can drag in or paste image files too!"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"art",native:"\uD83C\uDFA8"}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Change the deck "},{type:"text",marks:[{type:"bold"},{type:"footnoteLabel",attrs:{noteId:"mTOBc"}}],text:"theme"},{type:"footnote",attrs:{noteId:"mTOBc"},content:[{type:"paragraph",attrs:{horizontalAlign:null,fontSize:null},content:[{type:"text",text:"Click the "},{type:"text",marks:[{type:"code"}],text:"Theme"},{type:"text",text:" button in the top toolbar, then try clicking some of the different options"}]},{type:"image",attrs:{id:"GHNdu",horizontalAlign:"center",src:"https://cdn.gamma.app/zc87vhr30n8uf3n/db839cee72b7497b9ff1424987641ed5/optimized/image.png",tempUrl:null,uploadStatus:0,meta:{width:806,height:1678,date_file_modified:"2022/08/01 23:13:09 GMT",aspect_ratio:.48,has_clipping_path:!1,frame_count:1,colorspace:"RGB",average_color:"#ccc7ca"},providerMeta:null,name:"image.png",query:null,source:"image.custom",showPlaceholder:!1,fullWidthBlock:!1,resize:{clipType:"inset",clipPath:["17.31441903150651%","0%","41.5572854690296%","0%"],clipAspectRatio:1.1678975712005124,width:209.77777777777777}}}]},{type:"text",text:" to give it a different look and feel"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"arrow_forward",native:""}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Try present mode"},{type:"text",text:" and use your arrow keys and "},{type:"text",marks:[{type:"footnoteLabel",attrs:{noteId:"UGnAU"}}],text:"spotlight"},{type:"footnote",attrs:{noteId:"UGnAU"},content:[{type:"paragraph",attrs:{horizontalAlign:null,fontSize:null},content:[{type:"text",text:"Spotlight lets you"},{type:"text",marks:[{type:"bold"}],text:" focus "},{type:"text",text:"on"},{type:"text",marks:[{type:"bold"}],text:" one piece of content at a time. "},{type:"text",text:"While presenting, press "},{type:"text",marks:[{type:"code"}],text:"s"},{type:"text",text:" to enter spotlight mode."}]},{type:"image",attrs:{id:"YOFhU",horizontalAlign:null,src:"https://cdn.gamma.app/zc87vhr30n8uf3n/ed0b362f6c2f4a438cd3188ba7697a02/optimized/spotlight-compressed.gif",tempUrl:"blob:https://gamma.app/d2eaae7f-515e-4e06-b396-4b0551a5a999",uploadStatus:0,meta:{width:1200,height:750,date_file_modified:"2023/01/13 21:48:00 GMT",duration:6.66,aspect_ratio:1.6,has_clipping_path:!1,frame_count:34,colorspace:"RGB",average_color:"#323030"},providerMeta:null,name:"spotlight-compressed.gif",query:null,source:"image.custom",showPlaceholder:!1,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null}}}]},{type:"text",text:" to move around"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"tada",native:"\uD83C\uDF89"}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Share your deck"},{type:"text",text:"."},{type:"text",marks:[{type:"bold"}],text:" "},{type:"text",text:"Publish it to the world, invite others, or export a PDF"}]}]}]}]}};var r3=n(74127)},27196:(e,t,n)=>{n.d(t,{Li:()=>a.Li,Rf:()=>o.R,kY:()=>o.k});var a=n(60300),o=n(69764)},30188:(e,t,n)=>{n.d(t,{b:()=>l,o:()=>s});var a=n(37243),o=n(63867),r=n(41797);let i=new o.hs("yDocSize"),l=e=>{let t=i.getState(e.state);return t?t.getYDocSize():null},s=a.YY.create({name:"yDocSize",addProseMirrorPlugins(){let{document:e}=this.options;return[new o.k_({key:i,state:{init:()=>new d(e),apply:(e,t)=>t}})]}});class d{getYDocSize(){return r.PR(this.ydoc).byteLength}constructor(e){this.ydoc=e}}},51817:(e,t,n)=>{n.d(t,{f$:()=>o}),n(82957);let a=new URLSearchParams(window.location.search),o=(a.get("SCHEMA_VERSION")?Number(a.get("SCHEMA_VERSION")):null)||125},61121:(e,t,n)=>{n.d(t,{GO:()=>z,h3:()=>T,wn:()=>E,SS:()=>P,ZY:()=>B,er:()=>A,Gi:()=>R});var a=n(21938),o=n(37243),r=n(63867),i=n(97255),l=n(15342),s=n(43634),d=n(85235),c=n(33201),u=n(29608),p=n(67864);let h=e=>"buttonGroup"===e.type.name;var g=n(86958),m=n(6845),f=n(94922),y=n(98968),v=n(55424),b=n(60300),w=n(56124),x=n(85570),I=n(60122),C=n(56603);let S=()=>({absPositions:[],relPositions:[]});class k{getPositions(e){return e?this.presentModePositions:this.editModePositions}apply(e,t){let n=e.getMeta(x.g);if(n)switch(n.type){case"addAnimationPositions":this.addAnimationPositions(n.pos,t,n.isPresentMode);break;case"resetAnimationPositions":this.resetAnimationPositions(n.isPresentMode);break;case"enableAnimations":this.enabled=n.enabled;break;default:console.warn("AnimationsState: unknown action type",n)}return this}addAnimationPositions(e,t,n){let a=this.getPositions(n),o=Math.max(...a.absPositions);e.forEach(e=>{if(e<=o)return;a.absPositions.push(e);let n=(0,C.JO)(t,e);n&&a.relPositions.push(n)})}resetAnimationPositions(e){e?this.presentModePositions=S():this.editModePositions=S()}getAnimationPositionsAbs(e,t){let n=I.pJ.getState(e),a=this.getPositions(t);return n?a.relPositions.map(t=>(0,C.d_)(e,t)).filter(Boolean):a.absPositions}constructor(){this.enabled=!0,this.presentModePositions=S(),this.editModePositions=S()}}let A="animate-has-animated",T="animatable-on-load",z="animatable-on-load-as-block",P="animatable-on-load-content-parent",E="animatable-on-load-content-child",j=e=>{switch(e.type.name){case"card":return!0===(0,m.Wq)(e);case"cardAccentLayoutItem":return(0,f.wL)(e);case"calloutBox":case"gallery":case"smartLayout":case"divider":return!0;case"smartDiagram":return!(0,u.nr)();default:return(0,b.Rj)(e)}},M=(e,t)=>(0,v.q)(e)||(0,y.qK)(t),R=(e,t)=>{let n=e.view.state.doc.resolve(t);if(!n)return;let a=e.state.doc.nodeAt(t);if(a&&j(a)&&!M(a,n)){let e=a.isLeaf||a.isAtom?0:-1;return{pos:n.pos+e,start:n.pos,depth:n.depth,node:a}}return(0,o.eL)(n,j)},D=(e,t)=>{let n=t.getAnimationPositionsAbs(e,(0,s.wC)((0,l.KA)().getState())===d.w.SLIDE_VIEW).reduce((e,t)=>Math.max(e,t),0),a=e.doc.nodeAt(n),o=a&&n>0?a.nodeSize:0;return n+o},B=()=>new r.k_({key:x.g,state:{init:()=>new k,apply:(e,t,n,a)=>t.apply(e,a)},props:{decorations(e){let t=[],n=this.getState(e);if(!1===n.enabled)return i.zF.create(e.doc,t);let o=D(e,n);return e.doc.descendants((n,r,l,s)=>{let d=e.doc.resolve(r),u=j(n)||M(n,d);if(r<o&&u&&t.push(i.NZ.node(r,r+n.nodeSize,{class:A})),(0,v.M)(n)||(0,y.Pb)(n))t.push(i.NZ.node(r,r+n.nodeSize,{class:P}));else if(h(n)||(0,g.q)(n)||(0,w.hj)(n))t.push(i.NZ.node(r,r+n.nodeSize,{class:z}));else if(M(n,d))t.push(i.NZ.node(r,r+n.nodeSize,{class:E,style:"--animate-index: ".concat(s+1)}));else if(j(n)){let e=!!l&&(0,p.Ti)(n,l),o=n.isAtom;t.push(i.NZ.node(r,r+n.nodeSize,{class:(0,a.cx)(T,e&&"animatable-on-load-annotatable",o&&"animatable-on-load-atom")})),(0,f.wL)(n)&&t.push(i.NZ.node(r,r+n.nodeSize,{class:"animatable-on-load-accent"}))}return!((0,c.jg)(n)&&d.depth>1||(0,v.q)(n)||h(n)||(0,g.q)(n)||(0,w.hj)(n))}),i.zF.create(e.doc,t)}}})},69764:(e,t,n)=>{n.d(t,{R:()=>c,k:()=>d});var a=n(83817),o=n.n(a),r=n(55729),i=n(15342),l=n(43634),s=n(60300);let d=e=>{let t=(0,i.GV)(l.FI,function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return o()(...t)});return(0,r.useMemo)(()=>({enabled:!!(e&&t&&(0,s.UE)(e,t)),pos:null==t?void 0:t.pos}),[e,t])},c=e=>{let t=(0,i.GV)(l.e4),n=(0,i.GV)(l._I,function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return o()(...t)});(0,r.useEffect)(()=>{if(!e||!t||!n)return;console.debug("[useScrollAndSpotlightSync] collaboratorBeingFollowed spotlight or scroll changed",JSON.stringify(n,null,2));let{spotlight:a,scroll:o}=n;e.commands.syncSpotlightAndScroll({spotlight:a,scroll:o,scrollOffset:100,isFollowing:!0})},[e,t,n])}},74127:(e,t,n)=>{n.d(t,{u:()=>l});var a=n(6029),o=n(74158),r=n(20011),i=n(10817);let l=e=>{let{...t}=e,{reduxData:n,...l}=t,s=(0,r.F)(n);return(0,a.jsx)(o.Kq,{store:s,children:(0,a.jsx)(i.b,{...l,readOnly:!0,isStatic:!0,animationsEnabled:!1})})}},78116:(e,t,n)=>{n.d(t,{Q:()=>i});var a=n(37243),o=n(61121),r=n(85570);let i=a.YY.create({name:"animations",addOptions:()=>({}),addCommands:()=>({addAnimationPositions:(e,t)=>n=>{let{state:a,dispatch:o}=n;return o&&a.tr.setMeta(r.g,{type:"addAnimationPositions",isPresentMode:t,pos:e}),!0},enableAnimations:e=>t=>{let{state:n,dispatch:a}=t;return a&&n.tr.setMeta(r.g,{type:"enableAnimations",enabled:e}),!0},resetAnimationPositions:e=>t=>{let{state:n,dispatch:a}=t;return a&&n.tr.setMeta(r.g,{type:"resetAnimationPositions",isPresentMode:e}),!0}}),addProseMirrorPlugins:()=>[(0,o.ZY)()]})},85570:(e,t,n)=>{n.d(t,{g:()=>a});let a=new(n(63867)).hs("animation")},86497:(e,t,n)=>{n.d(t,{O:()=>r});var a=n(32617),o=n(5291);let r=()=>{let e=(0,a.u)("offlineEditing"),t=(0,o.b9)();return e&&t}},87291:(e,t,n)=>{n.d(t,{d:()=>g});var a=n(6029),o=n(46898),r=n(19564),i=n(55729),l=n(88586),s=n(15342),d=n(95889),c=n(99552),u=n(91792),p=n(43634),h=n(85607);let g=()=>{let e=(0,o.d)(),[t]=(0,l.vlJ)(),n=(0,s.GV)(c.df),{docId:g,getCollaborativeEditorInstance:m}=(0,h.mi)(),f=(0,s.GV)(p.SJ),y=m(),v=(0,d.st)(),{updateDocThemeWithAccentImages:b}=(0,u.Kt)({docId:g,editor:y}),w=(0,i.useCallback)(e=>{n&&e.id!==f.id&&t({variables:{input:{siteId:n,themeId:e.id}},update:(t,a)=>{let{data:o}=a,r=t.readFragment({id:"Theme:".concat(e.id),fragment:l.qaq,fragmentName:"DefaultThemeFields"});t.updateQuery({query:l.zLA,variables:{id:n}},e=>e&&e.site&&r?{...e,site:{...e.site,...null==o?void 0:o.updateSite,theme:r}}:e)}}).then(()=>{})},[n,f.id,t]),x=(0,i.useCallback)(t=>{t.id!==f.id&&b(t.id).then(()=>{null==v||v.track(d.VV.DOC_THEME_UPDATED,{doc_id:g,theme_id:t.id})}).catch(t=>{console.error(t),e({title:(0,a.jsx)(r.x6,{id:"Fulf8b",values:{0:t.message}}),position:"top",status:"error"})})},[v,f.id,g,e,b]);return(0,i.useCallback)(e=>n?w(e):x(e),[n,x,w])}}}]);
//# sourceMappingURL=925-27302873526fa452.js.map